{"version":3,"file":"src_app_home_home_module_ts.js","mappings":"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","sources":["./src/app/home/home-routing.module.ts","./src/app/home/home.module.ts","./src/app/home/home.page.ts","./src/app/home/home.page.html","./src/app/interfaces/route-graph.ts","./src/app/services/dijkstra.service.ts","./src/app/services/geocode.service.ts","./src/app/services/map.service.ts","./src/app/services/nearby-rider.service.ts","./src/app/services/network.service.ts","./src/app/services/shared-ride.service.ts","./src/app/shared-ride-prompt/shared-ride-prompt.component.ts","./src/app/shared-ride-prompt/shared-ride-prompt.component.html","./node_modules/@capacitor/app/dist/esm/definitions.js","./node_modules/@capacitor/app/dist/esm/index.js","./node_modules/@capacitor/geolocation/dist/esm/definitions.js","./node_modules/@capacitor/geolocation/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/definitions.js","./node_modules/@capacitor/google-maps/dist/esm/implementation.js","./node_modules/@capacitor/google-maps/dist/esm/index.js","./node_modules/@capacitor/google-maps/dist/esm/map.js","./node_modules/@mapbox/polyline/src/polyline.js","./node_modules/rxjs/dist/esm/internal/observable/interval.js","./node_modules/@capacitor/synapse/dist/synapse.mjs"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { HomePage } from './home.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: HomePage,\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule]\r\n})\r\nexport class HomePageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { HomePage } from './home.page';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n\r\nimport { HomePageRoutingModule } from './home-routing.module';\r\nimport { SharedRidePromptComponent } from '../shared-ride-prompt/shared-ride-prompt.component';\r\n\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    HomePageRoutingModule,\r\n    TranslateModule.forChild()\r\n  ],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA],\r\n  declarations: [HomePage, SharedRidePromptComponent]\r\n    //NearbyTripsComponent]\r\n})\r\nexport class HomePageModule {}\r\n","/// <reference types=\"google.maps\" />\r\nimport { AfterViewInit, Component, ElementRef, NgZone, ViewChild } from '@angular/core';\r\nimport { Geolocation, Position } from '@capacitor/geolocation';\r\nimport { ModalOptions, ModalController, Platform, NavController, AlertController, ToastController, ActionSheetController } from '@ionic/angular';\r\nimport { AutocompleteComponent } from '../autocomplete/autocomplete.component';\r\nimport { OverlayService } from '../services/overlay.service';\r\nimport { GeocodeService } from '../services/geocode.service';\r\nimport { MapService } from '../services/map.service';\r\nimport { AvatarService } from '../services/avatar.service';\r\nimport { Drivers } from '../interfaces/drivers';\r\nimport { Observable, timer, interval, BehaviorSubject, throwError, Subscription } from 'rxjs';\r\nimport { doc as firestoreDoc, updateDoc, getDoc, collection, onSnapshot, doc, Firestore, query, where } from '@angular/fire/firestore';\r\nimport { Marker, Polyline } from '@capacitor/google-maps';\r\nimport { AuthService } from '../services/auth.service';\r\nimport { EnrouteChatComponent } from '../enroute-chat/enroute-chat.component';\r\nimport { NetworkService } from '../services/network.service'\r\nimport { Network } from '@capacitor/network';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { App } from '@capacitor/app';\r\nimport { PaymentService } from '../services/payment.service';\r\nimport { AddCardComponent } from '../add-card/add-card.component';\r\nimport { switchMap } from 'rxjs/operators';\r\nimport { LatLngLiteral } from '@googlemaps/google-maps-services-js';\r\nimport { LatLng } from '@capacitor/google-maps/dist/typings/definitions';\r\nimport { Preferences } from '@capacitor/preferences';\r\nimport { Auth, onAuthStateChanged } from '@angular/fire/auth';\r\n\r\nimport { TripSummaryComponent } from '../trip-summary/trip-summary.component';\r\nimport { geohashForLocation } from 'geofire-common';\r\nimport { SharedRideService, SharedRideNotification } from '../services/shared-ride.service';\r\nimport { CoPassenger, SharedRide } from '../interfaces/rider';\r\nimport { SettingsService } from '../services/settings.service';\r\n\r\n// Dijkstra & Nearby Rider imports\r\nimport { DijkstraService } from '../services/dijkstra.service';\r\nimport { NearbyRiderService } from '../services/nearby-rider.service';\r\nimport { PathResult, ScoredMatch, SharedRideOpportunity, LatLng as RouteLatLng } from '../interfaces/route-graph';\r\nimport { OnesignalService } from '../one-signal.service';\r\n\r\ndeclare var google;\r\n\r\n@Component({\r\n  selector: 'app-home',\r\n  templateUrl: 'home.page.html',\r\n  styleUrls: ['home.page.scss'],\r\n})\r\nexport class HomePage implements AfterViewInit {\r\n  [x: string]: any;\r\n  profile = null;\r\n  presets: Array<any> = [];\r\n  @ViewChild('map',  { static: true }) mapRef: ElementRef<HTMLElement>;\r\n  @ViewChild('topBar', { static: true }) topBar: ElementRef<HTMLElement>;\r\n  @ViewChild('bottomBar', { static: true }) bottomBar: ElementRef<HTMLElement>;\r\n  mappy;\r\n  @ViewChild('mapElement') mapElement: ElementRef<HTMLElement>;\r\n  coordinates: Position;\r\n  address: any = 'Unknown';\r\n  bookingStage: any;\r\n  confirmStage: any;\r\n  trackingStage: any;\r\n  searchingStage: any;\r\n  noDriverStage: any;\r\n  drivingToDestinationStage: any;\r\n  data: any;\r\n  cash: any = false;\r\n  state: any = [];\r\n  mapPinStage: boolean;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  mapPinDrag: any;\r\n  showResetLocationButton: any = false;\r\n  showloader: boolean;\r\n  mapClass: any;\r\n  destinationAddress: string = 'Drag To Pick Destination';\r\n  locationAddress: string = null;\r\n  distance: any;\r\n  direction: any;\r\n  actualDestination: any;\r\n  markers: any;\r\n  allDrivers: Observable<Drivers[]>;\r\n  NoDrivers: boolean;\r\n  driverMarker: string;\r\n  driver_duration_apart: number;\r\n  driver_number_of_seats: any;\r\n  price: any = 0;\r\n  carname: any;\r\n  driver_ID: any;\r\n  bounds: any;\r\n  DriverLatLng: { lat: any; lng: any; };\r\n  drivers_Requested: any[] = [];  // Initialize as empty array\r\n  current_Request_Number: number = 0;  // Start at 0 instead of -1\r\n  Driver_Rejected: any;\r\n  numCalls: any;\r\n  currentDriver: any;\r\n  private countdownActive = false;\r\n\r\n  unsubscribe: import(\"@angular/fire/firestore\").Unsubscribe;\r\n  driverInfo: import(\"@angular/fire/firestore\").DocumentData;\r\n  duration: any = null;\r\n  riderCleared: any;\r\n  updateDriverSubcription: any;\r\n  canCheck: boolean;\r\n  marker1: any;\r\n  marker2: any;\r\n  actualLocation: string;\r\n  LatLng: { lat: number; lng: number; };\r\n  mapy: boolean;\r\n  AllCarMarkers: Marker[];\r\n  private _carmarkers: { id: string, marker: any }[] = [];\r\n  private rider_marker: any;\r\n  private driver_marker: any;\r\n\r\n  cards: import(\"@angular/fire/firestore\").DocumentData[];\r\n  selected: any;\r\n  selectedCard: any;\r\n  closeDrivers: any;\r\n  countDown: any;\r\n  places: import(\"@angular/fire/firestore\").DocumentData[];\r\n  newPoly: string[];\r\n  isConnected: boolean;\r\n  private networkStatus$ = new BehaviorSubject<boolean>(true);\r\n  pollingInterval: any;\r\n  animatedMarker: any;\r\n  driverImage: any;\r\n  private permissionCheckInterval: any;\r\n  savedPaymentMethods: any;\r\n  requestID: string;\r\n  rideHasStarted: boolean;\r\n  driverLocation: { lat: number, lng: number } | null = null;\r\n  stopPolling: boolean = false;\r\n  riderMarker: string;\r\n  routePath: google.maps.MVCArray<google.maps.LatLng> | (google.maps.LatLng | google.maps.LatLngLiteral)[];\r\n  destinationMarker: any;\r\n  D_duration: any;\r\n  routePolyline: any;\r\n  paymentProcessed: boolean = false;\r\n  processingPaymentForRide: string | null = null; // Track which ride payment is being processed for\r\n  private routeUpdateSubscription: Subscription;\r\n  topBarHeight: any;\r\n  bottomBarHeight:any;\r\n  private readonly RIDE_STATE_KEY = 'activeRideState';\r\n  private isLoadingDriver = false;\r\n\r\n  // Shared ride properties\r\n  sharedRideEnabled: boolean = false;  // Toggle state for \"Share & Save\"\r\n  sharedRideData: SharedRide | null = null;  // Current shared ride data\r\n  coPassengers: CoPassenger[] = [];  // Co-passengers in shared ride\r\n  isSharedRide: boolean = false;  // Is current ride a shared ride\r\n  originalPrice: number = 0;  // Original price before discount\r\n  discountedPrice: number = 0;  // Price after shared ride discount\r\n  discountPercent: number = 0;  // Discount percentage\r\n  pickupQueuePosition: number = 0;  // Position in pickup queue\r\n  passengersBeforeMe: number = 0;  // How many passengers picked up before me\r\n  private sharedRideSubscription: Subscription | null = null;\r\n  private sharedRideNotificationSubscription: Subscription | null = null;\r\n\r\n  // Dijkstra route matching properties\r\n  private computedPath: PathResult | null = null;\r\n  private nearbyMatches: ScoredMatch[] = [];\r\n  private sharedRideOpportunityId: string | null = null;\r\n  availableSharedRides: SharedRideOpportunity[] = [];\r\n  showSharedRidePrompt: boolean = false;\r\n  selectedSharedRide: SharedRideOpportunity | null = null;\r\n  private nearbyOpportunitiesSubscription: Subscription | null = null;\r\n  isCalculatingRoute: boolean = false;\r\n  nearbyRidersCount: number = 0;\r\n\r\n  // Add these stage constants at the class level\r\n  private readonly STAGES = {\r\n    BOOKING: 'booking',\r\n    CONFIRM: 'confirm',\r\n    TRACKING: 'tracking',\r\n    SEARCHING: 'searching',\r\n    DRIVING: 'driving',\r\n    NO_DRIVER: 'noDriver',\r\n    MAP_PIN: 'mapPin',\r\n    NO_DRIVERS: 'noDrivers'\r\n  } as const;\r\n\r\n  // Add this to your class properties\r\n  private lastHandledState: string | null = null;\r\n\r\n  // Add this property to the class\r\n  private isRideStopProcessed = false;\r\n\r\n  // Update interval for route tracking (in milliseconds)\r\n  private readonly UPDATE_INTERVAL = 5000; // Update every 5 seconds\r\n\r\n  constructor(\r\n    private auth: Auth,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private networkService: NetworkService,\r\n    public map: MapService,\r\n    private nav: NavController,\r\n    private platform: Platform,\r\n    private firestore: Firestore,\r\n    private readonly database: AvatarService,\r\n    private ngZone: NgZone,\r\n    private geocode: GeocodeService,\r\n    private overlay: OverlayService,\r\n    private modalCtrl: ModalController,\r\n    private alert: AlertController,\r\n    private payME: PaymentService,\r\n    private toastController: ToastController,\r\n    private actionSheetController: ActionSheetController,\r\n    private sharedRideService: SharedRideService,\r\n    public settingsService: SettingsService,\r\n    private dijkstraService: DijkstraService,\r\n    private nearbyRiderService: NearbyRiderService,\r\n    private oneSignalService: OnesignalService\r\n  ) {\r\n    this.initializeApp();\r\n  }\r\n\r\n  async ngOnDestroy() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    // window.removeEventListener('resize', this.setMapHeight.bind(this));\r\n    this.clearSubscriptions();\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Clean up nearby rider subscriptions\r\n    if (this.nearbyOpportunitiesSubscription) {\r\n      this.nearbyOpportunitiesSubscription.unsubscribe();\r\n    }\r\n    this.nearbyRiderService.unsubscribeFromOpportunities();\r\n  }\r\n\r\n\r\n  async ionViewWillEnter() {\r\n    // Refresh payment methods every time the view is entered\r\n    await this.fetchSavedPaymentMethods();\r\n    \r\n    // Check for shared ride deep link\r\n    this.checkSharedRideDeepLink();\r\n  }\r\n\r\n  /**\r\n   * Check for shared ride opportunity from deep link/notification\r\n   */\r\n  private checkSharedRideDeepLink(): void {\r\n    this.route.queryParams.subscribe(async (params) => {\r\n      if (params['sharedOpportunityId'] && params['showSharedPrompt'] === 'true') {\r\n        console.log('Handling shared ride deep link:', params['sharedOpportunityId']);\r\n        await this.handleSharedRideDeepLink(params['sharedOpportunityId']);\r\n        \r\n        // Clear the query params\r\n        this.router.navigate([], {\r\n          relativeTo: this.route,\r\n          queryParams: {},\r\n          replaceUrl: true\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  async ngAfterViewInit() {\r\n    try {\r\n      // First check location permissions\r\n      const hasPermission = await this.checkAndRequestLocationPermissions();\r\n      if (!hasPermission) {\r\n        return;\r\n      }\r\n      \r\n      // Initialize profile first\r\n      await this.initializeProfile();\r\n      \r\n      // Then proceed with other initializations\r\n      await this.initializeApp();\r\n      await this.initializeNetworkMonitoring();\r\n      await this.fetchSavedPaymentMethods();\r\n  // load user preset places (localStorage-backed)\r\n  await this.loadPresets();\r\n      \r\n      // Initialize geolocation and map BEFORE entering booking stage\r\n      await this.initializeGeolocation();\r\n      await this.initializeMap();\r\n      \r\n      // Start polling position AFTER map is initialized to prevent race conditions\r\n      this.startPollingPosition();\r\n      \r\n      // Now it's safe to enter booking stage (map is initialized)\r\n      this.EnterBookingStage();\r\n      \r\n      // Set up real-time listener for ride state\r\n      this.initializeRideStateListener();\r\n    } catch (e) {\r\n      console.log('Error in ngAfterViewInit:', e);\r\n      //this.overlay.hideLoader();\r\n      //this.overlay.showAlert('Error', 'An error occurred during initialization. Please try again.');\r\n    }\r\n  }\r\n\r\n  // Preset places management (localStorage)\r\n  async loadPresets() {\r\n    try {\r\n      const raw = localStorage.getItem('presetPlaces');\r\n      if (raw) {\r\n        this.presets = JSON.parse(raw);\r\n      } else {\r\n        // default presets\r\n        this.presets = [\r\n          { name: 'Queensbay Mall, Penang', address: 'Queensbay Mall, Bayan Lepas, Penang', lat: 5.2939, lng: 100.2719 },\r\n          { name: 'George Town Ferry Terminal', address: 'Weld Quay, George Town, Penang', lat: 5.4141, lng: 100.3294 }\r\n        ];\r\n        localStorage.setItem('presetPlaces', JSON.stringify(this.presets));\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to load presets', e);\r\n      this.presets = [];\r\n    }\r\n  }\r\n\r\n  async savePresets() {\r\n    try {\r\n      localStorage.setItem('presetPlaces', JSON.stringify(this.presets));\r\n    } catch (e) {\r\n      console.error('Failed to save presets', e);\r\n    }\r\n  }\r\n\r\n  // Add current destination as preset\r\n  async addCurrentAsPreset() {\r\n    try {\r\n      if (!this.destinationAddress || !this.D_LatLng || !this.D_LatLng.lat) {\r\n        const alert = await this.alert.create({\r\n          header: 'Add preset',\r\n          message: 'Please choose a destination on the map first (pin or search).',\r\n          buttons: ['OK']\r\n        });\r\n        await alert.present();\r\n        return;\r\n      }\r\n\r\n      const name = this.destinationAddress || 'New Place';\r\n      this.presets.unshift({ name, address: name, lat: this.D_LatLng.lat, lng: this.D_LatLng.lng });\r\n      // keep only latest 10\r\n      if (this.presets.length > 10) this.presets.length = 10;\r\n      await this.savePresets();\r\n    } catch (e) {\r\n      console.error('Error adding preset', e);\r\n    }\r\n  }\r\n\r\n  // Delete preset by index\r\n  async deletePreset(i: number) {\r\n    this.presets.splice(i, 1);\r\n    await this.savePresets();\r\n  }\r\n\r\n  // Select a preset: set destination and trigger directions\r\n  async selectPreset(preset: any) {\r\n    try {\r\n      this.destinationAddress = preset.name || preset.address || '';\r\n      if (preset.lat && preset.lng) {\r\n        this.D_LatLng = { lat: preset.lat, lng: preset.lng };\r\n        // trigger distance/directions calculation\r\n        await this.getDistanceAndDirections();\r\n      } else {\r\n        // fallback: if no coords, open autocomplete modal with address prefilled\r\n        // set data for modal then open it\r\n        await this.showAutocompleteModal();\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to select preset', e);\r\n    }\r\n  }\r\n\r\n  // Add this new method\r\n  private async initializeProfile() {\r\n    try {\r\n      // Show loader while initializing profile\r\n     // await this.overlay.showLoader('Loading profile...');\r\n\r\n      // Wait for auth state to be ready\r\n      const user = await new Promise<any>((resolve) => {\r\n        const unsubscribe = onAuthStateChanged(this.auth, (user) => {\r\n          unsubscribe();\r\n          resolve(user);\r\n        });\r\n      });\r\n\r\n      if (!user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n\r\n      // Get profile data\r\n      this.profile = await this.database.getUserProfile();\r\n      \r\n      if (!this.profile) {\r\n        console.log('Creating new profile...');\r\n        // If profile doesn't exist, create it with default values\r\n        this.profile = {\r\n          userId: user.uid,\r\n          email: user.email,\r\n          createdAt: new Date().toISOString(),\r\n          // Add any other default profile fields you need\r\n        };\r\n        await this.database.createUserProfile(this.profile);\r\n      }\r\n\r\n      console.log('Profile initialized:', this.profile);\r\n      this.overlay.hideLoader();\r\n    } catch (error) {\r\n      console.error('Error initializing profile:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Profile Error',\r\n        'Unable to initialize user profile. Please try again or contact support.'\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Add this method to check profile before any ride-related action\r\n  private async ensureProfileInitialized(): Promise<boolean> {\r\n    if (!this.profile) {\r\n      try {\r\n        await this.initializeProfile();\r\n        return true;\r\n      } catch (error) {\r\n        console.error('Error ensuring profile is initialized:', error);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  private initializeRideStateListener() {\r\n    console.log('Initializing ride state listener');\r\n    \r\n    // Reset lastHandledState on initialization to ensure proper state restoration\r\n    this.lastHandledState = null;\r\n    \r\n    onAuthStateChanged(this.auth, (user) => {\r\n      if (!user) return;\r\n\r\n      // Listen to the Request collection for active rides for this user\r\n      const requestsQuery = query(\r\n        collection(this.firestore, 'Request'),\r\n        where('Rider_id', '==', user.uid),\r\n        where('status', 'in', ['pending', 'confirmed', 'started'])\r\n      );\r\n\r\n      this.unsubscribe = onSnapshot(requestsQuery, async (snapshot) => {\r\n        try {\r\n          // If no active rides found, go to booking stage\r\n          if (snapshot.empty) {\r\n            console.log('No active rides found');\r\n            this.setStage(this.STAGES.BOOKING);\r\n            return;\r\n          }\r\n\r\n          // Get the most recent active ride\r\n          const activeRides = snapshot.docs;\r\n          const currentRide = activeRides[0];\r\n          const rideData = currentRide.data();\r\n          this.requestID = currentRide.id;\r\n\r\n          // Restore price information\r\n          this.price = rideData.price || 0;\r\n          console.log('Restored ride price:', this.price);\r\n          console.log('Current ride status:', rideData.status);\r\n\r\n          // IMPORTANT: On app initialization, always restore ride state regardless of lastHandledState\r\n          const isAppInitialization = !this.lastHandledState;\r\n          \r\n          // Only skip if we've already handled this state AND it's not initial app load\r\n          if (this.lastHandledState === rideData.status && !isAppInitialization) {\r\n            console.log('State already properly handled:', rideData.status);\r\n            return;\r\n          }\r\n\r\n          // Store location data for later use\r\n          if (rideData.Loc_lat && rideData.Loc_lng) {\r\n            this.LatLng = {\r\n              lat: rideData.Loc_lat,\r\n              lng: rideData.Loc_lng\r\n            };\r\n          }\r\n          \r\n          if (rideData.Des_lat && rideData.Des_lng) {\r\n            this.D_LatLng = {\r\n              lat: rideData.Des_lat,\r\n              lng: rideData.Des_lng\r\n            };\r\n          }\r\n          \r\n          // Store addresses\r\n          this.locationAddress = rideData.Rider_Location || 'Unknown location';\r\n          this.destinationAddress = rideData.Rider_Destination || 'Unknown destination';\r\n\r\n          console.log('Restoring ride state:', rideData.status);\r\n\r\n          // Handle different ride states\r\n          switch (rideData.status) {\r\n            case 'pending':\r\n              await this.handlePendingState();\r\n              break;\r\n            case 'confirmed':\r\n              console.log('Handling confirmed state on restore...');\r\n              await this.handleRideConfirmation(rideData);\r\n              break;\r\n            case 'started':\r\n              await this.handleRideStart(currentRide);\r\n              break;\r\n            case 'cancelled':\r\n              await this.handleRideCancellation(rideData);\r\n              break;\r\n            default:\r\n              console.log('Unknown ride status:', rideData.status);\r\n              this.setStage(this.STAGES.BOOKING);\r\n          }\r\n          \r\n          // Only update lastHandledState AFTER successful handling\r\n          this.lastHandledState = rideData.status;\r\n          \r\n        } catch (error) {\r\n          console.error('Error handling ride state:', error);\r\n          if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n            this.overlay.showAlert('Error', 'Failed to restore ride state. Please try again.');\r\n            this.setStage(this.STAGES.BOOKING);\r\n          }\r\n        }\r\n      }, (error) => {\r\n        console.error('Error in ride state listener:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  private handleRemovedRide() {\r\n    console.log('Ride was removed');\r\n    this.clearRideData();\r\n    this.setStage(this.STAGES.BOOKING);\r\n  }\r\n\r\n  private clearRideData() {\r\n    this.requestID = null;\r\n    this.driverInfo = null;\r\n    this.rideHasStarted = false;\r\n    this.lastHandledState = null;\r\n    this.paymentProcessed = false; // Reset payment flag\r\n    this.processingPaymentForRide = null; // Reset processing flag\r\n    // Clear any other ride-specific data\r\n  }\r\n\r\n  async checkAndRequestLocationPermissions() {\r\n    try {\r\n      // Check if running on web platform\r\n      if (this.platform.is('capacitor')) {\r\n        const permissionStatus = await Geolocation.checkPermissions();\r\n        \r\n        if (permissionStatus.location === 'granted') {\r\n          this.overlay.hideLoader();\r\n          return true;\r\n        }\r\n\r\n        const alert = await this.alert.create({\r\n          header: 'Location Permission Required',\r\n          message: 'This app needs access to your location to function properly.',\r\n          buttons: [\r\n            {\r\n              text: 'Enable Location',\r\n              handler: async () => {\r\n                const newStatus = await Geolocation.requestPermissions();\r\n                this.overlay.hideLoader();\r\n                \r\n                if (newStatus.location !== 'granted') {\r\n                  await this.showLocationRequiredAlert();\r\n                  return false;\r\n                }\r\n                return true;\r\n              }\r\n            }\r\n          ],\r\n          backdropDismiss: false\r\n        });\r\n\r\n        await alert.present();\r\n        const { role } = await alert.onDidDismiss();\r\n        \r\n        if (role === 'backdrop') {\r\n          this.overlay.hideLoader();\r\n          await this.showLocationRequiredAlert();\r\n          return false;\r\n        }\r\n      } else {\r\n        // Web platform - use browser's geolocation API\r\n        if ('geolocation' in navigator) {\r\n          return new Promise((resolve) => {\r\n            navigator.permissions.query({ name: 'geolocation' }).then((result) => {\r\n              if (result.state === 'granted') {\r\n                this.overlay.hideLoader();\r\n                resolve(true);\r\n              } else {\r\n                this.overlay.hideLoader();\r\n                resolve(this.showWebLocationPrompt());\r\n              }\r\n            });\r\n          });\r\n        } else {\r\n          this.overlay.hideLoader();\r\n          await this.overlay.showAlert('Error', 'Geolocation is not supported in this browser.');\r\n          return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error checking/requesting location permissions:', error);\r\n      this.overlay.hideLoader();\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  private async showWebLocationPrompt(): Promise<boolean> {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Access',\r\n      message: 'This app needs your location. Please allow location access when prompted by your browser.',\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n          handler: () => {\r\n            return new Promise((resolve) => {\r\n              navigator.geolocation.getCurrentPosition(\r\n                () => resolve(true),\r\n                () => {\r\n                  this.showLocationRequiredAlert();\r\n                  resolve(false);\r\n                }\r\n              );\r\n            });\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n    return true;\r\n  }\r\n\r\n  private async showLocationRequiredAlert() {\r\n    const alert = await this.alert.create({\r\n      header: 'Location Required',\r\n      message: 'Location permission is required to use this app. Please enable location services in your device settings.',\r\n      buttons: ['OK']\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async fetchSavedPaymentMethods() {\r\n    try {\r\n      this.savedPaymentMethods = await this.database.getSavedPaymentMethods();\r\n      console.log('Saved Payment Methods:', this.savedPaymentMethods);\r\n      \r\n      // Set default payment method to cash if no cards are saved\r\n      if (this.savedPaymentMethods.length === 0) {\r\n        this.selectedCard = 'cash';\r\n        this.cash = true;\r\n      } else {\r\n        this.selectedCard = this.savedPaymentMethods[0].cardId;\r\n        this.cash = false;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching saved payment methods:', error);\r\n    }\r\n  }\r\n\r\n  chooseCard(event: any) {\r\n    const selectedValue = event.detail.value;\r\n    \r\n    // Handle the \\\"Add Card\\\" option\r\n    if (selectedValue === 'add_card') {\r\n      this.openAddCardModal();\r\n      // Reset to previous selection if user cancels or if no cards after modal\r\n      if (!this.selectedCard || this.selectedCard === 'add_card') {\r\n        this.selectedCard = this.savedPaymentMethods.length > 0 ? this.savedPaymentMethods[0].cardId : 'cash';\r\n        this.cash = this.selectedCard === 'cash';\r\n      }\r\n      return;\r\n    }\r\n    \r\n    this.selectedCard = selectedValue;\r\n    this.cash = this.selectedCard === 'cash';\r\n    if (!this.cash) {\r\n     // this.processPayment(this.authService.user.email, this.defaultAmount, this.selectedCard);\r\n    }\r\n  }\r\n\r\n  // async processPayment(email: string, amount: number, cardId: any) {\r\n  //   //this.overlay.showLoader('Processing payment...');\r\n\r\n  //   try {\r\n  //     const paymentResult = await this.payME.processPaymentWithCardId(email, amount, cardId).toPromise();\r\n  //     console.log('Payment successful:', paymentResult);\r\n  //     await this.overlay.showAlert('Success', 'Payment successful!');\r\n  //   } catch (error) {\r\n  //     console.error('Error during payment:', error);\r\n  //     const errorMessage = error.error ? error.error.error : 'An unexpected error occurred.';\r\n  //     await this.showPaymentErrorModal(errorMessage);\r\n  //   } finally {\r\n  //     //this.overlay.hideLoader();\r\n  //   }\r\n  // }\r\n\r\n  async processRidePayment(rideData: any) {\r\n    try {\r\n      // Check if payment was already processed for this ride\r\n      if (this.paymentProcessed) {\r\n        console.log('Payment already processed for this ride, skipping...');\r\n        return;\r\n      }\r\n\r\n      // Check if payment was already processed in the database\r\n      const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n      const rideDoc = await getDoc(rideRef);\r\n      const existingData = rideDoc.data();\r\n      \r\n      if (existingData?.paymentProcessed) {\r\n        console.log('Payment already processed in database, skipping...');\r\n        this.paymentProcessed = true;\r\n        return;\r\n      }\r\n      \r\n      console.log('Processing ride payment...');\r\n      \r\n      // Validate price before processing\r\n      if (!this.price || typeof this.price !== 'number' || this.price <= 0) {\r\n        console.error('Invalid price for payment:', this.price);\r\n        throw new Error('Invalid price amount');\r\n      }\r\n      \r\n      // Calculate split: 80% to driver, 20% to company\r\n      const totalAmount = Math.round(this.price * 100); // Convert to cents\r\n      \r\n      // Stripe requires minimum 50 cents\r\n      if (totalAmount < 50) {\r\n        console.error('Amount too small for Stripe:', totalAmount);\r\n        throw new Error(`Payment amount is too small (minimum ${this.settingsService.currencySymbol}0.50)`);\r\n      }\r\n      \r\n      const driverAmount = Math.round(totalAmount * 0.80);\r\n      const companyAmount = totalAmount - driverAmount;\r\n      \r\n      console.log('Payment amounts - Total:', totalAmount, 'cents, Driver:', driverAmount, 'cents, Company:', companyAmount, 'cents');\r\n      \r\n      // Validate required fields\r\n      if (!this.selectedCard || this.selectedCard === 'cash') {\r\n        console.error('Invalid payment method:', this.selectedCard);\r\n        throw new Error('No valid payment method selected');\r\n      }\r\n      \r\n      if (!this.database.user?.email) {\r\n        console.error('User email not found');\r\n        throw new Error('User email is required for payment');\r\n      }\r\n      \r\n      if (!this.requestID) {\r\n        console.error('Request ID not found');\r\n        throw new Error('Ride ID is required for payment');\r\n      }\r\n      \r\n      const paymentData = {\r\n        email: this.database.user.email,\r\n        amount: totalAmount,\r\n        currency: this.settingsService.currency.toLowerCase(),\r\n        paymentMethodId: this.selectedCard,\r\n        driverId: rideData.driverDetails?.Driver_id || this.driverInfo?.Driver_id || '',\r\n        rideId: this.requestID,\r\n        driverAmount: driverAmount,\r\n        companyAmount: companyAmount,\r\n        description: `Ride from ${this.locationAddress || 'pickup'} to ${this.destinationAddress || 'destination'}`\r\n      };\r\n      \r\n      console.log('Payment data:', JSON.stringify(paymentData, null, 2));\r\n      \r\n      // Show loading indicator using overlay service\r\n      //this.overlay.showLoader('Processing payment...');\r\n      \r\n      // Process the payment\r\n      const paymentResult = await this.payME.processRidePayment(paymentData).toPromise();\r\n      \r\n      //this.overlay.hideLoader();\r\n      \r\n      if (paymentResult.success) {\r\n        console.log('Payment processed successfully:', paymentResult);\r\n        \r\n        // Mark payment as processed FIRST\r\n        this.paymentProcessed = true;\r\n        \r\n        // Update ride document with payment information\r\n        await updateDoc(doc(this.firestore, 'Request', this.requestID), {\r\n          paymentProcessed: true,\r\n          paymentIntentId: paymentResult.paymentIntentId,\r\n          paymentAmount: totalAmount,\r\n          paymentTimestamp: new Date(),\r\n          driverAmount: driverAmount,\r\n          companyAmount: companyAmount\r\n        });\r\n        \r\n        // Show success toast\r\n        const toast = await this.toastController.create({\r\n          message: 'Payment processed successfully',\r\n          duration: 2000,\r\n          position: 'bottom',\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      } else {\r\n        throw new Error(paymentResult.error || 'Payment failed');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error processing ride payment:', error);\r\n      this.overlay.hideLoader();\r\n      \r\n      // Extract meaningful error message\r\n      let errorMessage = 'Payment could not be processed.';\r\n      if (error?.error?.error) {\r\n        errorMessage = error.error.error;\r\n      } else if (error?.message) {\r\n        errorMessage = error.message;\r\n      } else if (typeof error === 'string') {\r\n        errorMessage = error;\r\n      }\r\n      \r\n      console.error('Payment error details:', errorMessage);\r\n      \r\n      // Show error to user but don't cancel the ride\r\n      const alert = await this.alert.create({\r\n        header: 'Payment Error',\r\n        message: `${errorMessage}\\n\\nYou can pay cash to the driver instead.`,\r\n        buttons: [\r\n          {\r\n            text: 'Pay Cash',\r\n            handler: async () => {\r\n              // Switch to cash payment\r\n              this.cash = true;\r\n              this.paymentProcessed = true; // Mark as processed to prevent retry\r\n              if (this.requestID) {\r\n                await updateDoc(doc(this.firestore, 'Request', this.requestID), {\r\n                  cash: true,\r\n                  paymentMethod: 'cash',\r\n                  paymentProcessed: true\r\n                });\r\n              }\r\n            }\r\n          },\r\n          {\r\n            text: 'Retry Payment',\r\n            handler: async () => {\r\n              // Reset the flag before retrying\r\n              this.paymentProcessed = false;\r\n              await this.processRidePayment(rideData);\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      await alert.present();\r\n    }\r\n  }\r\n\r\n  async showPaymentErrorModal(errorMessage: string) {\r\n    const alert = await this.alert.create({\r\n      header: 'Payment Error',\r\n      message: errorMessage,\r\n      buttons: [\r\n        {\r\n          text: 'Add New Card',\r\n          handler: async () => {\r\n            await this.openAddCardModal();\r\n          }\r\n        },\r\n        {\r\n          text: 'Cancel',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async openAddCardModal() {\r\n    const modal = await this.modalCtrl.create({\r\n      component: AddCardComponent,\r\n    });\r\n    await modal.present();\r\n    const { data } = await modal.onWillDismiss();\r\n    if (data && data.success) {\r\n      // Refresh payment methods after adding a card\r\n      await this.fetchSavedPaymentMethods();\r\n      // Select the newly added card if available\r\n      if (this.savedPaymentMethods.length > 0) {\r\n        this.selectedCard = this.savedPaymentMethods[this.savedPaymentMethods.length - 1].cardId;\r\n        this.cash = false;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n    async updateMapPadding(bottomPadding: number) {\r\n    if (this.map && this.map.newMap) {\r\n      await this.map.newMap.setPadding({\r\n        top: 0,\r\n        left: 0,\r\n        right: 0,\r\n        bottom: bottomPadding\r\n      });\r\n    }\r\n  }\r\n\r\n  setMapHeight() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  setMapHeightCreateAndAddMarkers() {\r\n    this.updateMapPadding(40);\r\n  }\r\n\r\n  setMapHeightHandleDrivertoRider() {\r\n    this.updateMapPadding(20);\r\n  }\r\n\r\n  setMapHeightHandleDrivertoDestination() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  ResetMapHeight() {\r\n    this.updateMapPadding(0);\r\n  }\r\n\r\n  private async initializeNetworkMonitoring() {\r\n    const status = await Network.getStatus();\r\n    this.isConnected = status.connected;\r\n    this.networkStatus$.next(this.isConnected);\r\n    console.log('Network monitoring initialized. Initial status:', this.isConnected);\r\n\r\n    Network.addListener('networkStatusChange', (status) => {\r\n      console.log('Network status changed:', status);\r\n      this.isConnected = status.connected;\r\n      this.networkStatus$.next(this.isConnected);\r\n    });\r\n\r\n    this.networkStatus$.subscribe((isConnected) => {\r\n      if (isConnected) {\r\n        this.router.navigate(['home']);\r\n      } else {\r\n        this.router.navigate(['network']);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  initializeApp() {\r\n    this.platform.ready().then(async () => {\r\n      try {\r\n        await this.initializeRideStateListener();\r\n      } catch (error) {\r\n        console.error('Error initializing app:', error);\r\n        this.setStage(this.STAGES.BOOKING);\r\n      }\r\n    });\r\n  }\r\n\r\n  \r\n \r\n  async initializeGeolocation() {\r\n    try {\r\n      let coordinates;\r\n      \r\n      if (this.platform.is('capacitor')) {\r\n        coordinates = await Geolocation.getCurrentPosition({\r\n          timeout: 10000\r\n        });\r\n      } else {\r\n        // Web fallback\r\n        coordinates = await new Promise((resolve, reject) => {\r\n          navigator.geolocation.getCurrentPosition(\r\n            (position) => {\r\n              resolve({\r\n                coords: {\r\n                  latitude: position.coords.latitude,\r\n                  longitude: position.coords.longitude,\r\n                  accuracy: position.coords.accuracy,\r\n                  altitude: position.coords.altitude,\r\n                  altitudeAccuracy: position.coords.altitudeAccuracy,\r\n                  heading: position.coords.heading,\r\n                  speed: position.coords.speed\r\n                },\r\n                timestamp: position.timestamp\r\n              });\r\n            },\r\n            (error) => reject(error),\r\n            { timeout: 10000 }\r\n          );\r\n        });\r\n      }\r\n      \r\n      this.coordinates = coordinates;\r\n      this.LatLng = {\r\n        lat: coordinates.coords.latitude,\r\n        lng: coordinates.coords.longitude\r\n      };\r\n      \r\n      await this.database.updateLocation(this.LatLng);\r\n      console.log('Geolocation initialized:', this.LatLng);\r\n      \r\n      // Note: startPollingPosition is called after map initialization in ngAfterViewInit\r\n    } catch (error) {\r\n      console.error('Error initializing geolocation:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert(\r\n        'Location Error',\r\n        'Unable to get your location. Please check your device settings and try again.'\r\n      );\r\n    }\r\n  }\r\n  \r\n  startPermissionPolling() {\r\n    this.permissionCheckInterval = setInterval(async () => {\r\n      const permissionStatus = await Geolocation.checkPermissions();\r\n      if (permissionStatus.location === 'granted') {\r\n        this.overlay.hideLoader();\r\n        clearInterval(this.permissionCheckInterval);\r\n        // Try to get the current position again if permissions are granted\r\n        const coordinates = await Geolocation.getCurrentPosition();\r\n        this.coordinates = coordinates;\r\n        this.LatLng = {\r\n          lat: coordinates.coords.latitude,\r\n          lng: coordinates.coords.longitude,\r\n        };\r\n        console.log('Geolocation initialized:', this.LatLng);\r\n  \r\n        // Start polling the user's position\r\n        this.startPollingPosition();\r\n      }\r\n    }, 1000); // Check every second\r\n  }\r\n\r\n  \r\n  startPollingPosition() {\r\n    let lastLatLng = { lat: null, lng: null };\r\n    let lastAddress = null;\r\n  \r\n    this.pollingInterval = setInterval(async () => {\r\n      try {\r\n        let position;\r\n        \r\n        if (this.platform.is('capacitor')) {\r\n          position = await Geolocation.getCurrentPosition();\r\n        } else {\r\n          // Web fallback\r\n          position = await new Promise((resolve, reject) => {\r\n            navigator.geolocation.getCurrentPosition(resolve, reject);\r\n          });\r\n        }\r\n\r\n        const newLatLng = {\r\n          lat: position.coords.latitude,\r\n          lng: position.coords.longitude,\r\n        };\r\n\r\n        await this.database.updateLocation(newLatLng);\r\n  \r\n        if (this.hasSignificantLocationChange(lastLatLng, newLatLng, 50)) { // Check if moved at least 50 meters\r\n          lastLatLng = newLatLng;\r\n  \r\n          const address = await this.map.getAddress(newLatLng.lat, newLatLng.lng);\r\n          \r\n          if (address && address.results && address.results.length > 1) {\r\n            const components = address.results[1].address_components;\r\n            if (components.length >= 2) {\r\n              this.locationAddress = components[0].long_name + ' ' + components[1].long_name;\r\n              this.actualLocation = address.results[0].formatted_address;\r\n              if (this.locationAddress !== lastAddress) {\r\n                console.log('Updated Location Address:', this.locationAddress);\r\n                lastAddress = this.locationAddress;\r\n              }\r\n            }\r\n          } else {\r\n            console.log('Unable to update location address');\r\n          }\r\n        }\r\n  \r\n        if (this.networkService.isConnected() && !this.stopPolling) {\r\n          // Don't fetch drivers if we're in a stage where drivers are already selected\r\n          // This prevents overwriting the drivers_Requested array during booking flow\r\n          if (this.confirmStage || this.searchingStage || this.trackingStage || this.drivingToDestinationStage) {\r\n            console.log('Skipping driver fetch - already in booking/tracking stage');\r\n          } else {\r\n            const center: [number, number] = [newLatLng.lat, newLatLng.lng];\r\n            const radiusInM = 8000; // Example radius in meters\r\n            // Only fetch drivers if map is initialized to prevent race condition\r\n            if (this.mapy && this.map && this.map.newMap) {\r\n              await this.fetchAndDisplayDrivers(center, radiusInM);\r\n            } else {\r\n              console.log('Map not yet initialized, skipping driver fetch');\r\n            }\r\n          }\r\n        } else {\r\n          console.log('No network connection.', this.stopPolling);\r\n        }\r\n      } catch (err) {\r\n        console.error('Error getting position:', err);\r\n        // Reduce error alerts by not showing specific errors repeatedly\r\n      }\r\n    }, 3000); // Poll every 3 seconds for more responsive location updates\r\n  }\r\n  \r\n  hasSignificantLocationChange(oldLatLng, newLatLng, minDistance) {\r\n    if (!oldLatLng.lat || !oldLatLng.lng) return true;\r\n    \r\n    const R = 6371e3; // Earth radius in meters\r\n    const 1 = oldLatLng.lat * Math.PI/180;\r\n    const 2 = newLatLng.lat * Math.PI/180;\r\n    const  = (newLatLng.lat - oldLatLng.lat) * Math.PI/180;\r\n    const  = (newLatLng.lng - oldLatLng.lng) * Math.PI/180;\r\n  \r\n    const a = Math.sin(/2) * Math.sin(/2) +\r\n              Math.cos(1) * Math.cos(2) *\r\n              Math.sin(/2) * Math.sin(/2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\r\n  \r\n    const distance = R * c; // Distance in meters\r\n  \r\n    return distance >= minDistance;\r\n  }\r\n\r\n  \r\n  stopPollingPosition() {\r\n    if (this.pollingInterval) {\r\n      clearInterval(this.pollingInterval);\r\n      this.pollingInterval = null;\r\n      console.log('Stopped polling position.');\r\n    } else {\r\n      console.log('No polling to stop.');\r\n    }\r\n  }\r\n  \r\n  async initializeMap() {\r\n    try {\r\n      // Ensure coordinates are available before creating map\r\n      \r\n      if (!this.coordinates || !this.coordinates.coords) {\r\n         await this.overlay.showAlert('Coordinates not available, using default location', '');\r\n        console.warn('Coordinates not available, using default location');\r\n        // Use default coordinates (Kuala Lumpur, Malaysia)\r\n        this.coordinates = {\r\n          coords: {\r\n            latitude: 3.1390,\r\n            longitude: 101.6869,\r\n            accuracy: 0,\r\n            altitude: null,\r\n            altitudeAccuracy: null,\r\n            heading: null,\r\n            speed: null\r\n          },\r\n          timestamp: Date.now()\r\n        };\r\n      }\r\n      \r\n      await this.map.createMap(this.mapRef.nativeElement, this.coordinates);\r\n      this.mapy = true;\r\n      this.actualLocation = this.map.actualLocation;\r\n     // console.log('Map initialized:', this.actualLocation, this.locationAddress);\r\n    } catch (error) {\r\n      this.overlay.showAlert('Error initializing map:', error);\r\n      throw new Error('Map initialization failed');\r\n    }\r\n  }\r\n  \r\n  initializeDatabaseSubscriptions() {\r\n    this.database.getKnownPlaces().subscribe((d) => {\r\n      console.log('Received data:', d);\r\n      this.places = d.slice(0, 3);\r\n    });\r\n  }\r\n\r\n\r\n  initializeBackButtonCustomHandler(): void {\r\n    this.platform.backButton.subscribeWithPriority(10, () => {\r\n      console.log('Back button pressed');\r\n    });\r\n  \r\n    App.addListener('backButton', ({ canGoBack }) => {\r\n      if (!canGoBack) {\r\n        // Show a confirmation dialog before exiting the app\r\n        if (confirm('Are you sure you want to exit the app?')) {\r\n          App.exitApp();\r\n        }\r\n      } else {\r\n        console.log(\"back clicked\");\r\n        // Use Ionic's NavController to navigate back\r\n        // Replace 'NavController' with your specific navigation method\r\n        // this.navCtrl.pop();\r\n        window.history.back();\r\n      }\r\n    });\r\n\r\n    // App.addListener('appStateChange', (state) => {\r\n    //   if (!state.isActive) {\r\n    //     this.stopPollingPosition();\r\n    //   } else {\r\n    //     this.startPollingPosition();\r\n    //   }\r\n    // });\r\n  }\r\n  \r\n\r\n\r\n  \r\n  setupMapListeners() {\r\n    this.map.newMap.setOnCameraIdleListener(async (g) => {\r\n      this.ngZone.run(async () => {\r\n        this.showResetLocationButton = true;\r\n        if (this.mapPinStage) {\r\n          const addressResponse = await this.geocode.getAddress(g.latitude, g.longitude).toPromise();\r\n          this.processAddressResponse(addressResponse);\r\n        }\r\n      });\r\n    });\r\n  }\r\n  \r\n  async logout() {\r\n    await this.authService.logout();\r\n  }\r\n  \r\n  async fetchAndDisplayDrivers(center: [number, number], radiusInM: number): Promise<void> {\r\n    try {\r\n      const drivers: Drivers[] = await this.database.checkDriversWithin(center, radiusInM);\r\n      console.log('Fetched drivers:', drivers);\r\n  \r\n      await this.handleDrivers(drivers);\r\n  \r\n      if (this.drivers_Requested.length > 0) {\r\n        this.current_Request_Number = 0; // Set to the first available driver\r\n        this.NoDrivers = false;\r\n        // Only update markers if map is initialized\r\n        if (this.map && this.map.newMap && this.mapy) {\r\n          await this.UpdateCarMarker(this.drivers_Requested);\r\n        }\r\n      } else {\r\n        // Keep current_Request_Number at 0 (not -1) - we'll check array length instead\r\n        this.NoDrivers = true;\r\n        // Only update markers if map is initialized\r\n        if (this.map && this.map.newMap && this.mapy) {\r\n          await this.UpdateCarMarker([]); // Clear all markers if no drivers are requested\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching drivers:', error);\r\n      // Don't reset driver data on errors - preserve any valid drivers we already have\r\n      // The error might just be a map issue, not a driver fetch issue\r\n      console.log('Preserving existing driver data. drivers_Requested length:', this.drivers_Requested?.length);\r\n      // Try to update markers only if map is initialized\r\n      if (this.map && this.map.newMap && this.mapy) {\r\n        await this.UpdateCarMarker([]).catch(e => console.warn('Could not clear markers:', e));\r\n      }\r\n    }\r\n  }\r\n  \r\n  \r\n  async handleDrivers(drivers: Drivers[]) {\r\n    // TRACE: Log when and from where drivers_Requested is being reset\r\n    console.log('handleDrivers called - RESETTING drivers_Requested. Stack trace:');\r\n    console.trace('handleDrivers called from:');\r\n    \r\n    this.drivers_Requested = [];\r\n    this.closeDrivers = null;\r\n  \r\n    console.log('Handling drivers:', drivers);\r\n  \r\n    if (drivers.length === 0) {\r\n      this.NoDrivers = true;\r\n      console.log('No drivers found.');\r\n      return;\r\n    }\r\n  \r\n    drivers.forEach((driver) => {\r\n      if (driver) {\r\n        console.log('Processing driver:', driver);\r\n        // Duration is in milliseconds - allow drivers within 60 minutes (3600000ms)\r\n        if (driver.duration <= 3600000 && driver.onlineState) {\r\n          this.drivers_Requested.push(driver);\r\n          this.updateDriverInfo(driver);\r\n        }\r\n  \r\n        if (!this.closeDrivers || driver.duration < this.closeDrivers.duration) {\r\n          this.closeDrivers = driver;\r\n        }\r\n      } else {\r\n        console.error('Driver is null or undefined:', driver);\r\n      }\r\n    });\r\n  \r\n    if (this.drivers_Requested.length === 0) {\r\n      this.NoDrivers = true;\r\n      this.current_Request_Number = 0;  // Keep at 0, not -1\r\n      console.log('No valid drivers after filtering. NoDrivers:', this.NoDrivers);\r\n    } else {\r\n      this.NoDrivers = false;\r\n      // Always ensure current_Request_Number is within valid range\r\n      this.current_Request_Number = Math.max(0, Math.min(this.current_Request_Number, this.drivers_Requested.length - 1));\r\n      console.log('Valid drivers found. current_Request_Number:', this.current_Request_Number, 'Total:', this.drivers_Requested.length);\r\n    }\r\n  \r\n    console.log('Final requested drivers list:', this.drivers_Requested);\r\n  }\r\n  \r\n   // Unsubscribe from all active listeners (for cleanup)\r\n   cleanupListeners() {\r\n    Object.values(this.database.activeListeners).forEach(unsubscribe => unsubscribe());\r\n    this.database.activeListeners = {};\r\n  }\r\n \r\n  \r\n  updateDriverInfo(driver) {\r\n    console.log(this.drivers_Requested);\r\n    this.carname = driver.Driver_car;\r\n    this.driverImage = driver.Driver_imgUrl,\r\n    this.driver_duration_apart = Math.ceil(driver.duration / 60000);\r\n    this.driver_ID = driver.Driver_id;\r\n    this.driver_number_of_seats = driver.seats;\r\n    this.DriverLatLng = {\r\n      lat: driver.Driver_lat,\r\n      lng: driver.Driver_lng\r\n    };\r\n  }\r\n  \r\n  async StartRide() {\r\n    console.log('=== StartRide called ===');\r\n    console.log('StartRide - drivers_Requested BEFORE anything:', this.drivers_Requested?.length, this.drivers_Requested);\r\n    console.log('StartRide - current_Request_Number:', this.current_Request_Number);\r\n    console.log('StartRide - stopPolling:', this.stopPolling);\r\n    \r\n    if (this.isLoadingDriver) {\r\n      console.log('Ride request already in progress...');\r\n      return;\r\n    }\r\n\r\n    this.isLoadingDriver = true;\r\n    this.overlay.showLoader('Preparing your ride...');\r\n\r\n    try {\r\n      // Group operations that can be done concurrently\r\n      await Promise.all([\r\n        this.clearPrevMarkers(),\r\n        this.clearAllPolylines()\r\n      ]);\r\n      \r\n      this.map.newMap.enableTouch();\r\n      await this.BookRide();\r\n      \r\n    } catch (error) {\r\n      console.error('Error starting ride:', error);\r\n      await this.overlay.showAlert('Starting Ride Error', error.message || 'Failed to start ride');\r\n    } finally {\r\n      // Ensure we always hide the loader and reset the loading state\r\n      this.isLoadingDriver = false;\r\n      this.overlay.hideLoader();\r\n    }\r\n  }\r\n\r\nasync clearMarkers() {\r\n  // Check if map is initialized\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized when clearing markers');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    if (this.marker1 !== null && this.marker1 !== undefined) {\r\n      await this.map.newMap.removeMarker(this.marker1).catch(e => \r\n        console.error('Error removing marker1:', e)\r\n      );\r\n      this.marker1 = null;\r\n    }\r\n\r\n    if (this.marker2 !== null && this.marker2 !== undefined) {\r\n      await this.map.newMap.removeMarker(this.marker2).catch(e => \r\n        console.error('Error removing marker2:', e)\r\n      );\r\n      this.marker2 = null;\r\n    }\r\n\r\n    if (this._carmarkers && Array.isArray(this._carmarkers)) {\r\n      for (const { marker } of this._carmarkers) {\r\n        if (marker !== null && marker !== undefined) {\r\n          await this.map.newMap.removeMarker(marker).catch(e => \r\n            console.error('Error removing car marker:', e)\r\n          );\r\n        }\r\n      }\r\n      this._carmarkers = [];\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in clearMarkers:', error);\r\n  }\r\n}\r\n\r\nasync BookRide() {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    \r\n    // Debug logging to trace the issue\r\n    console.log('BookRide called - current_Request_Number:', this.current_Request_Number);\r\n    console.log('BookRide called - drivers_Requested:', this.drivers_Requested);\r\n    console.log('BookRide called - drivers_Requested length:', this.drivers_Requested?.length);\r\n    \r\n    // If no valid driver, try to refresh driver list first\r\n    if (!this.hasValidDriver()) {\r\n      console.log('No valid driver found, attempting to refresh driver list...');\r\n      \r\n      // Try to fetch drivers again if we have a valid location\r\n      if (this.LatLng?.lat && this.LatLng?.lng) {\r\n        const center: [number, number] = [this.LatLng.lat, this.LatLng.lng];\r\n        const radiusInM = 8000;\r\n        \r\n        // Fetch drivers directly without map dependency\r\n        const drivers = await this.database.checkDriversWithin(center, radiusInM);\r\n        console.log('Refreshed drivers:', drivers);\r\n        \r\n        await this.handleDrivers(drivers);\r\n        console.log('After refresh - drivers_Requested:', this.drivers_Requested?.length);\r\n        console.log('After refresh - current_Request_Number:', this.current_Request_Number);\r\n      }\r\n      \r\n      // Check again after refresh\r\n      if (!this.hasValidDriver()) {\r\n        this.showNoDriversAlert();\r\n        return;\r\n      }\r\n    }\r\n    \r\n    const driver = this.drivers_Requested[this.current_Request_Number];\r\n    console.log('Selected driver:', driver);\r\n    \r\n    const userDocRef = doc(this.firestore, `Drivers`, driver.Driver_id);\r\n    \r\n    const docSnapshot = await getDoc(userDocRef);\r\n    \r\n    if (!docSnapshot.exists()) {\r\n      throw new Error('Driver document not found');\r\n    }\r\n\r\n    const data = docSnapshot.data();\r\n    if (!data?.onlineState) {\r\n      await this.handleNoAvailableDriver();\r\n      return;\r\n    }\r\n\r\n    this.driverInfo = data;\r\n    await this.requestRideWithDriverDetails(driver, userDocRef);\r\n    this.updateDriverInfo(driver);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in BookRide:', error);\r\n    this.overlay.showAlert('Error', 'Unable to book ride. Please try again.');\r\n  }\r\n}\r\n\r\nhasValidDriver(): boolean {\r\n  // Debug: Show full driver object structure\r\n  console.log('=== hasValidDriver DEBUG ===');\r\n  console.log('Full drivers_Requested array:', JSON.stringify(this.drivers_Requested, null, 2));\r\n  \r\n  if (this.drivers_Requested?.length > 0 && this.current_Request_Number >= 0) {\r\n    const currentDriver = this.drivers_Requested[this.current_Request_Number];\r\n    console.log('Current driver object:', currentDriver);\r\n    console.log('Current driver keys:', currentDriver ? Object.keys(currentDriver) : 'N/A');\r\n  }\r\n  \r\n  const isValid = this.drivers_Requested?.length > 0 && \r\n                  this.current_Request_Number >= 0 && \r\n                  this.current_Request_Number < this.drivers_Requested.length &&\r\n                  this.drivers_Requested[this.current_Request_Number]?.Driver_id != null;\r\n  \r\n  console.log('hasValidDriver check:', {\r\n    driversLength: this.drivers_Requested?.length,\r\n    currentRequestNum: this.current_Request_Number,\r\n    hasDriverId: this.drivers_Requested?.[this.current_Request_Number]?.Driver_id,\r\n    isValid\r\n  });\r\n  \r\n  return isValid;\r\n}\r\n\r\nasync requestRideWithDriverDetails(driver, userDocRef) {\r\n  try {\r\n    if (!await this.ensureProfileInitialized()) {\r\n      throw new Error('Profile not initialized');\r\n    }\r\n    \r\n    // Store original price before any discounts\r\n    this.originalPrice = this.price;\r\n    \r\n    const requestDetails = {\r\n      latLng: this.LatLng,\r\n      destinationAddress: this.destinationAddress,\r\n      locationAddress: this.locationAddress,\r\n      dLatLng: this.D_LatLng,\r\n      driverId: driver.Driver_id,\r\n      price: this.price,\r\n      cash: this.cash,\r\n      // Shared ride fields\r\n      sharedRideAccepted: this.sharedRideEnabled,\r\n      isSharedRide: false,  // Will be set to true when matched\r\n      sharedRideId: null,   // Will be set when matched\r\n      originalPrice: this.price,\r\n      discountedPrice: this.price,  // Initially same as original\r\n      discountPercent: 0\r\n    };\r\n\r\n    this.requestID = await this.database.RequestRideWithRiderDetails(requestDetails);\r\n\r\n    if (this.requestID) {\r\n      this.currentDriver = driver;\r\n      \r\n      // Set up listener before handling pending state\r\n      const rideRequestDocRef = doc(this.firestore, `Request`, this.requestID);\r\n      const unsub = onSnapshot(rideRequestDocRef, async (doc) => {\r\n        if (doc.exists()) {\r\n          await this.handleRideUpdates(doc);\r\n        } else {\r\n          console.error('Ride request document does not exist.');\r\n        }\r\n      });\r\n\r\n      this.unsubscribe = unsub;\r\n      \r\n      // Now handle the pending state\r\n      await this.handlePendingState();\r\n    } else {\r\n      throw new Error('Failed to generate requestID');\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in requestRideWithDriverDetails:', error);\r\n    this.overlay.showAlert('Error', 'Unable to request ride. Please try again.');\r\n  }\r\n}\r\n\r\nshowNoDriversAlert() {\r\n  console.error('No valid driver available to book a ride.');\r\n  this.overlay.showAlert('No Drivers ', 'No available drivers found. Please try again later.');\r\n}\r\n\r\nasync handleNoAvailableDriver() {\r\n  console.log('Driver is not available, moving to next.');\r\n  this.current_Request_Number++;\r\n  if (this.hasValidDriver()) {\r\n    await this.BookRide();\r\n  } else {\r\n    this.showNoDriversAlert();\r\n  }\r\n}\r\n\r\n// Make sure to clear the subscription when it's no longer needed\r\nclearSubscriptions() {\r\n  console.log('Clearing all subscriptions');\r\n  \r\n  // Clear routeUpdateSubscription first as it's the main culprit\r\n  if (this.routeUpdateSubscription) {\r\n    this.routeUpdateSubscription.unsubscribe();\r\n    this.routeUpdateSubscription = null;\r\n  }\r\n  \r\n  // Clear other subscriptions\r\n  if (this.numCalls) {\r\n    this.numCalls.unsubscribe();\r\n    this.numCalls = null;\r\n  }\r\n  if (this.countDown) {\r\n    this.countDown.unsubscribe();\r\n    this.countDown = null;\r\n  }\r\n  if (this.unsubscribe) {\r\n    this.unsubscribe();\r\n    this.unsubscribe = null;\r\n  }\r\n  \r\n  // Stop any polling interval\r\n  if (this.pollingInterval) {\r\n    clearInterval(this.pollingInterval);\r\n    this.pollingInterval = null;\r\n  }\r\n  \r\n  // Reset any animation state\r\n  this.animatedMarker = null;\r\n}\r\n\r\nasync handleRideUpdates(doc) {\r\n  const data = doc.data();\r\n  if (!data) return;\r\n\r\n  try {\r\n    switch (data.status) {\r\n      case 'confirmed':\r\n        await this.handleRideConfirmation(doc);\r\n        break;\r\n      case 'started':\r\n        await this.handleRideStart(doc);\r\n        break;\r\n      case 'done':\r\n        await this.handleRideStop(doc);\r\n        break;\r\n      case 'cancelled':\r\n        await this.handleRideCancellation(data);\r\n        break;\r\n    }\r\n  } catch (error) {\r\n    console.error('Error handling ride updates:', error);\r\n    if (error.code === 'permission-denied' || error.code === 'not-found') {\r\n      await this.ReturnHome();\r\n    }\r\n  }\r\n}\r\n\r\n\r\nasync handlePendingState() {\r\n  try {\r\n    // Don't show another loader here since BookRide is already showing one\r\n    if (!this.currentDriver?.Driver_id) {\r\n      throw new Error('No valid driver ID found');\r\n    }\r\n\r\n    // Get driver location with timeout\r\n    const locationPromise = this.getDriverLocation(this.currentDriver.Driver_id);\r\n    const timeoutPromise = new Promise((_, reject) => \r\n      setTimeout(() => reject(new Error('Location fetch timeout')), 10000)\r\n    );\r\n    \r\n    await Promise.race([locationPromise, timeoutPromise]);\r\n\r\n    if (!this.DriverLatLng) {\r\n      throw new Error('Failed to get driver location');\r\n    }\r\n\r\n    // Group all map operations\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly),\r\n      this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.DriverLatLng\r\n      })\r\n    ]);\r\n    \r\n    // Update map height properly instead of using fixed positioning\r\n    this.ngZone.run(() => {\r\n      this.setMapHeightHandleDrivertoRider();\r\n    });\r\n    \r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n    this.EnterSearchingStage();\r\n    await this.startCountdown(20, this.requestID);\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handlePendingState:', error);\r\n    throw error; // Let BookRide handle the error and cleanup\r\n  }\r\n}\r\n\r\n\r\nasync presentCancelRideActionSheet() {\r\n  const actionSheet = await this.actionSheetController.create({\r\n    header: 'Cancel Ride',\r\n    buttons: [\r\n      {\r\n        text: 'Changed my mind',\r\n        handler: () => {\r\n          this.cancelRide('Changed my mind');\r\n        }\r\n      },\r\n      {\r\n        text: 'Driver took too long',\r\n        handler: () => {\r\n          this.cancelRide('Driver took too long');\r\n        }\r\n      },\r\n      {\r\n        text: 'Found another ride',\r\n        handler: () => {\r\n          this.cancelRide('Found another ride');\r\n        }\r\n      },\r\n      {\r\n        text: 'Other',\r\n        handler: () => {\r\n          this.cancelRide('Other');\r\n        }\r\n      },\r\n      {\r\n        text: 'Cancel',\r\n        role: 'cancel'\r\n      }\r\n    ]\r\n  });\r\n  await actionSheet.present();\r\n}\r\n\r\nasync cancelRide(reason: string) {\r\n  const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n  await updateDoc(rideRef, {\r\n    status: 'cancelled',\r\n    cancellationReason: reason,\r\n    canceledBy: 'rider'\r\n  });\r\n  const toast = await this.toastController.create({\r\n    message: 'Ride has been cancelled.',\r\n    duration: 2000\r\n  });\r\n  await toast.present();\r\n}\r\n\r\n\r\n\r\nasync handleRideCancellation(data) {\r\n  this.stopCountdown();\r\n  await this.clearPrevMarkers();\r\n  this.unsubscribe();\r\n  this.clearSubscriptions();\r\n  if (this.drivers_Requested[this.current_Request_Number + 1] && !this.rideHasStarted) {\r\n    this.current_Request_Number++;\r\n    await this.BookRide();\r\n        } else {\r\n    if (data.canceledBy == 'driver') {\r\n      this.overlay.showAlert('Cancelled', 'Driver cancelled');\r\n    } \r\n    this.ClearRide();\r\n      this.ReturnHome();\r\n  }\r\n}\r\n\r\n\r\nasync handleRideStart(doc) {\r\n  try {\r\n    console.log('Starting ride tracking setup...');\r\n    \r\n    // Clear previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearPolyline(this.newPoly);\r\n    \r\n    // Get ride data and validate\r\n    const data = doc.data();\r\n    if (!data) {\r\n      console.warn('handleRideStart: No data found in document');\r\n      throw new Error('No ride data available');\r\n    }\r\n    \r\n    console.log('handleRideStart data:', data);\r\n    \r\n    // Set ride state flag first to prevent race conditions\r\n    this.rideHasStarted = true;\r\n    \r\n    // Set current driver from document data with fallback options\r\n    if (data.driverDetails) {\r\n      this.currentDriver = data.driverDetails;\r\n      this.driverInfo = data.driverDetails;\r\n    } else if (data.driverId) {\r\n      console.log('Driver details missing, attempting to fetch from driver ID');\r\n      try {\r\n        const driverDoc = await getDoc(doc(this.firestore, 'Drivers', data.driverId));\r\n        if (driverDoc.exists()) {\r\n          this.driverInfo = driverDoc.data();\r\n          this.currentDriver = this.driverInfo;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Failed to fetch driver details:', error);\r\n        // Continue with limited driver info\r\n      }\r\n    }\r\n    \r\n    // Adjust map height before adding markers\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    // window.addEventListener('resize', this.setMapHeightHandleDrivertoDestination.bind(this));\r\n    \r\n    // Initialize locations with fallbacks\r\n    this.LatLng = {\r\n      lat: data.Loc_lat || (this.LatLng?.lat || 0),\r\n      lng: data.Loc_lng || (this.LatLng?.lng || 0)\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: data.Des_lat || (this.D_LatLng?.lat || 0),\r\n      lng: data.Des_lng || (this.D_LatLng?.lng || 0)\r\n    };\r\n    \r\n    // Ensure map is initialized\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized in handleRideStart, initializing now...');\r\n      try {\r\n        await this.initializeMap();\r\n      } catch (mapError) {\r\n        console.error('Failed to initialize map:', mapError);\r\n        // Allow continuation with limited functionality\r\n      }\r\n    }\r\n    \r\n    // Get driver location with better error handling\r\n    let driverLocationFetched = false;\r\n    \r\n    if (data.driverId) {\r\n      try {\r\n        console.log('Fetching driver location for ID:', data.driverId);\r\n        \r\n        // Use Promise.race with a timeout to prevent hanging\r\n        const locationPromise = this.database.getDriverLocation(data.driverId);\r\n        const timeoutPromise = new Promise((_, reject) => \r\n          setTimeout(() => reject(new Error('Driver location fetch timeout')), 5000)\r\n        );\r\n        \r\n        const driverLocation = await Promise.race([locationPromise, timeoutPromise]) as any;\r\n        \r\n        if (driverLocation && typeof driverLocation === 'object' && 'lat' in driverLocation && 'lng' in driverLocation) {\r\n          console.log('Got real-time driver location:', driverLocation);\r\n          this.DriverLatLng = {\r\n            lat: driverLocation.lat,\r\n            lng: driverLocation.lng\r\n          };\r\n          driverLocationFetched = true;\r\n        }\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location:', locationError);\r\n        // Will use fallback below\r\n      }\r\n    }\r\n    \r\n    // Fallback to location in document if real-time fetch failed\r\n    if (!driverLocationFetched) {\r\n      console.log('Using driver location from document data');\r\n      this.DriverLatLng = {\r\n        lat: data.driverDetails?.Driver_lat || data.driver_lat || this.LatLng.lat,\r\n        lng: data.driverDetails?.Driver_lng || data.driver_lng || this.LatLng.lng\r\n      };\r\n    }\r\n    \r\n    // Setup UI state even if visualization might fail\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Proceed with visualization if we have valid coordinates\r\n    if (this.DriverLatLng?.lat && this.D_LatLng?.lat) {\r\n      console.log('Calling handleRiderToDestination with locations:', \r\n                  'Driver:', this.DriverLatLng, \r\n                  'Destination:', this.D_LatLng);\r\n      \r\n      try {\r\n        await this.handleRiderToDestination(this.DriverLatLng, this.D_LatLng);\r\n      } catch (visualError) {\r\n        console.warn('Failed to visualize route, but ride is still active:', visualError);\r\n        // Show a non-blocking toast or notification\r\n        const toast = await this.toastController.create({\r\n          message: 'Route visualization failed, but your ride is still active',\r\n          duration: 3000\r\n        });\r\n        toast.present();\r\n      }\r\n    } else {\r\n      console.warn('Invalid coordinates for visualization:', this.DriverLatLng, this.D_LatLng);\r\n      const toast = await this.toastController.create({\r\n        message: 'Location data incomplete. Your ride is active but not fully visualized.',\r\n        duration: 3000\r\n      });\r\n      toast.present();\r\n    }\r\n    \r\n    console.log('Ride tracking setup completed successfully');\r\n    \r\n  } catch (error) {\r\n    console.error('Error in handleRideStart:', error);\r\n    \r\n    // Still enter driving stage so user can see at least some UI\r\n    this.EnterDrivingToDestinationStage();\r\n    this.canCheck = true;\r\n    \r\n    // Show a less alarming message to the user\r\n    const toast = await this.toastController.create({\r\n      message: 'Some ride details couldn\\'t be loaded. Your ride is still active.',\r\n      duration: 3000\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n// Improve handleRideStop to better handle map errors\r\nasync handleRideStop(docSnapshot) {\r\n  try {\r\n    console.log('Handling ride stop...');\r\n    \r\n    // If already processed, exit immediately\r\n    if (this.isRideStopProcessed) {\r\n      console.log('Ride stop already processed, exiting function');\r\n      return;\r\n    }\r\n    \r\n    // Set flag immediately to prevent re-processing\r\n    this.isRideStopProcessed = true;\r\n    \r\n    // Stop all location polling and mapping activities immediately\r\n    this.stopPolling = true;\r\n    \r\n    // Unsubscribe from route updates first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Then clear other subscriptions\r\n    this.clearSubscriptions();\r\n    \r\n    // Force removal of all map elements with multiple attempts if needed\r\n    for (let attempt = 0; attempt < 3; attempt++) {\r\n      try {\r\n        await this.clearPrevMarkers();\r\n        await this.clearAllPolylines();\r\n        break; // Exit loop if successful\r\n      } catch (e) {\r\n        console.error(`Map cleanup attempt ${attempt + 1} failed:`, e);\r\n        // Short delay before retry\r\n        await new Promise(resolve => setTimeout(resolve, 100));\r\n      }\r\n    }\r\n    \r\n    // Prepare ride data with proper fallbacks for required fields\r\n    const docData = docSnapshot.data ? docSnapshot.data() : docSnapshot;\r\n    const tripId = docSnapshot.id || this.requestID;\r\n    \r\n    \r\n    const rideData = {\r\n      tripId: tripId || '',\r\n      riderId: this.database.user?.uid || '',\r\n      driverId: docData?.driverDetails?.Driver_id || this.driverInfo?.Driver_id || '',\r\n      driverName: docData?.driverDetails?.Driver_name || this.driverInfo?.Driver_name || 'Unknown Driver',\r\n      driverImage: docData?.driverDetails?.Driver_imgUrl || this.driverInfo?.Driver_imgUrl || '',\r\n      driverCar: docData?.driverDetails?.Driver_car || this.driverInfo?.Driver_car || '',\r\n      driverPlate: docData?.driverDetails?.Driver_plate || this.driverInfo?.Driver_plate || '',\r\n      driverRating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      pickup: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      destination: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      locationAddress: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      destinationAddress: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      Loc_lat: docData?.Loc_lat || this.LatLng?.lat || 0,\r\n      Loc_lng: docData?.Loc_lng || this.LatLng?.lng || 0,\r\n      Des_lat: docData?.Des_lat || this.D_LatLng?.lat || 0,\r\n      Des_lng: docData?.Des_lng || this.D_LatLng?.lng || 0,\r\n      Rider_Location: docData?.Rider_Location || this.locationAddress || 'Unknown pickup',\r\n      Rider_Destination: docData?.Rider_Destination || this.destinationAddress || 'Unknown destination',\r\n      Driver_name: docData?.driverDetails?.Driver_name || this.driverInfo?.Driver_name || 'Unknown Driver',\r\n      Driver_car: docData?.driverDetails?.Driver_car || this.driverInfo?.Driver_car || '',\r\n      Driver_plate: docData?.driverDetails?.Driver_plate || this.driverInfo?.Driver_plate || '',\r\n      Driver_imgUrl: docData?.driverDetails?.Driver_imgUrl || this.driverInfo?.Driver_imgUrl || '',\r\n      Driver_rating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      price: docData?.price || this.price || 0,\r\n      distance: docData?.distance || this.distance || 0,\r\n      duration: docData?.duration || this.duration || '',\r\n      rating: docData?.driverDetails?.Driver_rating || this.driverInfo?.Driver_rating || 0,\r\n      completed: true,\r\n      completedAt: new Date(),\r\n      timestamp: new Date()\r\n    };\r\n\r\n    // Process payment at the end of the ride (if not using cash)\r\n    if (!this.cash && this.selectedCard && this.selectedCard !== 'cash' && !this.paymentProcessed && !docData?.paymentProcessed) {\r\n      // Check if we're already processing payment for this exact ride\r\n      if (this.processingPaymentForRide === this.requestID) {\r\n        console.log('Payment already being processed for this ride, skipping...');\r\n      } else {\r\n        // Set the processing flag IMMEDIATELY before any async operations\r\n        this.processingPaymentForRide = this.requestID;\r\n        try {\r\n          await this.processRidePayment(docData);\r\n        } finally {\r\n          // Clear the processing flag after completion (success or failure)\r\n          this.processingPaymentForRide = null;\r\n        }\r\n      }\r\n    } else if (docData?.paymentProcessed) {\r\n      // Payment was already processed, just update the flag\r\n      console.log('Payment already processed for this ride');\r\n      this.paymentProcessed = true;\r\n    }\r\n\r\n    // Save to ride history BEFORE showing modal\r\n    try {\r\n      console.log('Saving ride history with data:', rideData);\r\n      await this.database.saveRideHistory(rideData);\r\n      console.log('Ride history saved successfully');\r\n    } catch (historyError) {\r\n      console.error('Failed to save ride history:', historyError);\r\n      // Don't block the modal from showing even if history save fails\r\n    }\r\n\r\n    // CRITICAL: Clear ride state from storage BEFORE showing modal\r\n    try {\r\n      await Preferences.remove({ key: this.RIDE_STATE_KEY });\r\n      console.log('Cleared ride state from storage');\r\n    } catch (e) {\r\n      console.warn('Error clearing storage:', e);\r\n    }\r\n\r\n    // Reset ride properties BEFORE showing modal\r\n    this.rideHasStarted = false;\r\n    this.driverLocation = null;\r\n    this.lastHandledState = null;\r\n    \r\n    console.log('Showing trip summary with data:', rideData);\r\n    \r\n    // Show the trip summary\r\n    const modal = await this.modalCtrl.create({\r\n      component: TripSummaryComponent,\r\n      componentProps: { rideData }\r\n    });\r\n    \r\n    await modal.present();\r\n    \r\n    // Clean up once modal is dismissed\r\n    modal.onDidDismiss().then(async () => {\r\n      console.log('Trip summary dismissed, resetting state');\r\n      this.isRideStopProcessed = false;\r\n      \r\n      // Comprehensive cleanup and return home\r\n      await this.clearRideState();\r\n      await this.ReturnHome();\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error in handleRideStop:', error);\r\n    this.isRideStopProcessed = false;\r\n    this.ReturnHome();\r\n  }\r\n}\r\n\r\n// Add this method for more thorough ride state cleanup\r\nprivate async clearRideState() {\r\n  console.log('Clearing ride state completely');\r\n  \r\n  // First clear all subscriptions\r\n  this.clearSubscriptions();\r\n  \r\n  // Clear visual elements from map\r\n  await this.clearPrevMarkers().catch(e => console.error('Error clearing markers:', e));\r\n  await this.clearAllPolylines().catch(e => console.error('Error clearing polylines:', e));\r\n  \r\n  // Reset all ride-related properties\r\n  this.requestID = null;\r\n  this.driverInfo = null;\r\n  this.currentDriver = null;\r\n  this.driver_marker = null;\r\n  this.rider_marker = null;\r\n  this.destinationMarker = null;\r\n  this.marker1 = null;\r\n  this.marker2 = null;\r\n  this.routePolyline = null;\r\n  this.routePath = null;\r\n  this.newPoly = null;\r\n  this.animatedMarker = null;\r\n  this.driverLocation = null;\r\n  this.isRideStopProcessed = false;\r\n  this.paymentProcessed = false;\r\n  this.processingPaymentForRide = null;\r\n  \r\n  // Reset driver/ride info\r\n  this.carname = null;\r\n  this.driverImage = null;\r\n  this.driver_duration_apart = null;\r\n  this.driver_ID = null;\r\n  this.driver_number_of_seats = null;\r\n  this.DriverLatLng = null;\r\n  this.rideHasStarted = false;\r\n  this.duration = null;\r\n  this.distance = null;\r\n  \r\n  // Reset destination data\r\n  this.destinationAddress = 'Unknown location';\r\n  this.actualDestination = null;\r\n  this.D_LatLng = { lat: null, lng: null };\r\n  this.price = null;\r\n  \r\n  // Clear car markers array\r\n  if (this._carmarkers && this._carmarkers.length > 0) {\r\n    for (const { marker } of this._carmarkers) {\r\n      if (marker !== null && marker !== undefined && this.map?.newMap) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error('Error removing car marker:', e)\r\n        );\r\n      }\r\n    }\r\n    this._carmarkers = [];\r\n  }\r\n  \r\n  // Reset drivers list\r\n  this.drivers_Requested = [];\r\n  this.NoDrivers = false;\r\n  \r\n  // Reset stage-related properties\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.noDriverStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.mapPinStage = false;\r\n  \r\n  // Set default stage\r\n  this.EnterBookingStage();\r\n  \r\n  // Reset polling state\r\n  this.stopPolling = false;\r\n  \r\n  // Reset current request number\r\n  this.current_Request_Number = 0;\r\n  \r\n  // Re-enable map interactions if needed\r\n  if (this.map && this.map.newMap) {\r\n    try {\r\n      await this.map.newMap.enableCurrentLocation(true);\r\n      this.map.newMap.enableTouch();\r\n    } catch (e) {\r\n      console.error('Error enabling map features:', e);\r\n    }\r\n  }\r\n  \r\n  console.log('Ride state cleared completely');\r\n}\r\n\r\n\r\n\r\nasync handleRideConfirmation(docOrData) {\r\n  try {\r\n    console.log('Starting ride confirmation handling...', docOrData);\r\n    this.stopCountdown();\r\n\r\n    // Clear existing markers and polylines\r\n    await Promise.all([\r\n      this.clearPrevMarkers(),\r\n      this.clearPolyline(this.newPoly)\r\n    ]);\r\n\r\n    // Get the ride data\r\n    let rideData;\r\n    let docId;\r\n    \r\n    if (!docOrData) {\r\n      throw new Error('Invalid input: null or undefined');\r\n    }\r\n    \r\n    // Handle different input types\r\n    if (typeof docOrData.data === 'function') {\r\n      // It's a Firebase DocumentSnapshot\r\n      rideData = docOrData.data();\r\n      docId = docOrData.id;\r\n    } else {\r\n      // It's already a data object from currentRide.data()\r\n      rideData = docOrData;\r\n      docId = this.requestID; // Use the current requestID if available\r\n    }\r\n    \r\n    if (!rideData) {\r\n      throw new Error('No ride data found');\r\n    }\r\n\r\n    // Update ride information\r\n    this.requestID = docId || rideData.requestId;\r\n    this.driverInfo = rideData.driverDetails;\r\n    \r\n    // Note: Payment processing moved to handleRideStop (end of ride)\r\n    // Check if payment was already processed\r\n    if (rideData.paymentProcessed) {\r\n      console.log('Payment already processed in previous session');\r\n      this.paymentProcessed = true;\r\n    }\r\n    \r\n    // Set driver information for UI display to avoid template errors\r\n    if (this.driverInfo) {\r\n      this.carname = this.driverInfo.Driver_car || 'Unknown Car';\r\n      this.driverImage = this.driverInfo.Driver_imgUrl || 'assets/icon/profile.png';\r\n      this.driver_ID = this.driverInfo.Driver_id;\r\n      this.driver_number_of_seats = this.driverInfo.seats || 4;\r\n      this.driver_duration_apart = this.driverInfo.duration ? \r\n        Math.ceil(this.driverInfo.duration / 60000) : 0;\r\n    }\r\n    \r\n    // Set locations\r\n    this.LatLng = {\r\n      lat: rideData.Loc_lat,\r\n      lng: rideData.Loc_lng\r\n    };\r\n    \r\n    this.D_LatLng = {\r\n      lat: rideData.Des_lat,\r\n      lng: rideData.Des_lng\r\n    };\r\n\r\n    // Initialize map if not already initialized\r\n    if (!this.map.newMap) {\r\n      await this.initializeMap();\r\n    }\r\n\r\n    // Check for shared ride match and subscribe to updates\r\n    await this.checkForSharedRideMatch(rideData);\r\n\r\n    // Get and wait for driver location\r\n    if (!this.driverInfo?.Driver_id) {\r\n      console.warn('Driver ID not found in driver details, using fallback location');\r\n      // Use fallback location from driver details\r\n      this.driverLocation = {\r\n        lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n        lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n      };\r\n    } else {\r\n      try {\r\n        await this.getDriverLocation(this.driverInfo.Driver_id);\r\n      } catch (locationError) {\r\n        console.warn('Error getting real-time driver location, using fallback:', locationError);\r\n        // Use fallback location from driver details\r\n        this.driverLocation = {\r\n          lat: this.driverInfo?.Driver_lat || this.driverInfo?.driver_lat,\r\n          lng: this.driverInfo?.Driver_lng || this.driverInfo?.driver_lng\r\n        };\r\n      }\r\n    }\r\n\r\n    if (!this.driverLocation?.lat || !this.driverLocation?.lng) {\r\n      throw new Error('Unable to determine driver location');\r\n    }\r\n\r\n    this.DriverLatLng = {\r\n      lat: this.driverLocation.lat,\r\n      lng: this.driverLocation.lng\r\n    };\r\n\r\n    console.log('Driver location set:', this.DriverLatLng);\r\n\r\n    // Set map height and add event listener\r\n    this.setMapHeightHandleDrivertoRider();\r\n    // window.addEventListener('resize', this.setMapHeightHandleDrivertoRider.bind(this));\r\n\r\n    // Initialize the map view with driver and rider markers\r\n    await this.handleDriverToRider(this.DriverLatLng, this.LatLng);\r\n\r\n    // Update UI state\r\n    this.EnterTrackingStage();\r\n    \r\n    // Save ride state to local storage\r\n    await this.saveRideStateToStorage();\r\n\r\n    console.log('Ride confirmation handled successfully');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error handling ride confirmation:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Add this method to save ride state to storage\r\nprivate async saveRideStateToStorage() {\r\n  try {\r\n    const rideState = {\r\n      requestID: this.requestID,\r\n      driverInfo: this.driverInfo,\r\n      LatLng: this.LatLng,\r\n      D_LatLng: this.D_LatLng,\r\n      DriverLatLng: this.DriverLatLng,\r\n      stage: this.getCurrentStage()\r\n    };\r\n    \r\n    await Preferences.set({\r\n      key: 'RIDE_STATE',\r\n      value: JSON.stringify(rideState)\r\n    });\r\n    \r\n    console.log('Ride state saved successfully');\r\n  } catch (error) {\r\n    console.error('Error saving ride state:', error);\r\n    // Don't throw the error as this is not critical\r\n  }\r\n}\r\n\r\n\r\n// Update getDriverLocation to return a Promise<void> and handle errors better\r\ngetDriverLocation(driverId: string): Promise<void> {\r\n  if (!driverId) {\r\n    return Promise.reject(new Error('No driver ID provided'));\r\n  }\r\n\r\n  console.log('Getting driver location for:', driverId);\r\n  return this.database.getDriverLocation(driverId)\r\n    .then(location => {\r\n      if (!location || !location.lat || !location.lng) {\r\n        throw new Error('Invalid location data received');\r\n      }\r\n      console.log('Driver location received:', location);\r\n      this.driverLocation = location;\r\n    })\r\n    .catch(error => {\r\n      console.error('Error getting driver location:', error);\r\n      throw error;\r\n    });\r\n}\r\n\r\n\r\n\r\nasync EnterChat(): Promise<void> {\r\nconst options: ModalOptions = {\r\n    component: EnrouteChatComponent,\r\n    componentProps: {\r\n        chatData: {\r\n            userId: this.requestID,\r\n            message: \"\"\r\n        }\r\n    },\r\n   \r\n};\r\n\r\nconst modal = await this.modalCtrl.create(options);\r\nreturn await modal.present();\r\n}\r\n\r\nasync startCountdown(initialTime, requestId) {\r\n  this.countdownActive = true;\r\n  let timeRemaining = initialTime;\r\n\r\n  const updateCountdown = async () => {\r\n    if (!this.countdownActive) {\r\n      console.log('Countdown stopped');\r\n      return;\r\n    }\r\n\r\n    if (timeRemaining > 0) {\r\n      try {\r\n        await this.database.UpdateCountDown(timeRemaining, requestId);\r\n        timeRemaining--;\r\n        setTimeout(updateCountdown, 1000);\r\n      } catch (error) {\r\n        console.error('Error updating countdown:', error);\r\n        // Retry after a short delay\r\n        setTimeout(updateCountdown, 2000);\r\n      }\r\n    } else {\r\n      await this.handleCountdownEnd(requestId);\r\n      console.log('Countdown ended');\r\n    }\r\n  };\r\n\r\n  updateCountdown();\r\n}\r\n\r\nasync handleCountdownEnd(requestId) {\r\n  try {\r\n    // Implement a grace period to account for any delays\r\n    setTimeout(async () => {\r\n      await this.clearPrevMarkers();\r\n      await this.requestNextDriver();\r\n    }, 5000); // 5-second grace period\r\n  } catch (error) {\r\n    console.error('Error handling countdown end:', error);\r\n    // Optionally, retry the operation or notify the user\r\n  }\r\n}\r\n\r\n\r\nstopCountdown() {\r\n  this.countdownActive = false;\r\n}\r\n\r\nasync goBackToAutoComplete() {\r\n  try {\r\n    this.stopPolling = false;\r\n    // Enable current location and set the camera to the initial position\r\n    await this.map.newMap.enableCurrentLocation(true);\r\n \r\n\r\n    await this.ResetState();\r\n\r\n    await this.showAutocompleteModal();\r\n    \r\n\r\n    console.log('Game state reset successfully');\r\n  } catch (error) {\r\n    console.error('Error resetting game state:', error);\r\n  }\r\n}\r\n\r\nprivate async clearPrevMarkers() {\r\n  try {\r\n    // Check if map is initialized\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing markers');\r\n      return; // Exit early if map is not available\r\n    }\r\n    \r\n    console.log('Clearing all markers...');\r\n    \r\n    // Clear individual markers with proper error handling\r\n    const markers = [\r\n      { ref: this.rider_marker, name: 'rider_marker' },\r\n      { ref: this.driver_marker, name: 'driver_marker' },\r\n      { ref: this.destinationMarker, name: 'destinationMarker' },\r\n      { ref: this.marker1, name: 'marker1' },\r\n      { ref: this.marker2, name: 'marker2' },\r\n      { ref: this.animatedMarker, name: 'animatedMarker' }\r\n    ];\r\n\r\n    // Add car markers to the list\r\n    if (this._carmarkers && Array.isArray(this._carmarkers)) {\r\n      this._carmarkers.forEach(cm => {\r\n        if (cm.marker) {\r\n          markers.push({ ref: cm.marker, name: 'car_marker' });\r\n        }\r\n      });\r\n      this._carmarkers = [];\r\n    }\r\n    \r\n    const clearPromises = markers\r\n      .filter(m => m.ref !== null && m.ref !== undefined && m.ref !== '')\r\n      .map(m => this.clearMarker(m.ref).catch(e => {\r\n        console.error(`Error clearing ${m.name}:`, e);\r\n        // Continue despite error\r\n        return null;\r\n      }));\r\n    \r\n    await Promise.all(clearPromises);\r\n    \r\n    // Reset all marker references\r\n    this.rider_marker = null;\r\n    this.driver_marker = null;\r\n    this.destinationMarker = null;\r\n    this.marker1 = null;\r\n    this.marker2 = null;\r\n    this.animatedMarker = null;\r\n    \r\n    console.log('All markers cleared successfully');\r\n  } catch (e) {\r\n    console.error('Error in clearPrevMarkers:', e);\r\n    // Just log the error but don't throw, allowing the process to continue\r\n  }\r\n}\r\n\r\n// Add this helper method for individual marker clearing\r\nprivate async clearMarker(marker) {\r\n  if (!marker || !this.map?.newMap) return Promise.resolve();\r\n  \r\n  try {\r\n    console.log('Clearing marker:', marker);\r\n    await this.map.newMap.removeMarker(marker);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error clearing marker:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Helper method to update marker position without duplication\r\nprivate async updateMarkerPosition(marker: any, coordinate: { lat: number, lng: number }, iconUrl: string, title: string) {\r\n  if (!this.map?.newMap) return null;\r\n  \r\n  const markerSize = { width: 40, height: 40 };\r\n  const iconAnchor = { x: 20, y: 40 };\r\n  \r\n  try {\r\n    // Remove old marker if it exists\r\n    if (marker !== null && marker !== undefined) {\r\n      await this.map.newMap.removeMarker(marker).catch(e => \r\n        console.log('Marker already removed or invalid:', e)\r\n      );\r\n    }\r\n    \r\n    // Create new marker at updated position\r\n    const newMarker = await this.map.newMap.addMarker({\r\n      coordinate: coordinate,\r\n      iconUrl: iconUrl,\r\n      title: title,\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: title === 'Driver' ? 100 : 101\r\n    });\r\n    \r\n    return newMarker;\r\n  } catch (error) {\r\n    console.error('Error updating marker position:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n// Modify clearAllPolylines for safer handling\r\nasync clearAllPolylines() {\r\n  try {\r\n    if (!this.map || !this.map.newMap) {\r\n      console.warn('Map not initialized when clearing polylines');\r\n      return;\r\n    }\r\n    \r\n    console.log('Clearing all polylines...');\r\n    \r\n    // Try to clear specific polyline first\r\n    if (this.newPoly) {\r\n      try {\r\n        await this.map.newMap.removePolylines(this.newPoly);\r\n        console.log('Specific polyline cleared');\r\n      } catch (error) {\r\n        console.error('Error clearing specific polyline:', error);\r\n      }\r\n    }\r\n    \r\n    // Reset reference\r\n    this.newPoly = null;\r\n      } catch (error) {\r\n    console.error('Error in clearAllPolylines:', error);\r\n    // Just log the error but don't throw\r\n  }\r\n}\r\n\r\n\r\nasync ResetState(){\r\n  try{\r\n    console.log('Resetting state to initial booking view');\r\n    \r\n    // Clear all subscriptions first\r\n    this.clearSubscriptions();\r\n    \r\n    // Clear previous markers and polylines\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n\r\n    // Reset map camera to user location\r\n    if (this.map && this.map.newMap && this.LatLng) {\r\n      await this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.LatLng\r\n      });\r\n    }\r\n\r\n    this.ResetMapHeight();\r\n    // window.addEventListener('resize', this.ResetMapHeight.bind(this));\r\n  \r\n    if (this.map && this.map.newMap) {\r\n      this.map.newMap.enableTouch();\r\n      await this.map.newMap.enableCurrentLocation(true);\r\n    }\r\n    \r\n    // Reset all ride-related data\r\n    this.current_Request_Number = 0;\r\n    this.price = null;\r\n    this.actualDestination = null;\r\n    this.D_LatLng = { lat: null, lng: null };\r\n    this.destinationAddress = 'Unknown location';\r\n    this.driverInfo = null;\r\n    this.currentDriver = null;\r\n    this.driverLocation = null;\r\n    this.duration = null;\r\n    this.distance = null;\r\n    \r\n    // Reset polling state\r\n    this.stopPolling = false;\r\n    \r\n  }catch(e){\r\n    throw new Error(e);\r\n    \r\n  }\r\n}\r\n\r\nasync showAutocompleteModal(): Promise<void> {\r\n  const options: ModalOptions = {\r\n      component: AutocompleteComponent,\r\n      componentProps: {\r\n          LatLng: this.LatLng,\r\n          locationAddress: this.locationAddress,\r\n      },\r\n\r\n  };\r\n\r\n  const modal = await this.modalCtrl.create(options);\r\n  await modal.present();\r\n\r\n  const { data } = await modal.onWillDismiss();\r\n  console.log('Modal dismissed with data:', data);\r\n\r\n  this.data = data;\r\n\r\n  if (data.pinOnMap) {\r\n      this.EnterMapPinStage();\r\n      this.mapPinDrag = true;\r\n      this.stopPolling = true;\r\n\r\n  }\r\n\r\n  if (data.home) {\r\n      console.log(\"Entering Booking Stage...\");\r\n      this.EnterBookingStage();\r\n      this.stopPolling = false;\r\n      this.ResetState();\r\n  }\r\n\r\n  if (data.searching) {\r\n      this.database.AddKnownPlace(data);\r\n      this.destinationAddress = data.full;\r\n      this.actualDestination = data.whole.full;\r\n\r\n      // Handle edited pickup location\r\n      if (data.editedPickup) {\r\n          console.log(\"Pickup location was edited:\", data.editedPickup);\r\n          this.LatLng = {\r\n              lat: data.editedPickup.lat,\r\n              lng: data.editedPickup.lng,\r\n          };\r\n          this.locationAddress = data.editedPickup.location;\r\n          console.log(\"Updated pickup LatLng:\", this.LatLng);\r\n      }\r\n\r\n      try {\r\n          const latLng = await this.geocode.getLatLng(data.whole.description).toPromise();\r\n          this.D_LatLng = {\r\n              lat: latLng.results[0].geometry.location.lat,\r\n              lng: latLng.results[0].geometry.location.lng,\r\n          };\r\n          console.log(\"Destination LatLng:\", this.D_LatLng);\r\n\r\n          await this.getDistanceAndDirections();\r\n    } catch (error) {\r\n          console.error(\"Error in geocoding:\", error);\r\n          this.overlay.showAlert('Error in geocoding:', error.message);\r\n      }\r\n  }\r\n}\r\n\r\n\r\nasync RequestRide(dat) {\r\n  if (this.LatLng) {\r\n    await this.fetchAndDisplayDrivers([this.LatLng.lat, this.LatLng.lng], 8000);\r\n  }\r\n\r\n  if (!this.NoDrivers) {\r\n    this.destinationAddress = dat.place.full;\r\n    this.actualDestination = dat.place.whole.full;\r\n\r\n    try {\r\n      const latLng = await this.geocode.getLatLng(dat.place.whole.description).toPromise();\r\n      this.D_LatLng = {\r\n        lat: latLng.results[0].geometry.location.lat,\r\n        lng: latLng.results[0].geometry.location.lng,\r\n      };\r\n\r\n      await this.getDistanceAndDirections();\r\n  } catch (error) {\r\n      console.error(\"Error in geocoding:\", error);\r\n      this.overlay.showAlert('Check Your Network', error.message);\r\n    }\r\n  } else {\r\n    this.EnterNoDriverStage();\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\nasync getDistanceAndDirections() {\r\n  console.log(\"getDistanceAndDirections called\");\r\n  this.duration = null;\r\n  await this.clearMarkers();\r\n  this.cleanupListeners();\r\n  this.stopPolling = true;\r\n\r\n  if (this.D_LatLng && this.D_LatLng.lat) {\r\n    console.log(\"D_LatLng is set:\", this.D_LatLng);\r\n\r\n    if (this.LatLng) {\r\n      await this.fetchAndDisplayDrivers([this.LatLng.lat, this.LatLng.lng], 8000);\r\n      console.log('=== AFTER fetchAndDisplayDrivers in getDistanceAndDirections ===');\r\n      console.log('drivers_Requested:', this.drivers_Requested?.length, this.drivers_Requested);\r\n      console.log('NoDrivers:', this.NoDrivers);\r\n      console.log('stopPolling:', this.stopPolling);\r\n    }\r\n\r\n    if (!this.NoDrivers) {\r\n      this.EnterConfirmStage();\r\n      console.log('=== ENTERED CONFIRM STAGE ===');\r\n      console.log('drivers_Requested after EnterConfirmStage:', this.drivers_Requested?.length);\r\n    } else {\r\n      this.EnterNoDriverStage();\r\n      console.log(\"No drivers available\");\r\n      return;\r\n    }\r\n\r\n    // Use Dijkstra service instead of Google Directions\r\n    try {\r\n      const pathResult = await this.dijkstraService.findShortestPath(this.LatLng, this.D_LatLng);\r\n      \r\n      if (pathResult) {\r\n        this.direction = pathResult; // Store for compatibility\r\n        this.distance = pathResult.totalDistance;\r\n        this.bounds = null; // Not needed for Dijkstra\r\n        this.price = await this.database.getPriceEstimate(this.distance);\r\n        this.duration = Math.round(pathResult.totalWeight / 60) + ' mins'; // Convert to minutes string\r\n\r\n        // Extract route path\r\n        const routePath = pathResult.coordinates;\r\n\r\n        await this.createAndAddMarkers(this.LatLng, this.D_LatLng, routePath);\r\n\r\n        // Call getDistanceAndDirectionsDriver after this part is successful\r\n        await this.getDistanceAndDirectionsDriver();\r\n      } else {\r\n        throw new Error('No route found');\r\n      }\r\n    } catch (error) {\r\n      console.error('Dijkstra route error:', error);\r\n      this.overlay.showAlert('Route Error', 'Unable to calculate route. Please try again.');\r\n    }\r\n  } else {\r\n    this.overlay.showAlert('Drag Map', 'Drag the map and stop on your required destination');\r\n    console.error('D_LatLng or D_LatLng.lat is undefined');\r\n  }\r\n\r\n}\r\n\r\nasync getDistanceAndDirectionsDriver() {\r\n  console.log(\"getDistanceAndDirectionsDriver called\");\r\n\r\n  if (!this.NoDrivers) {\r\n    console.log(\"Driver LatLng:\", this.DriverLatLng);\r\n\r\n    if (this.DriverLatLng) {\r\n      const origin1 = new google.maps.LatLng(this.LatLng.lat, this.LatLng.lng);\r\n      const origin2 = new google.maps.LatLng(this.DriverLatLng.lat, this.DriverLatLng.lng);\r\n\r\n      const request = {\r\n        origin: origin1,\r\n        destination: origin2,\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      };\r\n\r\n      this.geocode.directions.route(request, (response, status) => {\r\n        if (status === 'OK') {\r\n          this.D_duration = response.routes[0].legs[0].duration.text;\r\n          console.log(\"Driver duration:\", this.D_duration);\r\n        } else {\r\n          console.error('Direction ERROR:', response);\r\n          this.overlay.showAlert('Direction ERROR:', JSON.stringify(response));\r\n        }\r\n      });\r\n    } else {\r\n      console.log(\"DriverLatLng is undefined\");\r\n    }\r\n  } else {\r\n    console.log(\"No drivers available\");\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nasync resetLocation(): Promise<void> {\r\nconsole.log(this.LatLng);\r\nawait this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng\r\n});\r\nthis.showResetLocationButton = false;\r\n}\r\n\r\n\r\n\r\nprocessAddressResponse(addressResponse) {\r\n  console.log(\"processAddressResponse : \" + addressResponse);\r\n  if (addressResponse) {\r\n      console.log(addressResponse);\r\n      this.actualDestination = this.map.actualLocation;\r\n      const results = addressResponse.results;\r\n\r\n      if (results && results.length > 1 && results[1].geometry && results[1].geometry.location) {\r\n          this.D_LatLng = {\r\n              lat: results[1].geometry.location.lat,\r\n              lng: results[1].geometry.location.lng\r\n          };\r\n\r\n          const addressComponents = results[1].address_components;\r\n          if (addressComponents && addressComponents.length > 1) {\r\n              this.destinationAddress = `${addressComponents[0].long_name} ${addressComponents[1].long_name}`;\r\n              console.log(\"this is it \" + this.destinationAddress);\r\n          } else {\r\n              console.log('Address components are missing or incomplete.');\r\n              this.destinationAddress = 'Unknown address';\r\n          }\r\n      } else {\r\n          console.log('Results are missing or incomplete.');\r\n          this.D_LatLng = { lat: null, lng: null };\r\n          this.destinationAddress = 'Unknown location';\r\n      }\r\n  } else {\r\n      console.log('Failed to fetch address.');\r\n      this.D_LatLng = { lat: null, lng: null };\r\n      this.destinationAddress = 'Failed to fetch address';\r\n  }\r\n}\r\n\r\n\r\nasync UpdateCarMarker(elements: Drivers[]) {\r\n  console.log('Elements to update car markers:', elements);\r\n\r\n  // Validate map is initialized\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized when updating car markers');\r\n    return;\r\n  }\r\n\r\n  const bounds = new google.maps.LatLngBounds();\r\n  let hasValidBounds = false;\r\n\r\n  // Create a map of driver IDs to driver elements for quick lookup\r\n  const driverMap = new Map(elements.map(element => [element.Driver_id, element]));\r\n\r\n  // Track markers to keep and update\r\n  const updatedMarkers: { id: string, marker: any }[] = [];\r\n\r\n  // Remove markers that are not needed and update positions\r\n  for (const { id, marker } of this._carmarkers) {\r\n    const driver = driverMap.get(id);\r\n    if (!driver || !driver.onlineState) {\r\n      console.log(`Removing marker for driver ID: ${id}`);\r\n      if (marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error(`Error removing marker ${id}:`, e)\r\n        );\r\n      }\r\n    } else if (driver.Driver_lat !== undefined && driver.Driver_lng !== undefined) {\r\n      const latlng = { lat: driver.Driver_lat, lng: driver.Driver_lng };\r\n      // Remove old marker\r\n      if (marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error(`Error removing marker ${id}:`, e)\r\n        );\r\n      }\r\n      bounds.extend(latlng);\r\n      hasValidBounds = true;\r\n      console.log(`Updated marker for driver ID: ${id}`);\r\n    } else {\r\n      console.error('Invalid driver coordinates:', driver);\r\n    }\r\n  }\r\n\r\n  // Add new markers for drivers that are online and not in the existing markers\r\n  for (const element of elements) {\r\n    if (element.onlineState) {\r\n      const existingMarkerIndex = updatedMarkers.findIndex(({ id }) => id === element.Driver_id);\r\n      if (existingMarkerIndex === -1 && element.Driver_lat !== undefined && element.Driver_lng !== undefined) {\r\n        const latlng = { lat: element.Driver_lat, lng: element.Driver_lng };\r\n        console.log(`Adding new marker for driver ID: ${element.Driver_id} at`, latlng);\r\n        try {\r\n          const marker = await this.map.newMap.addMarker({\r\n            coordinate: latlng,\r\n            iconUrl: 'https://i.ibb.co/KDy365b/hatchback.png',\r\n            title: 'Driver',\r\n            iconSize: { width: 40, height: 40 },\r\n            iconAnchor: { x: 20, y: 40 },\r\n            zIndex: 100\r\n          });\r\n\r\n          if (marker) {\r\n            updatedMarkers.push({ id: element.Driver_id, marker });\r\n            bounds.extend(latlng);\r\n            hasValidBounds = true;\r\n          }\r\n        } catch (error) {\r\n          console.error('Error adding marker:', error);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Update the _carmarkers array with the updated markers\r\n  this._carmarkers = updatedMarkers;\r\n\r\n  // Center the map around the car markers if there are any markers\r\n  if (updatedMarkers.length > 0 && hasValidBounds) {\r\n    try {\r\n      const mapDim = {\r\n        height: this.mapRef.nativeElement.offsetHeight || 600,\r\n        width: this.mapRef.nativeElement.offsetWidth || 400\r\n      };\r\n\r\n      const minZoom = 10; // Closer minimum zoom\r\n      const maxZoom = 17; // Reasonable maximum zoom\r\n      \r\n      let zoomLevel = await this.map.getBoundsZoomLevel(bounds, mapDim);\r\n      \r\n      // Constrain the zoom level within the min and max range\r\n      zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n      \r\n      console.log('Setting camera with zoom level:', zoomLevel);\r\n      \r\n      const center = bounds.getCenter();\r\n    \r\n    } catch (error) {\r\n      console.error('Error setting camera:', error);\r\n    }\r\n  } else {\r\n    console.log('No markers to display on the map.');\r\n  }\r\n}\r\n\r\n\r\n\r\nasync GoHome() {\r\n  console.log('Going home...');\r\n  await this.ReturnHome();\r\n}\r\n\r\nasync GotoSupport() {\r\n  await this.nav.navigateForward('support');\r\n}\r\n\r\n/**\r\n * Test push notification alerts - call this to verify alerts work on web/iOS/Android\r\n * You can trigger this from the browser console: \r\n * document.querySelector('app-home').componentInstance.testPushNotifications()\r\n */\r\nasync testPushNotifications() {\r\n  console.log(' Testing push notifications from home page...');\r\n  await this.oneSignalService.testPushNotificationAlerts();\r\n}\r\n\r\n/**\r\n * Send a test notification via the backend\r\n */\r\nasync sendTestNotification() {\r\n  console.log(' Sending test notification...');\r\n  \r\n  // Get the current user's external ID\r\n  const userId = this.auth.currentUser?.uid;\r\n  \r\n  if (!userId) {\r\n    this.overlay.showAlert('Error', 'You must be logged in to send test notifications');\r\n    return;\r\n  }\r\n\r\n  // Send notification via backend\r\n  this.oneSignalService.sendByUserIds({\r\n    externalUserIds: [userId],\r\n    title: 'Test Notification',\r\n    message: 'This is a test push notification from your app!',\r\n    data: {\r\n      notificationType: 'ride_confirmed',\r\n      rideId: 'test-ride-123',\r\n      timestamp: new Date().toISOString()\r\n    }\r\n  }).subscribe({\r\n    next: (response) => {\r\n      console.log('Test notification sent:', response);\r\n    },\r\n    error: (error) => {\r\n      console.error('Test notification failed:', error);\r\n    }\r\n  });\r\n}\r\n\r\n\r\nasync ReturnHome() {\r\n  console.log('Returning home - resetting to booking stage');\r\n  \r\n  try {\r\n    // Clear all ride state first\r\n    await this.clearRideState();\r\n    \r\n    // Reset map state\r\n    await this.ResetState();\r\n    \r\n    // Ensure we're in booking stage\r\n    this.EnterBookingStage();\r\n    \r\n    // Reset map camera\r\n    if (this.map && this.map.newMap && this.LatLng) {\r\n      await this.map.newMap.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom: 15,\r\n        coordinate: this.LatLng\r\n      });\r\n    }\r\n    \r\n    console.log('Successfully returned to booking view');\r\n  } catch (error) {\r\n    console.error('Error returning home:', error);\r\n    // Ensure we at least enter booking stage\r\n    this.EnterBookingStage();\r\n  }\r\n}\r\n\r\nasync CancelRide() {\r\n  try {\r\n    console.log('Cancelling ride...');\r\n    this.overlay.showLoader('Cancelling your ride...');\r\n    \r\n    // Cancel ride in database\r\n    if (this.requestID) {\r\n      await this.database.cancelRide(this.requestID);\r\n    }\r\n    \r\n    // Clear subscriptions\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    if (this.numCalls) {\r\n      this.numCalls.unsubscribe();\r\n    }\r\n    \r\n    this.riderCleared = true;\r\n    \r\n    // Comprehensive cleanup\r\n    await this.clearRideState();\r\n    \r\n    // Reset to booking view\r\n    await this.ReturnHome();\r\n    \r\n    this.overlay.hideLoader();\r\n    console.log('Ride cancelled successfully');\r\n  } catch (error) {\r\n    this.overlay.hideLoader();\r\n    console.error('Error cancelling ride:', error);\r\n    this.overlay.showAlert('Error', 'Failed to cancel ride. Please try again.');\r\n    \r\n    // Try to return home anyway\r\n    try {\r\n      await this.ReturnHome();\r\n    } catch (e) {\r\n      console.error('Error returning home after cancel error:', e);\r\n    }\r\n  }\r\n}\r\n\r\nasync ClearRide() {\r\n  try {\r\n    const user = this.auth.currentUser;\r\n    if (user) {\r\n      const riderDocRef = doc(this.firestore, 'Riders', user.uid);\r\n      await updateDoc(riderDocRef, {\r\n        currentRequestId: null\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error clearing ride state:', error);\r\n  }\r\n\r\n  this.EnterBookingStage();\r\n  await this.clearPrevMarkers();\r\n  await this.clearPolyline(this.newPoly);\r\n  this.newPoly = null;\r\n\r\n  await this.map.newMap.enableCurrentLocation(true);\r\n  this.current_Request_Number = 0;\r\n  this.price = null;\r\n  await this.map.newMap.setCamera({\r\n    animate: true,\r\n    animationDuration: 500,\r\n    zoom: 15,\r\n    coordinate: this.LatLng,\r\n    bearing: 0\r\n  });\r\n}\r\n\r\nasync CallDriver() {\r\n  const phone = this.driverInfo?.Driver_phone?.replace(/[^\\d]/g, '');\r\n  if (phone) {\r\n    const message = encodeURIComponent('Hi, I am your rider.');\r\n    window.open(`https://wa.me/${phone}?text=${message}`, '_system');\r\n    return;\r\n  }\r\n  const toast = await this.toastController.create({\r\n    message: 'Driver WhatsApp number not available',\r\n    duration: 2000\r\n  });\r\n  await toast.present();\r\n}\r\n\r\n\r\nasync handleDriverToRider(driverLatLng, riderLatLng) {\r\n  const markerSize = { width: 40, height: 40 }; // Increased size for better visibility\r\n  const iconAnchor = { x: 20, y: 40 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Use the unified height method and ensure proper positioning\r\n    this.setMapHeightHandleDrivertoRider();\r\n    \r\n    // Add driver marker at the starting position with adjusted z-index\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 100 // Ensure marker appears above polylines\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add rider marker with higher z-index\r\n    const riderMarker = await this.map.newMap.addMarker({\r\n      coordinate: riderLatLng,\r\n      iconUrl: this.database.user?.photoURL || 'assets/icon/person.png',\r\n      title: 'Rider',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      zIndex: 101 // Higher than driver marker\r\n    });\r\n    this.rider_marker = riderMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        // Fetch updated driver location\r\n        let updatedDriverLatLng = driverLatLng;\r\n        if (this.currentDriver?.Driver_id) {\r\n          try {\r\n            const driverLocation = await this.database.getDriverLocation(this.currentDriver.Driver_id);\r\n            if (driverLocation && driverLocation.lat && driverLocation.lng) {\r\n              updatedDriverLatLng = { lat: driverLocation.lat, lng: driverLocation.lng };\r\n              this.DriverLatLng = updatedDriverLatLng;\r\n            }\r\n          } catch (error) {\r\n            console.warn('Failed to fetch updated driver location:', error);\r\n          }\r\n        }\r\n\r\n        const request = {\r\n          origin: updatedDriverLatLng,\r\n          destination: riderLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          // Check if subscription is still active to prevent race conditions\r\n          if (!this.routeUpdateSubscription) {\r\n             console.log('Route update cancelled - subscription inactive');\r\n             return;\r\n          }\r\n\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: updatedDriverLatLng.lat, longitude: updatedDriverLatLng.lng } },\r\n              { geoCode: { latitude: riderLatLng.lat, longitude: riderLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(updatedDriverLatLng.lat, updatedDriverLatLng.lng));\r\n            bounds.extend(new google.maps.LatLng(riderLatLng.lat, riderLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level with better constraints\r\n            let zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n            \r\n            // Apply reasonable constraints for driver-to-rider view\r\n            const minZoom = 12;\r\n            const maxZoom = 16;\r\n            zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n            \r\n            // Adjust zoom to ensure both markers are visible with padding\r\n            const adjustedZoomLevel = Math.max(zoomLevel - 1, minZoom);\r\n    \r\n            await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(updatedDriverLatLng, riderLatLng));\r\n    \r\n            // Clear existing polyline before drawing a new one\r\n            await this.clearAllPolylines();\r\n            // Draw full route polyline (use overview_path)\r\n            await this.addPolyline(updatedDriverLatLng, riderLatLng, path);\r\n            \r\n            // Update driver marker position smoothly without duplication\r\n            this.driver_marker = await this.updateMarkerPosition(\r\n              this.driver_marker, \r\n              updatedDriverLatLng, \r\n              'assets/icon/car.png', \r\n              'Driver'\r\n            );\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling driver to rider:', error);\r\n  }\r\n}\r\n\r\n// Update clearPolyline to handle null map\r\nasync clearPolyline(polylineId) {\r\n  if (!polylineId || !this.map?.newMap) return;\r\n  \r\n  try {\r\n    await this.map.newMap.removePolylines(polylineId);\r\n  } catch (error) {\r\n    console.error('Error clearing polyline:', error);\r\n  }\r\n}\r\n\r\n\r\nasync handleRiderToDestination(driverLatLng, destinationLatLng) {\r\n  const markerSize = { width: 40, height: 40 }; // Increased size for better visibility\r\n  const iconAnchor = { x: 20, y: 40 }; // Center bottom of the icon\r\n\r\n  try {\r\n    // Cancel any existing route update subscription first\r\n    if (this.routeUpdateSubscription) {\r\n      this.routeUpdateSubscription.unsubscribe();\r\n      this.routeUpdateSubscription = null;\r\n    }\r\n    \r\n    // Check if map is initialized, if not initialize it\r\n    if (!this.map.newMap) {\r\n      console.log('Map not initialized, initializing now...');\r\n      await this.initializeMap();\r\n    }\r\n    \r\n    // Reset map position and apply proper height first\r\n    this.mapRef.nativeElement.style.top = '0';\r\n    this.setMapHeightHandleDrivertoDestination();\r\n    \r\n    // Thoroughly clean up previous visual elements\r\n    await this.clearPrevMarkers();\r\n    await this.clearAllPolylines();\r\n    \r\n    // Update driver marker to driver's current position\r\n    const driverMarker = await this.map.newMap.addMarker({\r\n      coordinate: driverLatLng,\r\n      iconUrl: 'assets/icon/car.png',\r\n      title: 'Driver',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 100, // Higher z-index to appear above polyline\r\n    });\r\n    this.driver_marker = driverMarker;\r\n\r\n    // Add destination marker\r\n    const destinationMarker = await this.map.newMap.addMarker({\r\n      coordinate: destinationLatLng,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 0, y: 0 },\r\n      zIndex: 101, // Higher z-index than driver marker\r\n    });\r\n    this.destinationMarker = destinationMarker;\r\n\r\n    // Function to update route, duration, and distance\r\n    const updateRoute = async () => {\r\n        // Fetch updated driver location\r\n        let updatedDriverLatLng = driverLatLng;\r\n        if (this.currentDriver?.Driver_id) {\r\n          try {\r\n            const driverLocation = await this.database.getDriverLocation(this.currentDriver.Driver_id);\r\n            if (driverLocation && driverLocation.lat && driverLocation.lng) {\r\n              updatedDriverLatLng = { lat: driverLocation.lat, lng: driverLocation.lng };\r\n              this.DriverLatLng = updatedDriverLatLng;\r\n            }\r\n          } catch (error) {\r\n            console.warn('Failed to fetch updated driver location:', error);\r\n          }\r\n        }\r\n\r\n        const request = {\r\n          origin: updatedDriverLatLng,\r\n          destination: destinationLatLng,\r\n          travelMode: google.maps.TravelMode.DRIVING,\r\n        };\r\n\r\n        this.geocode.directions.route(request, async (response, status) => {\r\n          // Check if subscription is still active to prevent race conditions\r\n          if (!this.routeUpdateSubscription) {\r\n             console.log('Route update cancelled - subscription inactive');\r\n             return;\r\n          }\r\n\r\n          if (status === 'OK') {\r\n            const path = response.routes[0].overview_path.map(latlng => ({\r\n              lat: latlng.lat(),\r\n              lng: latlng.lng()\r\n            }));\r\n            this.duration = response.routes[0].legs[0].duration.text;\r\n            this.distance = response.routes[0].legs[0].distance.text;\r\n\r\n            console.log(`Duration: ${this.duration}, Distance: ${this.distance}`);\r\n\r\n            const locs = [\r\n              { geoCode: { latitude: updatedDriverLatLng.lat, longitude: updatedDriverLatLng.lng } },\r\n              { geoCode: { latitude: destinationLatLng.lat, longitude: destinationLatLng.lng } },\r\n            ];\r\n\r\n            const center = this.map.calculateCenter(locs);\r\n\r\n            const bounds = new google.maps.LatLngBounds();\r\n            bounds.extend(new google.maps.LatLng(updatedDriverLatLng.lat, updatedDriverLatLng.lng));\r\n            bounds.extend(new google.maps.LatLng(destinationLatLng.lat, destinationLatLng.lng));\r\n    \r\n            const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n    \r\n            // Prepare map dimensions for calculating zoom level\r\n            const mapDim = {\r\n              height: availableHeight,\r\n              width: this.mapRef.nativeElement.offsetWidth,\r\n            };\r\n    \r\n            // Calculate zoom level with better constraints\r\n            let zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n            \r\n            // Apply reasonable constraints for rider-to-destination view\r\n            const minZoom = 11;\r\n            const maxZoom = 16;\r\n            zoomLevel = Math.max(minZoom, Math.min(maxZoom, zoomLevel));\r\n            \r\n            // Adjust zoom to ensure both markers are visible with padding\r\n            const adjustedZoomLevel = Math.max(zoomLevel - 1, minZoom);\r\n    \r\n            // Set the camera to focus on the center point with appropriate zoom level\r\n            await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(updatedDriverLatLng, destinationLatLng));\r\n    \r\n            // Clear existing polyline before drawing a new one\r\n            await this.clearAllPolylines();\r\n            // Draw full route polyline (use overview_path)\r\n            await this.addPolyline(updatedDriverLatLng, destinationLatLng, path);\r\n            \r\n            // Update driver marker position smoothly without duplication\r\n            this.driver_marker = await this.updateMarkerPosition(\r\n              this.driver_marker, \r\n              updatedDriverLatLng, \r\n              'assets/icon/car.png', \r\n              'Driver'\r\n            );\r\n          } else {\r\n            console.error('Direction ERROR:', response);\r\n            this.overlay.showAlert('Direction ERROR', JSON.stringify(response));\r\n          }\r\n        });\r\n    };\r\n\r\n    // Start updating the route periodically\r\n    const routeUpdate$ = interval(this.UPDATE_INTERVAL).pipe(\r\n      switchMap(() => updateRoute())\r\n    );\r\n\r\n    // Subscribe to the interval observable to start updating\r\n    this.routeUpdateSubscription = routeUpdate$.subscribe();\r\n\r\n  } catch (error) {\r\n    console.error('Error handling rider to destination:', error);\r\n  }\r\n}\r\n\r\n// Add polyline using either a full route path or fallback to start/end\r\nasync addPolyline(loc: { lat: number, lng: number }, des: { lat: number, lng: number }, routePath?: { lat: number, lng: number }[]) {\r\n  try {\r\n    const polylineColor = \"#007bff\";\r\n    const pathPoints = Array.isArray(routePath) && routePath.length > 0 ? routePath : [\r\n      { lat: loc.lat, lng: loc.lng },\r\n      { lat: des.lat, lng: des.lng }\r\n    ];\r\n\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: pathPoints,\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n\r\n    const addedPolylines = await this.map.newMap.addPolylines(polylines);\r\n    if (Array.isArray(addedPolylines) && addedPolylines.length > 0) {\r\n      this.newPoly = addedPolylines; // assign the returned ids\r\n      console.log('Polylines added:', this.newPoly);\r\n      return this.newPoly;\r\n    } else {\r\n      throw new Error('Failed to add polyline: Unexpected response format');\r\n    }\r\n  } catch (e) {\r\n    console.error('Error Adding Polyline: ', e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nasync createAndAddMarkers(loc, des, routePath?: { lat: number, lng: number }[]) {\r\n  const markerSize = { width: 30, height: 30 };\r\n  const iconAnchor = { x: 10, y: 0 }; // Center bottom of the icon\r\n\r\n  try {\r\n    this.map.newMap.disableTouch();\r\n\r\n    // Add start marker\r\n    this.marker1 = await this.map.newMap.addMarker({\r\n      coordinate: loc,\r\n      iconUrl: 'assets/icon/point.png',\r\n      title: 'Start',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Add destination marker\r\n    this.marker2 = await this.map.newMap.addMarker({\r\n      coordinate: des,\r\n      iconUrl: 'assets/icon/flag.png',\r\n      title: 'Destination',\r\n      iconSize: markerSize,\r\n      iconAnchor: iconAnchor,\r\n      iconOrigin: { x: 1, y: 0 },\r\n    });\r\n\r\n    // Calculate the center point between the start and destination\r\n    const locs = [\r\n      { geoCode: { latitude: loc.lat, longitude: loc.lng } },\r\n      { geoCode: { latitude: des.lat, longitude: des.lng } },\r\n    ];\r\n\r\n    const center = this.map.calculateCenter(locs);\r\n\r\n    // Calculate the bounds\r\n    const bounds = new google.maps.LatLngBounds();\r\n    bounds.extend(new google.maps.LatLng(loc.lat, loc.lng));\r\n    bounds.extend(new google.maps.LatLng(des.lat, des.lng));\r\n\r\n    // Set map height before calculating zoom level\r\n    this.setMapHeight();\r\n    const availableHeight = this.mapRef.nativeElement.offsetHeight;\r\n\r\n    // Prepare map dimensions for calculating zoom level\r\n    const mapDim = {\r\n      height: availableHeight,\r\n      width: this.mapRef.nativeElement.offsetWidth,\r\n    };\r\n\r\n    // Calculate zoom level\r\n    const zoomLevel = this.map.getBoundsZoomLevel(bounds, mapDim);\r\n\r\n    // Manually set zoom level if needed\r\n    const adjustedZoomLevel = zoomLevel - 1; // Adjust as necessary\r\n\r\n    // Set the camera to focus on the center point with appropriate zoom level\r\n    await this.map.setCameraToLocation({ lat: center.latitude, lng: center.longitude }, adjustedZoomLevel, this.map.calculateBearing(loc, des));\r\n\r\n    // Add polyline for the route - use actual route path if available, fallback to straight line\r\n    const polylineColor = \"#007bff\";\r\n    const pathPoints = Array.isArray(routePath) && routePath.length > 0 ? routePath : [\r\n      { lat: loc.lat, lng: loc.lng },\r\n      { lat: des.lat, lng: des.lng }\r\n    ];\r\n    const polylines: Polyline[] = [\r\n      {\r\n        path: pathPoints,\r\n        strokeColor: polylineColor,\r\n        strokeWeight: 8,\r\n        geodesic: true\r\n      }\r\n    ];\r\n\r\n    // Add polyline to the map\r\n    this.newPoly = await this.map.newMap.addPolylines(polylines);\r\n  } catch (error) {\r\n    console.error('Error creating and adding markers:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n// Update the animateMarker method to properly handle cleanup\r\nasync animateMarker(marker, path, iconUrl) {\r\n  if (!this.map || !this.map.newMap) {\r\n    console.warn('Map not initialized for marker animation');\r\n    return;\r\n  }\r\n\r\n  const markerSize = { width: 50, height: 50 };\r\n  const iconAnchor = { x: 25, y: 50 }; // Center bottom of the icon\r\n  \r\n  try {\r\n    // Remove any existing animated marker\r\n    if (this.animatedMarker !== null && this.animatedMarker !== undefined) {\r\n      await this.map.newMap.removeMarker(this.animatedMarker).catch(e => \r\n        console.error('Error removing existing animated marker:', e)\r\n      );\r\n      this.animatedMarker = null;\r\n    }\r\n\r\n    let lastMarker = null;\r\n    \r\n    for (let i = 0; i < path.length; i++) {\r\n      // Remove previous animation step marker if it exists\r\n      if (lastMarker !== null && lastMarker !== undefined) {\r\n        await this.map.newMap.removeMarker(lastMarker).catch(e => \r\n          console.error('Error removing animation step marker:', e)\r\n        );\r\n      }\r\n      \r\n      // Remove the original marker for the first frame of animation\r\n      if (i === 0 && marker !== null && marker !== undefined) {\r\n        await this.map.newMap.removeMarker(marker).catch(e => \r\n          console.error('Error removing original marker:', e)\r\n        );\r\n      }\r\n      \r\n      const coordinate = path[i] instanceof google.maps.LatLng ? \r\n                       { lat: path[i].lat(), lng: path[i].lng() } : \r\n                       { lat: path[i].lat, lng: path[i].lng };\r\n                       \r\n      lastMarker = await this.map.newMap.addMarker({\r\n        coordinate: coordinate,\r\n        iconUrl: iconUrl,\r\n        title: 'Moving Marker',\r\n        iconSize: markerSize,\r\n        iconAnchor: iconAnchor,\r\n        iconOrigin: { x: 0, y: 0 },\r\n        zIndex: 20, // Higher than other markers\r\n      });\r\n      \r\n      await new Promise(resolve => setTimeout(resolve, 100)); // Adjust the interval as needed\r\n    }\r\n\r\n    // Store the last position of the animated marker\r\n    this.animatedMarker = lastMarker;\r\n  } catch (error) {\r\n    console.error('Error in animateMarker:', error);\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\nasync ShowDriverInfoPop() {\r\n  const alert = await this.alert.create({\r\n    header: 'Driver Information',\r\n    message: `\r\n      <div style=\"text-align: center;\">\r\n        <h2 style=\"font-size: 1.2em; margin-bottom: 0.5em;\">Car Name: ${this.carname}</h2>\r\n        <div style=\"margin: 10px 0;\">\r\n          <img src=\"${this.driverImage}\" alt=\"Driver Image\" style=\"width: 60px; height: 60px; border-radius: 50%;\">\r\n        </div>\r\n        <p><strong>Duration Apart:</strong> ${this.driver_duration_apart} minutes</p>\r\n        <p><strong>Driver ID:</strong> ${this.driver_ID}</p>\r\n        <p><strong>Number of Seats:</strong> ${this.driver_number_of_seats}</p>\r\n        <p><strong>Driver Location:</strong> (${this.DriverLatLng.lat}, ${this.DriverLatLng.lng})</p>\r\n      </div>\r\n    `,\r\n    buttons: ['OK']\r\n  });\r\n\r\n  await alert.present();\r\n}\r\n\r\n\r\n// State management methods\r\nEnterBookingStage() {\r\n  console.log('Entering booking stage');\r\n  this.setStage(this.STAGES.BOOKING);\r\n  \r\n  // Ensure polling is active to fetch nearby drivers\r\n  if (!this.pollingInterval && this.LatLng) {\r\n    console.log('Restarting driver polling in booking stage');\r\n    this.stopPolling = false;\r\n  }\r\n  \r\n  // Ensure map is in proper state\r\n  if (this.map && this.map.newMap) {\r\n    try {\r\n      this.map.newMap.enableTouch();\r\n      this.map.newMap.enableCurrentLocation(true);\r\n    } catch (e) {\r\n      console.error('Error enabling map features in booking stage:', e);\r\n    }\r\n  }\r\n}\r\n\r\nEnterMapPinStage() {\r\n  this.setStage(this.STAGES.MAP_PIN);\r\n}\r\n\r\nEnterConfirmStage() {\r\n  this.setStage(this.STAGES.CONFIRM);\r\n}\r\n\r\nEnterSearchingStage() {\r\n  this.setStage(this.STAGES.SEARCHING);\r\n}\r\n\r\nEnterNoDriverStage() {\r\n  this.setStage(this.STAGES.NO_DRIVER);\r\n}\r\n\r\nEnterTrackingStage() {\r\n  this.setStage(this.STAGES.TRACKING);\r\n}\r\n\r\nEnterDrivingToDestinationStage() {\r\n  this.setStage(this.STAGES.DRIVING);\r\n}\r\n\r\nprivate setStage(stage: string) {\r\n  // Reset all stages first\r\n  this.bookingStage = false;\r\n  this.confirmStage = false;\r\n  this.trackingStage = false;\r\n  this.searchingStage = false;\r\n  this.drivingToDestinationStage = false;\r\n  this.noDriverStage = false;\r\n  this.mapPinStage = false;\r\n\r\n  // Set the appropriate stage without calling Enter methods\r\n  switch (stage) {\r\n    case this.STAGES.BOOKING:\r\n      this.bookingStage = true;\r\n      break;\r\n    case this.STAGES.CONFIRM:\r\n      this.confirmStage = true;\r\n      break;\r\n    case this.STAGES.TRACKING:\r\n      this.trackingStage = true;\r\n      break;\r\n    case this.STAGES.SEARCHING:\r\n      this.searchingStage = true;\r\n      break;\r\n    case this.STAGES.DRIVING:\r\n      this.drivingToDestinationStage = true;\r\n      break;\r\n    case this.STAGES.NO_DRIVER:\r\n      this.noDriverStage = true;\r\n      break;\r\n    case this.STAGES.MAP_PIN:\r\n      this.mapPinStage = true;\r\n      break;\r\n  }\r\n}\r\n\r\nprivate getCurrentStage(): string {\r\n  if (this.bookingStage) return this.STAGES.BOOKING;\r\n  if (this.confirmStage) return this.STAGES.CONFIRM;\r\n  if (this.trackingStage) return this.STAGES.TRACKING;\r\n  if (this.searchingStage) return this.STAGES.SEARCHING;\r\n  if (this.drivingToDestinationStage) return this.STAGES.DRIVING;\r\n  if (this.noDriverStage) return this.STAGES.NO_DRIVER;\r\n  if (this.mapPinStage) return this.STAGES.MAP_PIN;\r\n  return this.STAGES.BOOKING; // default\r\n}\r\n\r\nngOnInit() {\r\n  // ... existing code ...\r\n  \r\n  // Check for \"book again\" navigation state\r\n  const navigation = this.router.getCurrentNavigation();\r\n  if (navigation?.extras.state) {\r\n    const state = navigation.extras.state;\r\n    console.log('Navigation state received:', state);\r\n    \r\n    if (state['bookAgain']) {\r\n      // Wait for the map to be ready\r\n      this.mapLoadedSubscription = this.mapLoadedSubject.subscribe(loaded => {\r\n        if (loaded) {\r\n          setTimeout(() => {\r\n            console.log('Processing book again data:', state);\r\n            this.processBookAgainData(state);\r\n          }, 1000); // Small delay to ensure map is fully ready\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  // ... existing code ...\r\n}\r\n\r\nasync processBookAgainData(state) {\r\n  try {\r\n    console.log('Setting up rebooking with data:', state);\r\n    \r\n    // Set pickup location\r\n    if (state.pickup && state.pickup.address) {\r\n      this.locationAddress = state.pickup.address;\r\n      \r\n      if (state.pickup.lat && state.pickup.lng) {\r\n        this.LatLng = {\r\n          lat: state.pickup.lat,\r\n          lng: state.pickup.lng\r\n        };\r\n        \r\n        // Add location marker\r\n        await this.addLocationMarker(this.LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.pickup.address);\r\n        if (coords) {\r\n          this.LatLng = coords;\r\n          await this.addLocationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Set destination\r\n    if (state.destination && state.destination.address) {\r\n      this.destinationAddress = state.destination.address;\r\n      \r\n      if (state.destination.lat && state.destination.lng) {\r\n        this.D_LatLng = {\r\n          lat: state.destination.lat,\r\n          lng: state.destination.lng\r\n        };\r\n        \r\n        // Add destination marker\r\n        await this.addDestinationMarker(this.D_LatLng);\r\n      } else {\r\n        // If no coordinates, geocode the address\r\n        const coords = await this.geocodeService.geocodeAddress(state.destination.address);\r\n        if (coords) {\r\n          this.D_LatLng = coords;\r\n          await this.addDestinationMarker(coords);\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If both locations are set, calculate route\r\n    if (this.LatLng && this.D_LatLng) {\r\n      await this.drawRoute();\r\n      await this.calculatePrice();\r\n      this.EnterConfirmStage();\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('Error processing book again data:', error);\r\n    // Show error toast\r\n    const toast = await this.toastCtrl.create({\r\n      message: 'Could not load previous ride data. Please try again.',\r\n      duration: 3000,\r\n      position: 'bottom',\r\n      color: 'danger'\r\n    });\r\n    toast.present();\r\n  }\r\n}\r\n\r\n  /**\r\n   * Draw route using Dijkstra API\r\n   */\r\n  async drawRoute() {\r\n    if (!this.LatLng || !this.D_LatLng) {\r\n      console.error('Cannot draw route: missing start or destination');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      console.log('Drawing route from', this.LatLng, 'to', this.D_LatLng);\r\n      \r\n      // Use Dijkstra service to get route\r\n      const pathResult = await this.dijkstraService.findShortestPath(this.LatLng, this.D_LatLng);\r\n      \r\n      if (!pathResult) {\r\n        console.error('No route found');\r\n        this.overlay.showAlert('Route Error', 'Unable to calculate route. Please try again.');\r\n        return;\r\n      }\r\n\r\n      // Store route data\r\n      this.distance = pathResult.totalDistance;\r\n      this.duration = Math.round(pathResult.totalWeight / 60); // Convert seconds to minutes\r\n      this.routePath = pathResult.coordinates;\r\n      \r\n      // Calculate price\r\n      this.price = await this.database.getPriceEstimate(this.distance);\r\n      \r\n      // Create markers and polyline\r\n      await this.createAndAddMarkers(this.LatLng, this.D_LatLng, pathResult.coordinates);\r\n      \r\n      console.log('Route drawn successfully:', {\r\n        distance: this.distance,\r\n        duration: this.duration,\r\n        price: this.price\r\n      });\r\n      \r\n    } catch (error) {\r\n      console.error('Error drawing route:', error);\r\n      this.overlay.showAlert('Route Error', 'Failed to calculate route. Please check your connection and try again.');\r\n    }\r\n  }\r\n\r\n  // ==================== SHARED RIDE METHODS ====================\r\n\r\n  /**\r\n   * Toggle shared ride option\r\n   */\r\n  toggleSharedRide(event: any): void {\r\n    this.sharedRideEnabled = event.detail.checked;\r\n    console.log('Shared ride enabled:', this.sharedRideEnabled);\r\n    \r\n    // Update potential savings display\r\n    if (this.sharedRideEnabled && this.price) {\r\n      this.updatePotentialSavingsDisplay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update potential savings display on booking screen\r\n   */\r\n  private updatePotentialSavingsDisplay(): void {\r\n    if (this.price) {\r\n      const savings = this.sharedRideService.getPotentialSavingsRange(this.price);\r\n      console.log(`Potential savings: $${savings.min.toFixed(2)} - $${savings.max.toFixed(2)}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get potential savings range for display\r\n   */\r\n  getPotentialSavings(): { min: number; max: number } {\r\n    if (!this.price) return { min: 0, max: 0 };\r\n    return this.sharedRideService.getPotentialSavingsRange(this.price);\r\n  }\r\n\r\n  /**\r\n   * Get discounted price range for display\r\n   */\r\n  getDiscountedPriceRange(): { min: number; max: number } {\r\n    if (!this.price) return { min: 0, max: 0 };\r\n    return {\r\n      min: this.price * 0.60,  // 40% discount\r\n      max: this.price * 0.90   // 10% discount\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Subscribe to shared ride updates when matched\r\n   */\r\n  subscribeToSharedRide(sharedRideId: string): void {\r\n    if (!this.auth.currentUser?.uid) {\r\n      console.error('No user ID for shared ride subscription');\r\n      return;\r\n    }\r\n\r\n    // Subscribe to shared ride updates\r\n    this.sharedRideSubscription = this.sharedRideService\r\n      .subscribeToSharedRide(sharedRideId, this.auth.currentUser.uid)\r\n      .subscribe((sharedRide) => {\r\n        if (sharedRide) {\r\n          this.ngZone.run(() => {\r\n            this.sharedRideData = sharedRide;\r\n            this.coPassengers = this.sharedRideService.getCoPassengers();\r\n            this.pickupQueuePosition = this.sharedRideService.getMyPickupPosition();\r\n            this.passengersBeforeMe = this.sharedRideService.getPassengersBeforeMe();\r\n          });\r\n        }\r\n      });\r\n\r\n    // Subscribe to notifications\r\n    this.sharedRideNotificationSubscription = this.sharedRideService.notifications$\r\n      .subscribe((notification) => {\r\n        if (notification) {\r\n          this.handleSharedRideNotification(notification);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Handle shared ride notifications\r\n   */\r\n  private handleSharedRideNotification(notification: SharedRideNotification): void {\r\n    console.log('Shared ride notification:', notification);\r\n    \r\n    // Update prices if fare changed\r\n    if (notification.type === 'discount_increased' || notification.type === 'passenger_cancelled') {\r\n      this.refreshSharedRidePrice();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh shared ride price from Firestore\r\n   */\r\n  private async refreshSharedRidePrice(): Promise<void> {\r\n    if (!this.requestID) return;\r\n\r\n    try {\r\n      const requestRef = doc(this.firestore, 'Request', this.requestID);\r\n      const requestDoc = await getDoc(requestRef);\r\n      \r\n      if (requestDoc.exists()) {\r\n        const data = requestDoc.data();\r\n        this.ngZone.run(() => {\r\n          this.isSharedRide = data['isSharedRide'] || false;\r\n          this.originalPrice = data['originalPrice'] || this.price;\r\n          this.discountedPrice = data['discountedPrice'] || this.price;\r\n          this.discountPercent = data['discountPercent'] || 0;\r\n          \r\n          // Update displayed price\r\n          if (this.isSharedRide) {\r\n            this.price = this.discountedPrice;\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Error refreshing shared ride price:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel sharing (only allowed before ride confirmed)\r\n   */\r\n  async cancelSharing(): Promise<void> {\r\n    if (!this.requestID) return;\r\n\r\n    const rideRef = doc(this.firestore, 'Request', this.requestID);\r\n    const rideDoc = await getDoc(rideRef);\r\n    \r\n    if (rideDoc.exists()) {\r\n      const data = rideDoc.data();\r\n      \r\n      // Check if sharing can be disabled\r\n      if (!this.sharedRideService.canDisableSharing(data['status'])) {\r\n        const toast = await this.toastController.create({\r\n          message: 'Cannot disable sharing once ride is confirmed',\r\n          duration: 3000,\r\n          position: 'top',\r\n          color: 'warning'\r\n        });\r\n        await toast.present();\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // Cancel shared ride\r\n        if (data['sharedRideId']) {\r\n          await this.sharedRideService.cancelSharedRide(this.requestID, data['sharedRideId']);\r\n        }\r\n        \r\n        // Update local state\r\n        this.isSharedRide = false;\r\n        this.sharedRideEnabled = false;\r\n        this.discountedPrice = this.originalPrice;\r\n        this.discountPercent = 0;\r\n        this.price = this.originalPrice;\r\n        \r\n        // Unsubscribe from shared ride updates\r\n        this.cleanupSharedRideSubscriptions();\r\n        \r\n        const toast = await this.toastController.create({\r\n          message: 'Sharing disabled. Price reverted to original.',\r\n          duration: 2000,\r\n          position: 'top',\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      } catch (error) {\r\n        console.error('Error cancelling sharing:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup shared ride subscriptions\r\n   */\r\n  private cleanupSharedRideSubscriptions(): void {\r\n    if (this.sharedRideSubscription) {\r\n      this.sharedRideSubscription.unsubscribe();\r\n      this.sharedRideSubscription = null;\r\n    }\r\n    if (this.sharedRideNotificationSubscription) {\r\n      this.sharedRideNotificationSubscription.unsubscribe();\r\n      this.sharedRideNotificationSubscription = null;\r\n    }\r\n    this.sharedRideService.unsubscribeFromSharedRide();\r\n    \r\n    // Reset shared ride state\r\n    this.sharedRideData = null;\r\n    this.coPassengers = [];\r\n    this.pickupQueuePosition = 0;\r\n    this.passengersBeforeMe = 0;\r\n  }\r\n\r\n  /**\r\n   * Get savings amount for display\r\n   */\r\n  getSavingsAmount(): number {\r\n    if (!this.isSharedRide) return 0;\r\n    return this.sharedRideService.calculateSavings(this.originalPrice, this.discountedPrice);\r\n  }\r\n\r\n  /**\r\n   * Get co-passenger status label\r\n   */\r\n  getPassengerStatusLabel(status: string): string {\r\n    switch (status) {\r\n      case 'waiting': return 'Waiting';\r\n      case 'picked_up': return 'Picked Up';\r\n      case 'dropped_off': return 'Dropped Off';\r\n      default: return status;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check for shared ride match when ride status changes\r\n   */\r\n  private async checkForSharedRideMatch(rideData: any): Promise<void> {\r\n    if (rideData.isSharedRide && rideData.sharedRideId && !this.sharedRideSubscription) {\r\n      this.ngZone.run(() => {\r\n        this.isSharedRide = true;\r\n        this.originalPrice = rideData.originalPrice || this.price;\r\n        this.discountedPrice = rideData.discountedPrice || this.price;\r\n        this.discountPercent = rideData.discountPercent || 0;\r\n      });\r\n      \r\n      // Subscribe to shared ride updates\r\n      this.subscribeToSharedRide(rideData.sharedRideId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset shared ride state when returning home\r\n   */\r\n  private resetSharedRideState(): void {\r\n    this.sharedRideEnabled = false;\r\n    this.isSharedRide = false;\r\n    this.originalPrice = 0;\r\n    this.discountedPrice = 0;\r\n    this.discountPercent = 0;\r\n    this.cleanupSharedRideSubscriptions();\r\n  }\r\n\r\n  // ==================== DIJKSTRA ROUTE MATCHING METHODS ====================\r\n\r\n  /**\r\n   * Find nearby riders with similar routes when shared ride is enabled\r\n   * Uses Dijkstra algorithm to compute optimal routes and calculate overlap\r\n   */\r\n  async findNearbySharedRideMatches(): Promise<void> {\r\n    if (!this.sharedRideEnabled || !this.LatLng || !this.D_LatLng) {\r\n      console.log('Cannot find matches: sharing disabled or missing locations');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.isCalculatingRoute = true;\r\n      console.log('Finding nearby riders with similar routes...');\r\n\r\n      // 1. Compute optimal route using Dijkstra\r\n      const origin: RouteLatLng = { lat: this.LatLng.lat, lng: this.LatLng.lng };\r\n      const destination: RouteLatLng = { lat: this.D_LatLng.lat, lng: this.D_LatLng.lng };\r\n      \r\n      this.computedPath = await this.dijkstraService.findShortestPath(origin, destination);\r\n      console.log('Computed path:', this.computedPath);\r\n\r\n      // 2. Find nearby active riders\r\n      const nearbyCandidates = await this.nearbyRiderService.findNearbyActiveRiders(\r\n        origin,\r\n        destination,\r\n        this.profile?.userId || this.auth.currentUser?.uid || ''\r\n      );\r\n      console.log(`Found ${nearbyCandidates.length} nearby candidates`);\r\n\r\n      // 3. Score matches by route overlap\r\n      this.nearbyMatches = await this.nearbyRiderService.scoreNearbyRiders(\r\n        this.computedPath,\r\n        nearbyCandidates\r\n      );\r\n      console.log(`Found ${this.nearbyMatches.length} matching routes`);\r\n\r\n      this.nearbyRidersCount = this.nearbyMatches.length;\r\n\r\n      // 4. If good matches found, create opportunity and notify\r\n      if (this.nearbyMatches.length > 0) {\r\n        await this.createAndNotifySharedRideOpportunity();\r\n      }\r\n\r\n      this.isCalculatingRoute = false;\r\n    } catch (error) {\r\n      console.error('Error finding nearby matches:', error);\r\n      this.isCalculatingRoute = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create shared ride opportunity and notify nearby riders\r\n   */\r\n  private async createAndNotifySharedRideOpportunity(): Promise<void> {\r\n    if (!this.computedPath || !this.profile) return;\r\n\r\n    try {\r\n      const origin: RouteLatLng = { lat: this.LatLng.lat, lng: this.LatLng.lng };\r\n      const destination: RouteLatLng = { lat: this.D_LatLng.lat, lng: this.D_LatLng.lng };\r\n\r\n      // Create opportunity\r\n      this.sharedRideOpportunityId = await this.nearbyRiderService.createSharedRideOpportunity(\r\n        this.profile.userId || this.auth.currentUser?.uid,\r\n        this.profile.firstName || 'A rider',\r\n        origin,\r\n        destination,\r\n        this.locationAddress || 'Current Location',\r\n        this.destinationAddress || 'Destination',\r\n        this.price || 0,\r\n        this.computedPath\r\n      );\r\n\r\n      console.log('Created shared ride opportunity:', this.sharedRideOpportunityId);\r\n\r\n      // Notify nearby riders\r\n      const originArea = this.nearbyRiderService.getGeneralAreaFromAddress(this.locationAddress || '');\r\n      const destArea = this.nearbyRiderService.getGeneralAreaFromAddress(this.destinationAddress || '');\r\n\r\n      const notificationsSent = await this.nearbyRiderService.notifyNearbyRiders(\r\n        this.nearbyMatches,\r\n        {\r\n          name: this.profile.firstName || 'A rider',\r\n          originArea,\r\n          destinationArea: destArea\r\n        },\r\n        this.sharedRideOpportunityId\r\n      );\r\n\r\n      if (notificationsSent > 0) {\r\n        const toast = await this.toastController.create({\r\n          message: `Notified ${notificationsSent} nearby rider(s) about your trip!`,\r\n          duration: 3000,\r\n          position: 'top',\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error creating shared ride opportunity:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to nearby shared ride opportunities\r\n   */\r\n  subscribeToNearbyOpportunities(): void {\r\n    if (!this.LatLng || !this.profile) return;\r\n\r\n    const location: RouteLatLng = { lat: this.LatLng.lat, lng: this.LatLng.lng };\r\n    const riderId = this.profile.userId || this.auth.currentUser?.uid || '';\r\n\r\n    this.nearbyOpportunitiesSubscription = this.nearbyRiderService\r\n      .subscribeToNearbyOpportunities(location, riderId)\r\n      .subscribe((opportunities) => {\r\n        this.ngZone.run(() => {\r\n          this.availableSharedRides = opportunities.filter(opp => \r\n            opp.initiatorId !== riderId && opp.status === 'open'\r\n          );\r\n          \r\n          // Show prompt if good matches available and sharing enabled\r\n          if (this.availableSharedRides.length > 0 && this.sharedRideEnabled) {\r\n            this.nearbyRidersCount = this.availableSharedRides.length;\r\n          }\r\n        });\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Show shared ride opportunities modal\r\n   */\r\n  viewSharedRides(): void {\r\n    if (this.availableSharedRides.length > 0) {\r\n      this.showSharedRidePrompt = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Accept a shared ride opportunity\r\n   */\r\n  async acceptSharedRideOpportunity(opportunity: SharedRideOpportunity): Promise<void> {\r\n    try {\r\n      await this.overlay.showLoader('Joining shared ride...');\r\n\r\n      const riderId = this.profile?.userId || this.auth.currentUser?.uid || '';\r\n      const riderName = this.profile?.firstName || 'Rider';\r\n\r\n      const success = await this.nearbyRiderService.acceptOpportunity(\r\n        opportunity.opportunityId,\r\n        riderId,\r\n        riderName\r\n      );\r\n\r\n      if (success) {\r\n        // Set local state\r\n        this.selectedSharedRide = opportunity;\r\n        this.isSharedRide = true;\r\n        this.discountPercent = opportunity.potentialDiscount;\r\n        this.originalPrice = this.price;\r\n        this.discountedPrice = this.price * (1 - opportunity.potentialDiscount / 100);\r\n        this.price = this.discountedPrice;\r\n\r\n        this.showSharedRidePrompt = false;\r\n        this.overlay.hideLoader();\r\n\r\n        // Show success message\r\n        const toast = await this.toastController.create({\r\n          message: `Joined shared ride! Saving ${opportunity.potentialDiscount}%`,\r\n          duration: 3000,\r\n          position: 'top',\r\n          color: 'success'\r\n        });\r\n        await toast.present();\r\n      } else {\r\n        this.overlay.hideLoader();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error accepting shared ride:', error);\r\n      this.overlay.hideLoader();\r\n      await this.overlay.showAlert('Error', 'Could not join shared ride. Please try again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dismiss shared ride prompt\r\n   */\r\n  dismissSharedRidePrompt(): void {\r\n    this.showSharedRidePrompt = false;\r\n  }\r\n\r\n  /**\r\n   * Handle deep link from shared ride notification\r\n   */\r\n  async handleSharedRideDeepLink(opportunityId: string): Promise<void> {\r\n    try {\r\n      const opportunity = await this.nearbyRiderService.getOpportunity(opportunityId);\r\n      \r\n      if (opportunity && opportunity.status === 'open') {\r\n        this.selectedSharedRide = opportunity;\r\n        this.availableSharedRides = [opportunity];\r\n        this.showSharedRidePrompt = true;\r\n      } else {\r\n        const toast = await this.toastController.create({\r\n          message: 'This shared ride opportunity is no longer available',\r\n          duration: 3000,\r\n          position: 'top',\r\n          color: 'warning'\r\n        });\r\n        await toast.present();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error handling deep link:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enhanced toggle shared ride with route matching\r\n   */\r\n  async onSharedRideToggle(event: any): Promise<void> {\r\n    this.toggleSharedRide(event);\r\n    \r\n    if (this.sharedRideEnabled) {\r\n      // Start listening for nearby opportunities\r\n      this.subscribeToNearbyOpportunities();\r\n      \r\n      // If we already have destination, find matches\r\n      if (this.D_LatLng && this.D_LatLng.lat) {\r\n        await this.findNearbySharedRideMatches();\r\n      }\r\n    } else {\r\n      // Cleanup subscriptions\r\n      if (this.nearbyOpportunitiesSubscription) {\r\n        this.nearbyOpportunitiesSubscription.unsubscribe();\r\n        this.nearbyOpportunitiesSubscription = null;\r\n      }\r\n      this.nearbyRiderService.unsubscribeFromOpportunities();\r\n      this.availableSharedRides = [];\r\n      this.nearbyRidersCount = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup Dijkstra-related subscriptions\r\n   */\r\n  private cleanupDijkstraSubscriptions(): void {\r\n    if (this.nearbyOpportunitiesSubscription) {\r\n      this.nearbyOpportunitiesSubscription.unsubscribe();\r\n      this.nearbyOpportunitiesSubscription = null;\r\n    }\r\n    this.nearbyRiderService.unsubscribeFromOpportunities();\r\n    this.computedPath = null;\r\n    this.nearbyMatches = [];\r\n    this.availableSharedRides = [];\r\n    this.selectedSharedRide = null;\r\n    this.sharedRideOpportunityId = null;\r\n    this.nearbyRidersCount = 0;\r\n  }\r\n\r\n}","<ion-header class=\"ion-no-border\" [translucent]=\"true\" style=\"position: relative; z-index: 1000;\">\r\n  <!--destination bar-->\r\n  <ion-toolbar class=\"ion-padding:10px\" *ngIf=\"confirmStage\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button shape=\"round\" (click)=\"goBackToAutoComplete()\">\r\n        <ion-icon slot=\"icon-only\" name=\"arrow-back\" color=\"tertiary\"></ion-icon> \r\n      </ion-button>\r\n    </ion-buttons>\r\n    <ion-title>{{ 'CANCEL' | translate }}</ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-item fill=\"outline\" class=\"duration\" color=\"primary\" lines=\"none\">\r\n        <ion-icon slot=\"icon-only\" name=\"flag\" color=\"primary\"></ion-icon>\r\n        <ion-label *ngIf=\"duration\" color=\"primary\"><h1>{{duration}}</h1></ion-label>\r\n      </ion-item>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n\r\n  \r\n  <ion-item lines=\"none\" color='light' class=\"main-buttons ion-no-padding\" class='top_bar'  (click)=\"goBackToAutoComplete()\" *ngIf=\"confirmStage\">\r\n      <ion-icon slot=\"start\" color='primary' name=\"pencil\"></ion-icon>\r\n      <ion-label color='primary' >{{destinationAddress}}</ion-label>\r\n  </ion-item>\r\n  \r\n\r\n  <!--menu button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-menu-button color=\"primary\"></ion-menu-button>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--sos button-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"end\" (click)=\"GotoSupport()\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon color=\"primary\" name=\"chatbubble-ellipses\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--Test Push Notification button (for debugging - remove in production)-->\r\n  <ion-fab *ngIf=\"bookingStage\" vertical=\"top\" horizontal=\"end\" style=\"top: 100px;\" (click)=\"testPushNotifications()\">\r\n    <ion-fab-button color=\"warning\" size=\"small\">\r\n      <ion-icon name=\"notifications\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n   <!--back button if map Pin-->\r\n   <ion-fab *ngIf=\"mapPinStage\" vertical=\"top\" (click)=\"goBackToAutoComplete()\" horizontal=\"start\" style=\"top: 35px;\">\r\n    <ion-fab-button color=\"light\">\r\n      <ion-icon name=\"arrow-back\" color=\"primary\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  <!--Search Bar-->\r\n\r\n  <!-- Driver arrival time header -->\r\n  <ion-toolbar *ngIf=\"trackingStage\" class=\"ion-text-center\">\r\n    <ion-title>{{ 'DRIVER_ARRIVES' | translate }} {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n  \r\n  <!-- Destination arrival time header -->\r\n  <ion-toolbar *ngIf=\"drivingToDestinationStage\" class=\"ion-text-center\">\r\n    <ion-title>{{ 'ARRIVAL_IN' | translate }} {{duration}}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n\r\n<!--Capacitor Google Map-->\r\n\r\n<ion-content scroll-y=\"false\">\r\n  \r\n  <capacitor-google-maps #map style=\"width: 100%; height: 100%;\">\r\n   \r\n  </capacitor-google-maps>\r\n\r\n\r\n  <ion-fab *ngIf=\"bookingStage && showResetLocationButton\" vertical=\"bottom\" horizontal=\"end\" style=\"bottom: 130px;\">\r\n    <ion-fab-button color=\"light\" (click)=\"resetLocation()\">\r\n      <ion-icon name=\"locate\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n\r\n  \r\n</ion-content>\r\n\r\n\r\n\r\n<ion-fab class=\"centerPin\" *ngIf=\"mapPinStage\" vertical=\"center\" horizontal=\"center\" style=\"z-index: 1000;\">\r\n    <ion-avatar>\r\n      <ion-img src=\"../../assets/icon/pin.png\"></ion-img>\r\n    </ion-avatar>\r\n</ion-fab>\r\n\r\n  <ion-footer  [translucent]=\"true\" class=\"ion-no-border\" style=\"position: relative; z-index: 1000;\">\r\n    <div #bottomBar>\r\n    <ion-row>\r\n\r\n\r\n      <!--where to bar and button-->\r\n      <div class=\"bottomItems shadow-top\" *ngIf=\"bookingStage\">\r\n  \r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom \">\r\n          <ion-button \r\n          [disabled]=\"!locationAddress\" \r\n          shape=\"round\" \r\n          class=\"main-button\" \r\n          size=\"large\" \r\n          type=\"submit\" \r\n          (click)=\"showAutocompleteModal()\" \r\n          expand=\"block\">\r\n          <ion-icon slot=\"start\" name=\"search\" color=\"primary\"></ion-icon>\r\n          <ion-label>{{ locationAddress ? ('WHERE_TO' | translate) : ('WAITING_ADDRESS' | translate) }}</ion-label>\r\n        </ion-button>\r\n        \r\n        </ion-item-group>\r\n\r\n      </div>\r\n\r\n      <!--Map Pin Choose Bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"mapPinStage\">\r\n\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n          <ion-button shape=\"round\" size=\"large\" type=\"submit\" (click)=\"getDistanceAndDirections()\" expand=\"block\">\r\n            <ion-icon slot=\"end\" name=\"arrow-forward\"></ion-icon>\r\n            <ion-label>{{destinationAddress}}</ion-label>\r\n          </ion-button>\r\n        </ion-item-group>\r\n\r\n      </div>\r\n\r\n      <!--No driver Found Bar-->\r\n      \r\n      <div class='bottomItems shadow-top' *ngIf=\"noDriverStage\">\r\n        <ion-list-header>\r\n          <ion-item lines=\"none\" style=\"margin: 2px;\">\r\n              <img src=\"../../assets/imgs/No connection-pana.svg\" style=\"height: 200px; width: 150px; margin: 0 auto;\">\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n       <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n        \r\n               <ion-button shape=\"round\"  class='main-button' size=\"large\" type=\"submit\" color=\"primary\" (click)=\"ReturnHome()\" expand=\"block\">\r\n                 <ion-icon slot=\"start\" name=\"arrow-back\"></ion-icon>\r\n                 <ion-label>{{ 'NO_DRIVERS' | translate }}</ion-label>\r\n               </ion-button>\r\n            \r\n       </ion-item-group>\r\n\r\n     </div>\r\n\r\n      <!--Car type, payment, confirmation and Selection Bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"confirmStage\">\r\n        <!-- Modern card layout -->\r\n        <div class=\"ride-confirmation-card\">\r\n          <!-- Vehicle info with price section -->\r\n          <div *ngIf=\"price\" class=\"ride-details\">\r\n            <div class=\"vehicle-info\" (click)=\"ShowDriverInfoPop()\">\r\n              <ion-avatar>\r\n                <ion-img src=\"../../assets/icon/pin.png\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2>{{carname}} <ion-icon name=\"information-circle\" color=\"primary\"></ion-icon></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <span><ion-icon name=\"time\" color=\"primary\"></ion-icon> {{D_duration}}</span>\r\n                  <span><ion-icon name=\"person\" color=\"primary\"></ion-icon> {{driver_number_of_seats}} seats</span>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2 *ngIf=\"!sharedRideEnabled\">{{settingsService.currencySymbol}}{{price}}</h2>\r\n                <h2 *ngIf=\"sharedRideEnabled\" class=\"shared-price\">\r\n                  {{settingsService.currencySymbol}}{{getDiscountedPriceRange().min.toFixed(0)}} - {{settingsService.currencySymbol}}{{getDiscountedPriceRange().max.toFixed(0)}}\r\n                </h2>\r\n                <p class=\"original-price\" *ngIf=\"sharedRideEnabled\"><del>{{settingsService.currencySymbol}}{{price}}</del></p>\r\n                <p class=\"original-price\" *ngIf=\"!sharedRideEnabled\"><del>{{settingsService.currencySymbol}}{{price*2}}</del></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Loading skeleton for ride details -->\r\n          <div *ngIf=\"!price\" class=\"ride-details skeleton\">\r\n            <div class=\"vehicle-info\">\r\n              <ion-avatar>\r\n                <ion-skeleton-text [animated]=\"true\"></ion-skeleton-text>\r\n              </ion-avatar>\r\n              <div class=\"vehicle-details\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text></h2>\r\n                <p class=\"vehicle-stats\">\r\n                  <ion-skeleton-text [animated]=\"true\" style=\"width: 130px\"></ion-skeleton-text>\r\n                </p>\r\n              </div>\r\n              <div class=\"price-tag\">\r\n                <h2><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></h2>\r\n                <p><ion-skeleton-text [animated]=\"true\" style=\"width: 60px\"></ion-skeleton-text></p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Share & Save Toggle -->\r\n          <div class=\"shared-ride-toggle\" *ngIf=\"price\">\r\n            <ion-item lines=\"none\" class=\"share-save-item\">\r\n              <ion-icon name=\"people-outline\" slot=\"start\" color=\"success\"></ion-icon>\r\n              <ion-label>\r\n                <h3>{{ 'SHARED_RIDE.TOGGLE_TITLE' | translate }}</h3>\r\n                <p>{{ 'SHARED_RIDE.TOGGLE_DESCRIPTION' | translate }}</p>\r\n              </ion-label>\r\n              <ion-toggle \r\n                slot=\"end\" \r\n                color=\"success\"\r\n                [checked]=\"sharedRideEnabled\"\r\n                (ionChange)=\"onSharedRideToggle($event)\">\r\n              </ion-toggle>\r\n            </ion-item>\r\n            <div class=\"savings-preview\" *ngIf=\"sharedRideEnabled\">\r\n              <ion-icon name=\"pricetag-outline\" color=\"success\"></ion-icon>\r\n              <span>{{ 'SHARED_RIDE.POTENTIAL_SAVINGS' | translate }}: {{settingsService.currencySymbol}}{{getPotentialSavings().min.toFixed(2)}} - {{settingsService.currencySymbol}}{{getPotentialSavings().max.toFixed(2)}}</span>\r\n            </div>\r\n            \r\n            <!-- Calculating route indicator -->\r\n            <div class=\"calculating-route\" *ngIf=\"isCalculatingRoute\">\r\n              <ion-spinner name=\"dots\" color=\"primary\"></ion-spinner>\r\n              <span>{{ 'SHARED_RIDE.CALCULATING_ROUTE' | translate }}</span>\r\n            </div>\r\n            \r\n            <!-- Nearby riders banner -->\r\n            <div class=\"nearby-riders-banner\" *ngIf=\"sharedRideEnabled && nearbyRidersCount > 0 && !isCalculatingRoute\" (click)=\"viewSharedRides()\">\r\n              <ion-icon name=\"people\" color=\"success\"></ion-icon>\r\n              <span>{{ nearbyRidersCount }} {{ 'SHARED_RIDE.RIDERS_NEARBY' | translate }}</span>\r\n              <ion-button fill=\"clear\" size=\"small\" color=\"success\">\r\n                {{ 'SHARED_RIDE.VIEW_MATCHES' | translate }}\r\n                <ion-icon name=\"chevron-forward\" slot=\"end\"></ion-icon>\r\n              </ion-button>\r\n            </div>\r\n          </div>\r\n          \r\n          <!-- Payment method selector -->\r\n          <div class=\"payment-selector\">\r\n            <ion-item lines=\"none\">\r\n              <ion-icon name=\"wallet-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n              <ion-label>{{ 'PAYMENT.PAYMENT_METHOD' | translate }}</ion-label>\r\n              <ion-select [value]=\"selectedCard\" (ionChange)=\"chooseCard($event)\" interface=\"action-sheet\">\r\n                <ion-select-option value=\"cash\">\r\n                  {{ 'CASH' | translate }}\r\n                </ion-select-option>\r\n                <ion-select-option *ngFor=\"let card of savedPaymentMethods\" [value]=\"card.cardId\">\r\n                  {{card.brand | titlecase}}  {{card.last4}}\r\n                </ion-select-option>\r\n                <ion-select-option value=\"add_card\">\r\n                  {{ 'PAYMENT.ADD_NEW_CARD_OPTION' | translate }}\r\n                </ion-select-option>\r\n              </ion-select>\r\n            </ion-item>\r\n            <ion-note *ngIf=\"!savedPaymentMethods || savedPaymentMethods.length === 0\" class=\"payment-hint\">\r\n              <ion-icon name=\"information-circle-outline\" color=\"primary\"></ion-icon>\r\n              {{ 'PAYMENT.CASH_HINT' | translate }}\r\n            </ion-note>\r\n          </div>\r\n          \r\n          <!-- Book ride button -->\r\n          <div class=\"book-button-container\">\r\n            <ion-button class=\"book-ride-btn\" shape=\"round\" color=\"primary\" size=\"large\" \r\n                      expand=\"block\" (click)=\"StartRide()\">\r\n              <ion-icon *ngIf='price' slot=\"start\" name=\"checkmark-sharp\"></ion-icon>\r\n              <ion-progress-bar color=\"light\" *ngIf='!price' type=\"indeterminate\"></ion-progress-bar>\r\n              <ion-label *ngIf='price'>{{ 'BOOK_RIDE' | translate }}</ion-label>\r\n            </ion-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n\r\n<!-- Connecting to driver bar-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"searchingStage\">\r\n         <ion-list-header>\r\n          <ion-item>\r\n            <ion-avatar slot=\"start\">\r\n              <ion-img [src]=\"currentDriver.Driver_imgUrl\"></ion-img>\r\n            </ion-avatar>\r\n            <ion-label>\r\n\r\n              <h1>{{currentDriver.Driver_name}}</h1>\r\n              <p>{{ 'DRIVER_ARRIVES' | translate }} {{duration}}</p>\r\n\r\n            </ion-label>\r\n          </ion-item>\r\n            \r\n         </ion-list-header>\r\n        <ion-item-group class=\"ion-margin-horizontal ion-margin-bottom\">\r\n\r\n                <ion-button fill=\"outline\" shape=\"round\" color=\"danger\" class='main-button' size=\"large\" type=\"submit\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                  <ion-icon slot=\"start\" name=\"close-circle-outline\" color=\"danger\"></ion-icon>\r\n                  <ion-label>{{ 'CANCEL' | translate }}</ion-label>\r\n                </ion-button>\r\n                 \r\n                <ion-progress-bar color=\"primary\" class=\"ion-padding\" type=\"indeterminate\"></ion-progress-bar>\r\n\r\n             \r\n        </ion-item-group>\r\n       \r\n      </div>\r\n\r\n\r\n\r\n       <!--Driver tracking to user bar (FIXED LAYOUT)-->\r\n       <div class='bottomItems shadow-top' *ngIf=\"trackingStage\">\r\n         <div class=\"card\">\r\n           <!-- Car information row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n               <h1>{{driverInfo.Driver_plate}}</h1>\r\n             </ion-label>\r\n             \r\n             <!-- Driver avatar and rating on right side -->\r\n             <div slot=\"end\" class=\"driver-avatar-container\">\r\n               <ion-avatar>\r\n                 <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n               </ion-avatar>\r\n               <div class=\"driver-rating\">\r\n                 <ion-icon color=\"warning\" name=\"star\"></ion-icon>\r\n                 <span>{{driverInfo.Driver_rating}}</span>\r\n               </div>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- Driver name row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label>\r\n               <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n               <p>1,832 rides</p>\r\n             </ion-label>\r\n           </ion-item>\r\n\r\n           <!-- Payment row -->\r\n           <ion-item lines=\"none\" class=\"driver-card-item\">\r\n             <ion-label *ngIf=\"cash\">\r\n               <h2><ion-icon color='primary' name=\"cash\"></ion-icon> {{ 'CASH' | translate }}</h2>\r\n             </ion-label>\r\n             <ion-label *ngIf=\"!cash\">\r\n               <h2><ion-icon color='primary' name=\"card\"></ion-icon> {{ 'CARD' | translate }}</h2>\r\n             </ion-label>\r\n             \r\n             <div slot=\"end\" class=\"price-container\">\r\n               <h1>{{settingsService.currencySymbol}}{{price}}</h1>\r\n             </div>\r\n           </ion-item>\r\n\r\n           <!-- More options accordion (made more visible) -->\r\n           <ion-accordion-group class=\"driver-actions-accordion\">\r\n             <ion-accordion value=\"first\">\r\n               <ion-item slot=\"header\" class=\"accordion-header\">\r\n                 <ion-label><h2>{{ 'MORE_OPTIONS' | translate }}</h2></ion-label>\r\n               </ion-item>\r\n               <div slot=\"content\" class=\"accordion-content\">\r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                   <ion-label>{{ 'CONTACT_DRIVER' | translate }}</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                   <ion-label>{{ 'CHAT_DRIVER' | translate }}</ion-label>\r\n                 </ion-button>\r\n                 \r\n                 <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"presentCancelRideActionSheet()\">\r\n                   <ion-icon color='primary' slot=\"start\" name=\"close\"></ion-icon>\r\n                   <ion-label>{{ 'CANCEL_RIDE' | translate }}</ion-label>\r\n                 </ion-button>\r\n               </div>\r\n             </ion-accordion>\r\n           </ion-accordion-group>\r\n         </div>\r\n       </div>\r\n\r\n\r\n\r\n    \r\n   <!--Rider Picked Up now tracking to destination bar (FIXED LAYOUT)-->\r\n      <div class='bottomItems shadow-top' *ngIf=\"drivingToDestinationStage\">\r\n        <div class=\"card\">\r\n          <!-- Car information row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <p>{{driverInfo.Driver_car}}.{{driverInfo.Driver_cartype}}</p>\r\n              <h1>{{driverInfo.Driver_plate}}</h1>\r\n            </ion-label>\r\n            \r\n            <!-- Driver avatar and rating on right side -->\r\n            <div slot=\"end\" class=\"driver-avatar-container\">\r\n              <ion-avatar>\r\n                <ion-img [src]=\"driverInfo.Driver_imgUrl\"></ion-img>\r\n              </ion-avatar>\r\n              <div class=\"driver-rating\">\r\n                <ion-icon color=\"secondary\" name=\"star\"></ion-icon>\r\n                <span>{{driverInfo.Driver_rating || 5}}</span>\r\n              </div>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Driver name row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label>\r\n              <ion-text color=\"primary\">{{driverInfo.Driver_name}}</ion-text>\r\n              <p>1,832 rides</p>\r\n            </ion-label>\r\n          </ion-item>\r\n\r\n          <!-- Payment row -->\r\n          <ion-item lines=\"none\" class=\"driver-card-item\">\r\n            <ion-label *ngIf=\"cash\">\r\n              <h2><ion-icon color='primary' name=\"cash\"></ion-icon> {{ 'CASH' | translate }}</h2>\r\n            </ion-label>\r\n            <ion-label *ngIf=\"!cash\">\r\n              <h2><ion-icon color='primary' name=\"card\"></ion-icon> {{ 'CARD' | translate }}</h2>\r\n            </ion-label>\r\n            \r\n            <div slot=\"end\" class=\"price-container\">\r\n              <h1>{{settingsService.currencySymbol}}{{price}}</h1>\r\n            </div>\r\n          </ion-item>\r\n\r\n          <!-- Added accordion here too for consistency -->\r\n          <ion-accordion-group class=\"driver-actions-accordion\">\r\n            <ion-accordion value=\"first\">\r\n              <ion-item slot=\"header\" class=\"accordion-header\">\r\n                <ion-label><h2>{{ 'MORE_OPTIONS' | translate }}</h2></ion-label>\r\n              </ion-item>\r\n              <div slot=\"content\" class=\"accordion-content\">\r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"CallDriver()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"person\"></ion-icon>\r\n                  <ion-label>{{ 'CONTACT_DRIVER' | translate }}</ion-label>\r\n                </ion-button>\r\n                \r\n                <ion-button shape=\"round\" class='main-button' size=\"large\" expand=\"block\" (click)=\"EnterChat()\">\r\n                  <ion-icon color='primary' slot=\"start\" name=\"chatbubbles\"></ion-icon>\r\n                  <ion-label>{{ 'CHAT_DRIVER' | translate }}</ion-label>\r\n                </ion-button>\r\n              </div>\r\n            </ion-accordion>\r\n          </ion-accordion-group>\r\n        </div>\r\n      </div>\r\n      \r\n\r\n\r\n    </ion-row>\r\n    </div>\r\n  </ion-footer>\r\n\r\n  <!-- Shared Ride Opportunities Modal -->\r\n  <ion-modal [isOpen]=\"showSharedRidePrompt\" (didDismiss)=\"dismissSharedRidePrompt()\">\r\n    <ng-template>\r\n      <app-shared-ride-prompt\r\n        [opportunities]=\"availableSharedRides\"\r\n        [userLocation]=\"LatLng\"\r\n        [userDestination]=\"D_LatLng\"\r\n        (accept)=\"acceptSharedRideOpportunity($event)\"\r\n        (dismiss)=\"dismissSharedRidePrompt()\">\r\n      </app-shared-ride-prompt>\r\n    </ng-template>\r\n  </ion-modal>","/**\r\n * Route Graph Interfaces for Dijkstra-based shared ride matching\r\n */\r\n\r\nexport interface LatLng {\r\n  lat: number;\r\n  lng: number;\r\n}\r\n\r\nexport interface GraphNode {\r\n  id: string;\r\n  lat: number;\r\n  lng: number;\r\n  neighbors: Edge[];\r\n}\r\n\r\nexport interface Edge {\r\n  targetId: string;\r\n  weight: number;      // Travel time in seconds\r\n  distance: number;    // Distance in meters\r\n}\r\n\r\nexport interface PathResult {\r\n  nodes: string[];\r\n  coordinates: LatLng[];\r\n  totalWeight: number;       // Total travel time in seconds\r\n  totalDistance: number;     // Total distance in meters\r\n  encodedPolyline?: string;  // Google encoded polyline\r\n}\r\n\r\nexport interface RideCandidate {\r\n  requestId: string;\r\n  riderId: string;\r\n  origin: LatLng;\r\n  destination: LatLng;\r\n  path?: PathResult;\r\n  riderName?: string;\r\n  riderToken?: string;       // OneSignal player ID for notifications\r\n  createdAt?: Date;\r\n  price?: number;\r\n}\r\n\r\nexport interface ScoredMatch {\r\n  candidate: RideCandidate;\r\n  overlapScore: number;      // 0-1, higher = more route overlap\r\n  detourCost: number;        // Additional time in seconds\r\n  detourPercent: number;     // Detour as percentage of original route\r\n  potentialSavings: number;  // Estimated fare savings percentage\r\n}\r\n\r\nexport interface NearbyRiderAlert {\r\n  riderId: string;\r\n  riderToken: string;        // OneSignal player ID\r\n  distance: number;          // Distance from new rider in meters\r\n  overlapScore: number;\r\n  message: string;\r\n}\r\n\r\nexport interface SharedRideOpportunity {\r\n  opportunityId: string;\r\n  initiatorId: string;\r\n  initiatorName: string;\r\n  originGeohash: string;        // For GeoFire queries\r\n  destinationGeohash: string;\r\n  origin: LatLng;\r\n  destination: LatLng;\r\n  originAddress: string;\r\n  destinationAddress: string;\r\n  pathEncoded?: string;         // Encoded polyline for route\r\n  estimatedPrice: number;\r\n  potentialDiscount: number;    // 10-40% based on passengers\r\n  status: 'open' | 'matched' | 'expired' | 'cancelled';\r\n  expiresAt: Date;\r\n  createdAt: Date;\r\n  matchedRiders: string[];      // Rider IDs who accepted\r\n  maxPassengers: number;\r\n}\r\n\r\n// Min-heap node for Dijkstra priority queue\r\nexport interface HeapNode {\r\n  nodeId: string;\r\n  distance: number;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { environment } from 'src/environments/environment';\r\nimport {\r\n  LatLng,\r\n  GraphNode,\r\n  Edge,\r\n  PathResult,\r\n  RideCandidate,\r\n  ScoredMatch,\r\n  HeapNode\r\n} from '../interfaces/route-graph';\r\nimport * as polyline from '@mapbox/polyline';\r\n\r\n/**\r\n * API Request/Response interfaces\r\n */\r\ninterface WeightConfig {\r\n  distance?: number;\r\n  time?: number;\r\n  traffic?: number;\r\n}\r\n\r\ninterface RouteApiRequest {\r\n  start: LatLng;\r\n  end: LatLng;\r\n  weightConfig?: WeightConfig;\r\n  timeout?: number;\r\n}\r\n\r\ninterface RouteApiResponse {\r\n  polyline: string;\r\n  distance: number;\r\n  duration: number;\r\n  instructions?: any[];\r\n}\r\n\r\n/**\r\n * MinHeap implementation for Dijkstra's priority queue\r\n */\r\nclass MinHeap {\r\n  private heap: HeapNode[] = [];\r\n\r\n  push(node: HeapNode): void {\r\n    this.heap.push(node);\r\n    this.bubbleUp(this.heap.length - 1);\r\n  }\r\n\r\n  pop(): HeapNode | undefined {\r\n    if (this.heap.length === 0) return undefined;\r\n    const min = this.heap[0];\r\n    const last = this.heap.pop();\r\n    if (this.heap.length > 0 && last) {\r\n      this.heap[0] = last;\r\n      this.bubbleDown(0);\r\n    }\r\n    return min;\r\n  }\r\n\r\n  isEmpty(): boolean {\r\n    return this.heap.length === 0;\r\n  }\r\n\r\n  private bubbleUp(index: number): void {\r\n    while (index > 0) {\r\n      const parentIndex = Math.floor((index - 1) / 2);\r\n      if (this.heap[parentIndex].distance <= this.heap[index].distance) break;\r\n      [this.heap[parentIndex], this.heap[index]] = [this.heap[index], this.heap[parentIndex]];\r\n      index = parentIndex;\r\n    }\r\n  }\r\n\r\n  private bubbleDown(index: number): void {\r\n    const length = this.heap.length;\r\n    while (true) {\r\n      const leftChild = 2 * index + 1;\r\n      const rightChild = 2 * index + 2;\r\n      let smallest = index;\r\n\r\n      if (leftChild < length && this.heap[leftChild].distance < this.heap[smallest].distance) {\r\n        smallest = leftChild;\r\n      }\r\n      if (rightChild < length && this.heap[rightChild].distance < this.heap[smallest].distance) {\r\n        smallest = rightChild;\r\n      }\r\n      if (smallest === index) break;\r\n      [this.heap[index], this.heap[smallest]] = [this.heap[smallest], this.heap[index]];\r\n      index = smallest;\r\n    }\r\n  }\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DijkstraService {\r\n  // Cache for computed paths (key: \"lat1,lng1-lat2,lng2\")\r\n  private pathCache: Map<string, PathResult> = new Map();\r\n  private readonly CACHE_TTL_MS = 5 * 60 * 1000; // 5 minutes cache TTL\r\n  private cacheTimestamps: Map<string, number> = new Map();\r\n\r\n  // Earth radius in meters for Haversine calculation\r\n  private readonly EARTH_RADIUS_M = 6371000;\r\n\r\n  private readonly API_URL = 'https://asia-southeast1-dijkstra-routing-demo-se-f3d91.cloudfunctions.net/computeRoute';\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  /**\r\n   * Calculate shortest path using the Dijkstra Routing API\r\n   */\r\n  async findShortestPath(origin: LatLng, destination: LatLng, weightConfig?: WeightConfig): Promise<PathResult> {\r\n    const cacheKey = this.getCacheKey(origin, destination);\r\n    \r\n    // Check cache first\r\n    const cached = this.getFromCache(cacheKey);\r\n    if (cached) {\r\n      console.log('Returning cached path for:', cacheKey);\r\n      return cached;\r\n    }\r\n\r\n    try {\r\n      // Call the Dijkstra Routing API\r\n      const route = await this.getDijkstraRoute(origin, destination, weightConfig);\r\n      \r\n      if (!route) {\r\n        throw new Error('No route found');\r\n      }\r\n\r\n      const pathResult: PathResult = {\r\n        nodes: route.nodes,\r\n        coordinates: route.coordinates,\r\n        totalWeight: route.duration, // seconds\r\n        totalDistance: route.distance, // meters\r\n        encodedPolyline: route.encodedPolyline\r\n      };\r\n\r\n      // Cache the result\r\n      this.setCache(cacheKey, pathResult);\r\n\r\n      return pathResult;\r\n    } catch (error) {\r\n      console.error('Error finding shortest path:', error);\r\n      \r\n      // Fallback: return direct path with Haversine distance\r\n      return this.createDirectPath(origin, destination);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get route from Dijkstra Routing API\r\n   */\r\n  private async getDijkstraRoute(origin: LatLng, destination: LatLng, weightConfig?: WeightConfig): Promise<{\r\n    nodes: string[];\r\n    coordinates: LatLng[];\r\n    duration: number;\r\n    distance: number;\r\n    encodedPolyline: string;\r\n  } | null> {\r\n    const request: RouteApiRequest = {\r\n      start: origin,\r\n      end: destination,\r\n      weightConfig: weightConfig || { distance: 1, time: 0.5 } // Default weights\r\n    };\r\n\r\n    try {\r\n      const response = await this.http.post<RouteApiResponse>(this.API_URL, request).toPromise();\r\n      \r\n      if (!response || !response.polyline) {\r\n        return null;\r\n      }\r\n\r\n      // Decode the polyline to get coordinates\r\n      const decodedCoords: [number, number][] = polyline.decode(response.polyline);\r\n      const coordinates: LatLng[] = decodedCoords.map(([lat, lng]) => ({ lat, lng }));\r\n      \r\n      // Create node IDs for each coordinate\r\n      const nodes: string[] = coordinates.map((_, index) => `node_${index}`);\r\n\r\n      return {\r\n        nodes,\r\n        coordinates,\r\n        duration: response.duration,\r\n        distance: response.distance,\r\n        encodedPolyline: response.polyline\r\n      };\r\n    } catch (error) {\r\n      console.error('API call failed:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create a direct path when no route is available (fallback)\r\n   */\r\n  private createDirectPath(origin: LatLng, destination: LatLng): PathResult {\r\n    const distance = this.calculateHaversineDistance(origin, destination);\r\n    // Estimate duration: average speed ~40 km/h in city\r\n    const duration = (distance / 1000) / 40 * 3600; // seconds\r\n\r\n    return {\r\n      nodes: ['origin', 'destination'],\r\n      coordinates: [origin, destination],\r\n      totalWeight: Math.round(duration),\r\n      totalDistance: Math.round(distance),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Run Dijkstra's algorithm on a graph\r\n   * This is used when we have a pre-built road network graph\r\n   */\r\n  runDijkstra(\r\n    graph: Map<string, GraphNode>,\r\n    startId: string,\r\n    endId: string\r\n  ): PathResult | null {\r\n    const distances: Map<string, number> = new Map();\r\n    const previous: Map<string, string | null> = new Map();\r\n    const visited: Set<string> = new Set();\r\n    const heap = new MinHeap();\r\n\r\n    // Initialize distances\r\n    graph.forEach((_, nodeId) => {\r\n      distances.set(nodeId, Infinity);\r\n      previous.set(nodeId, null);\r\n    });\r\n\r\n    distances.set(startId, 0);\r\n    heap.push({ nodeId: startId, distance: 0 });\r\n\r\n    while (!heap.isEmpty()) {\r\n      const current = heap.pop()!;\r\n      \r\n      if (visited.has(current.nodeId)) continue;\r\n      visited.add(current.nodeId);\r\n\r\n      // Found destination\r\n      if (current.nodeId === endId) break;\r\n\r\n      const currentNode = graph.get(current.nodeId);\r\n      if (!currentNode) continue;\r\n\r\n      // Process neighbors\r\n      for (const edge of currentNode.neighbors) {\r\n        if (visited.has(edge.targetId)) continue;\r\n\r\n        const newDistance = distances.get(current.nodeId)! + edge.weight;\r\n        \r\n        if (newDistance < distances.get(edge.targetId)!) {\r\n          distances.set(edge.targetId, newDistance);\r\n          previous.set(edge.targetId, current.nodeId);\r\n          heap.push({ nodeId: edge.targetId, distance: newDistance });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Reconstruct path\r\n    if (distances.get(endId) === Infinity) {\r\n      return null; // No path found\r\n    }\r\n\r\n    const path: string[] = [];\r\n    const coordinates: LatLng[] = [];\r\n    let totalDistance = 0;\r\n    let currentId: string | null = endId;\r\n\r\n    while (currentId) {\r\n      path.unshift(currentId);\r\n      const node = graph.get(currentId);\r\n      if (node) {\r\n        coordinates.unshift({ lat: node.lat, lng: node.lng });\r\n      }\r\n      \r\n      const prevId = previous.get(currentId);\r\n      if (prevId) {\r\n        const prevNode = graph.get(prevId);\r\n        if (prevNode) {\r\n          const edge = prevNode.neighbors.find(e => e.targetId === currentId);\r\n          if (edge) {\r\n            totalDistance += edge.distance;\r\n          }\r\n        }\r\n      }\r\n      currentId = prevId ?? null;\r\n    }\r\n\r\n    return {\r\n      nodes: path,\r\n      coordinates,\r\n      totalWeight: distances.get(endId)!,\r\n      totalDistance\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate route overlap between two paths using Jaccard similarity\r\n   * Returns a value between 0 and 1 (1 = identical routes)\r\n   */\r\n  calculateRouteOverlap(path1: PathResult, path2: PathResult): number {\r\n    if (!path1.coordinates.length || !path2.coordinates.length) {\r\n      return 0;\r\n    }\r\n\r\n    // Use a grid-based approach to find overlapping segments\r\n    const GRID_SIZE = 100; // 100 meters grid cell\r\n    \r\n    const getGridKey = (coord: LatLng): string => {\r\n      const latGrid = Math.floor(coord.lat * 111000 / GRID_SIZE);\r\n      const lngGrid = Math.floor(coord.lng * 111000 * Math.cos(coord.lat * Math.PI / 180) / GRID_SIZE);\r\n      return `${latGrid},${lngGrid}`;\r\n    };\r\n\r\n    // Create sets of grid cells for each path\r\n    const set1 = new Set<string>();\r\n    const set2 = new Set<string>();\r\n\r\n    path1.coordinates.forEach(coord => set1.add(getGridKey(coord)));\r\n    path2.coordinates.forEach(coord => set2.add(getGridKey(coord)));\r\n\r\n    // Calculate Jaccard similarity\r\n    let intersection = 0;\r\n    set1.forEach(key => {\r\n      if (set2.has(key)) intersection++;\r\n    });\r\n\r\n    const union = set1.size + set2.size - intersection;\r\n    \r\n    return union > 0 ? intersection / union : 0;\r\n  }\r\n\r\n  /**\r\n   * Calculate overlap with direction awareness\r\n   * Ensures routes are going in similar direction, not just crossing\r\n   */\r\n  calculateDirectionalOverlap(path1: PathResult, path2: PathResult): number {\r\n    const basicOverlap = this.calculateRouteOverlap(path1, path2);\r\n    \r\n    if (basicOverlap < 0.1) return 0;\r\n\r\n    // Check if origins and destinations are in similar positions\r\n    const originDistance = this.calculateHaversineDistance(\r\n      path1.coordinates[0],\r\n      path2.coordinates[0]\r\n    );\r\n    const destDistance = this.calculateHaversineDistance(\r\n      path1.coordinates[path1.coordinates.length - 1],\r\n      path2.coordinates[path2.coordinates.length - 1]\r\n    );\r\n\r\n    // Penalize if routes are in opposite directions\r\n    const maxRouteLength = Math.max(path1.totalDistance, path2.totalDistance);\r\n    const directionScore = 1 - Math.min(\r\n      (originDistance + destDistance) / (2 * maxRouteLength),\r\n      1\r\n    );\r\n\r\n    return basicOverlap * (0.5 + 0.5 * directionScore);\r\n  }\r\n\r\n  /**\r\n   * Find and score similar routes from candidate rides\r\n   */\r\n  async findSimilarRoutes(\r\n    riderPath: PathResult,\r\n    candidates: RideCandidate[],\r\n    maxDetourPercent: number = 0.25\r\n  ): Promise<ScoredMatch[]> {\r\n    const matches: ScoredMatch[] = [];\r\n\r\n    for (const candidate of candidates) {\r\n      try {\r\n        // Get or compute candidate's path\r\n        let candidatePath = candidate.path;\r\n        if (!candidatePath) {\r\n          candidatePath = await this.findShortestPath(candidate.origin, candidate.destination);\r\n          candidate.path = candidatePath;\r\n        }\r\n\r\n        // Calculate overlap\r\n        const overlapScore = this.calculateDirectionalOverlap(riderPath, candidatePath);\r\n\r\n        // Skip if overlap is too low\r\n        if (overlapScore < 0.3) continue;\r\n\r\n        // Calculate detour cost (simplified: compare total distances)\r\n        const combinedPathDistance = await this.estimateCombinedPathDistance(\r\n          riderPath.coordinates[0],\r\n          riderPath.coordinates[riderPath.coordinates.length - 1],\r\n          candidate.origin,\r\n          candidate.destination\r\n        );\r\n\r\n        const originalDistance = riderPath.totalDistance + candidatePath.totalDistance;\r\n        const detourCost = combinedPathDistance - Math.max(riderPath.totalDistance, candidatePath.totalDistance);\r\n        const detourPercent = detourCost / riderPath.totalDistance;\r\n\r\n        // Skip if detour is too high\r\n        if (detourPercent > maxDetourPercent) continue;\r\n\r\n        // Calculate potential savings (10-40% based on overlap)\r\n        const potentialSavings = Math.min(10 + Math.floor(overlapScore * 30), 40);\r\n\r\n        matches.push({\r\n          candidate,\r\n          overlapScore,\r\n          detourCost,\r\n          detourPercent,\r\n          potentialSavings\r\n        });\r\n      } catch (error) {\r\n        console.error('Error processing candidate:', candidate.requestId, error);\r\n      }\r\n    }\r\n\r\n    // Sort by overlap score (highest first)\r\n    return matches.sort((a, b) => b.overlapScore - a.overlapScore);\r\n  }\r\n\r\n  /**\r\n   * Estimate combined path distance for two riders sharing a ride\r\n   */\r\n  private async estimateCombinedPathDistance(\r\n    origin1: LatLng,\r\n    dest1: LatLng,\r\n    origin2: LatLng,\r\n    dest2: LatLng\r\n  ): Promise<number> {\r\n    // Simplified estimation: use Haversine distances\r\n    // A more accurate method would use Google Directions with waypoints\r\n    \r\n    // Try different pickup/dropoff orders and find the shortest\r\n    const orders = [\r\n      [origin1, origin2, dest1, dest2],\r\n      [origin1, origin2, dest2, dest1],\r\n      [origin2, origin1, dest1, dest2],\r\n      [origin2, origin1, dest2, dest1]\r\n    ];\r\n\r\n    let minDistance = Infinity;\r\n\r\n    for (const order of orders) {\r\n      let totalDistance = 0;\r\n      for (let i = 0; i < order.length - 1; i++) {\r\n        totalDistance += this.calculateHaversineDistance(order[i], order[i + 1]);\r\n      }\r\n      minDistance = Math.min(minDistance, totalDistance);\r\n    }\r\n\r\n    return minDistance;\r\n  }\r\n\r\n  /**\r\n   * Calculate Haversine distance between two points in meters\r\n   */\r\n  calculateHaversineDistance(point1: LatLng, point2: LatLng): number {\r\n    const lat1 = point1.lat * Math.PI / 180;\r\n    const lat2 = point2.lat * Math.PI / 180;\r\n    const deltaLat = (point2.lat - point1.lat) * Math.PI / 180;\r\n    const deltaLng = (point2.lng - point1.lng) * Math.PI / 180;\r\n\r\n    const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\r\n              Math.cos(lat1) * Math.cos(lat2) *\r\n              Math.sin(deltaLng / 2) * Math.sin(deltaLng / 2);\r\n    \r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n    return this.EARTH_RADIUS_M * c;\r\n  }\r\n\r\n  /**\r\n   * Generate cache key from origin and destination\r\n   */\r\n  private getCacheKey(origin: LatLng, dest: LatLng): string {\r\n    // Round to 5 decimal places (~1 meter precision)\r\n    const round = (n: number) => Math.round(n * 100000) / 100000;\r\n    return `${round(origin.lat)},${round(origin.lng)}-${round(dest.lat)},${round(dest.lng)}`;\r\n  }\r\n\r\n  /**\r\n   * Get path from cache if valid\r\n   */\r\n  private getFromCache(key: string): PathResult | null {\r\n    const timestamp = this.cacheTimestamps.get(key);\r\n    if (!timestamp || Date.now() - timestamp > this.CACHE_TTL_MS) {\r\n      this.pathCache.delete(key);\r\n      this.cacheTimestamps.delete(key);\r\n      return null;\r\n    }\r\n    return this.pathCache.get(key) || null;\r\n  }\r\n\r\n  /**\r\n   * Set path in cache\r\n   */\r\n  private setCache(key: string, path: PathResult): void {\r\n    this.pathCache.set(key, path);\r\n    this.cacheTimestamps.set(key, Date.now());\r\n\r\n    // Clean old cache entries periodically\r\n    if (this.pathCache.size > 100) {\r\n      this.cleanCache();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean expired cache entries\r\n   */\r\n  private cleanCache(): void {\r\n    const now = Date.now();\r\n    this.cacheTimestamps.forEach((timestamp, key) => {\r\n      if (now - timestamp > this.CACHE_TTL_MS) {\r\n        this.pathCache.delete(key);\r\n        this.cacheTimestamps.delete(key);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear all cached paths\r\n   */\r\n  clearCache(): void {\r\n    this.pathCache.clear();\r\n    this.cacheTimestamps.clear();\r\n  }\r\n}\r\n\r\n// Declare google maps types\r\ndeclare var google: any;\r\n","import { Injectable } from '@angular/core';\r\nimport { Client } from '@googlemaps/google-maps-services-js';\r\nimport { environment } from 'src/environments/environment';\r\nimport { OverlayService } from './overlay.service';\r\nimport { Observable, of } from 'rxjs';\r\nimport { HttpParams, HttpClient } from '@angular/common/http';\r\nimport { catchError, map } from 'rxjs/operators';\r\n\r\ndeclare let google;\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GeocodeService {\r\n  service = new google.maps.DistanceMatrixService();\r\n  directions = new google.maps.DirectionsService();\r\n  private readonly apiUrl = 'https://maps.googleapis.com/maps/api';\r\n\r\n  constructor(private client: Client, private overlay: OverlayService, private http: HttpClient) { }\r\n\r\n  getAddress(lat: number, lng: number): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n  \r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in reverse geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Convert the address to lat and lng\r\n  getLatLng(address: string): Observable<any> {\r\n    const url = `${this.apiUrl}/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('address', address)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).pipe(\r\n      map((response: any) => response),\r\n      catchError((error) => {\r\n        console.error('Error in geocoding:', error);\r\n        this.overlay.showAlert('GeoError', error.message);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  \r\n\r\n  // Get the distance between the origin and destination\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      // You can implement the directions request here using google.maps.DirectionsService\r\n    } catch (e) {\r\n      this.overlay.showAlert('GeoError', e);\r\n      console.log(e);\r\n    }\r\n  }\r\n\r\n  getDistanceMatrix(origin: any, destination: any): Observable<any> {\r\n    const distanceMatrixService = new google.maps.DistanceMatrixService();\r\n    \r\n    return new Observable(observer => {\r\n      distanceMatrixService.getDistanceMatrix({\r\n        origins: [new google.maps.LatLng(origin.lat, origin.lng)],\r\n        destinations: [new google.maps.LatLng(destination.lat, destination.lng)],\r\n        travelMode: google.maps.TravelMode.DRIVING,\r\n      }, (response, status) => {\r\n        if (status === 'OK') {\r\n          observer.next(response);\r\n        } else {\r\n          observer.error(status);\r\n        }\r\n        observer.complete();\r\n      });\r\n    });\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { GoogleMap, Marker } from '@capacitor/google-maps';\r\nimport { environment } from 'src/environments/environment';\r\nimport { GeocodeService } from './geocode.service';\r\nimport { OverlayService } from './overlay.service';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class MapService {\r\n  private _map: GoogleMap | null = null;\r\n  \r\n  get newMap(): GoogleMap {\r\n    if (!this._map) {\r\n      throw new Error('Map not initialized');\r\n    }\r\n    return this._map;\r\n  }\r\n\r\n  set newMap(map: GoogleMap) {\r\n    this._map = map;\r\n  }\r\n\r\n  LatLng: { lat: any; lng: any; };\r\n  locationAddress: string = 'Loading..';\r\n  showResetLocationButton: boolean;\r\n  mapPinStage: any;\r\n  D_LatLng: { lat: any; lng: any; };\r\n  actualLocation: any;\r\n  exampleMapId: any;\r\n\r\n  constructor(private overlay: OverlayService, private geocode: GeocodeService, private http: HttpClient) {}\r\n\r\n  async createMap(ref: HTMLElement, coords: { coords: { latitude: number; longitude: number } }) {\r\n    try {\r\n      // Validate coords before using\r\n      const lat = coords?.coords?.latitude || 3.1390; // Default to Kuala Lumpur, Malaysia\r\n      const lng = coords?.coords?.longitude || 101.6869;\r\n      \r\n      // Destroy existing map if it exists\r\n      this._map = await GoogleMap.create({\r\n        id: 'my-cool-map',\r\n        element: ref,\r\n        apiKey: environment.apiKey,\r\n        config: {\r\n          center: {\r\n            lat: lat,\r\n            lng: lng\r\n          },\r\n          zoom: 15,\r\n          styles: [],\r\n          scaleControl: false,\r\n          streetViewControl: false,\r\n          rotateControl: false,\r\n          fullscreenControl: false,\r\n        },\r\n      });\r\n\r\n      this.LatLng = {\r\n        lat: lat,\r\n        lng: lng\r\n      };\r\n\r\n      await Promise.all([\r\n        this._map.enableTrafficLayer(true),\r\n        this._map.enableCurrentLocation(true),\r\n        this._map.setCamera({\r\n          animate: true,\r\n          animationDuration: 500,\r\n          zoom: 15,\r\n          coordinate: this.LatLng\r\n        })\r\n      ]);\r\n\r\n      const address = await this.getAddress(this.LatLng.lat, this.LatLng.lng);\r\n      this.processAddressResponse(address);\r\n\r\n    } catch (error) {\r\n      console.error('Error creating map:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async destroyMap() {\r\n    if (this._map) {\r\n      try {\r\n        await this._map.destroy();\r\n        this._map = null;\r\n      } catch (error) {\r\n        console.error('Error destroying map:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private processAddressResponse(address: any) {\r\n    if (address?.results?.length > 0) {\r\n      this.actualLocation = address.results[0].formatted_address;\r\n      \r\n      if (address.results.length > 1) {\r\n        const components = address.results[1].address_components;\r\n        if (components?.length >= 2) {\r\n          this.locationAddress = `${components[0].long_name} ${components[1].long_name}`;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  calculateCenter(points) {\r\n    const latitudes = points.map(p => p.geoCode.latitude);\r\n    const longitudes = points.map(p => p.geoCode.longitude);\r\n  \r\n    const avgLat = latitudes.reduce((a, b) => a + b, 0) / latitudes.length;\r\n    const avgLng = longitudes.reduce((a, b) => a + b, 0) / longitudes.length;\r\n  \r\n    return { latitude: avgLat, longitude: avgLng };\r\n  }\r\n\r\n  async setCameraToLocation(coordinate: { lat: number; lng: number }, zoom: number, bearing: number) {\r\n    if (!this._map) {\r\n      console.error('Map not initialized');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this._map.setCamera({\r\n        animate: true,\r\n        animationDuration: 500,\r\n        zoom,\r\n        coordinate,\r\n        bearing\r\n      });\r\n    } catch (error) {\r\n      console.error('Error setting camera:', error);\r\n    }\r\n  }\r\n  \r\n  // Add other necessary methods like getAddress here\r\n\r\n  \r\n  \r\n   getBoundsZoomLevel(bounds, mapDim) {\r\n    const WORLD_DIM = { height: 256, width: 256 };\r\n      const ZOOM_MAX = 21;\r\n\r\n      const latRad = lat => {\r\n        const sin = Math.sin((lat * Math.PI) / 180);\r\n        const radX2 = Math.log((1 + sin) / (1 - sin)) / 2;\r\n        return Math.max(Math.min(radX2, Math.PI), -Math.PI) / 2;\r\n      };\r\n\r\n      const zoom = (mapPx, worldPx, fraction) =>\r\n        Math.floor(Math.log(mapPx / worldPx / fraction) / Math.LN2);\r\n\r\n      const ne = bounds.getNorthEast();\r\n      const sw = bounds.getSouthWest();\r\n\r\n      const latFraction = (latRad(ne.lat()) - latRad(sw.lat())) / Math.PI;\r\n\r\n      const lngDiff = ne.lng() - sw.lng();\r\n      const lngFraction = (lngDiff < 0 ? lngDiff + 360 : lngDiff) / 360;\r\n\r\n      const latZoom = zoom(mapDim.height, WORLD_DIM.height, latFraction);\r\n      const lngZoom = zoom(mapDim.width, WORLD_DIM.width, lngFraction);\r\n\r\n      return Math.min(latZoom, lngZoom, ZOOM_MAX);\r\n  }\r\n  \r\n  calculateBearing(start, end) {\r\n    const startLat = start.lat * (Math.PI / 180);\r\n    const startLng = start.lng * (Math.PI / 180);\r\n    const endLat = end.lat * (Math.PI / 180);\r\n    const endLng = end.lng * (Math.PI / 180);\r\n  \r\n    const dLng = endLng - startLng;\r\n    const y = Math.sin(dLng) * Math.cos(endLat);\r\n    const x = Math.cos(startLat) * Math.sin(endLat) - Math.sin(startLat) * Math.cos(endLat) * Math.cos(dLng);\r\n    const bearing = Math.atan2(y, x) * (180 / Math.PI);\r\n  \r\n    return (bearing + 360) % 360;\r\n  }\r\n  async getDirections(from: string, to: string): Promise<any> {\r\n    try {\r\n      const url = `https://maps.googleapis.com/maps/api/directions/json?origin=${from}&destination=${to}&key=${environment.apiKey}`;\r\n      const response = await this.http.get(url).toPromise();\r\n      return response;\r\n    } catch (error) {\r\n      console.error('Error in getting directions:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n getAddress(lat: number, lng: number): Promise<any> {\r\n    const url = `https://maps.googleapis.com/maps/api/geocode/json`;\r\n    const params = new HttpParams()\r\n      .set('latlng', `${lat},${lng}`)\r\n      .set('key', environment.apiKey);\r\n\r\n    return this.http.get(url, { params }).toPromise();\r\n  }\r\n\r\n  // Add the addMarker method to the MapService class\r\n  async addMarker(lat: number, lng: number, title: string): Promise<Marker> {\r\n    try {\r\n      const marker: Marker = {\r\n        coordinate: { lat, lng },\r\n        title,\r\n      };\r\n      await this._map.addMarker(marker);\r\n      return marker;\r\n    } catch (error) {\r\n      console.error('Error adding marker:', error);\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Injectable, NgZone } from '@angular/core';\r\nimport { \r\n  Firestore, \r\n  collection, \r\n  doc, \r\n  query, \r\n  where, \r\n  onSnapshot, \r\n  addDoc, \r\n  updateDoc, \r\n  getDoc,\r\n  getDocs,\r\n  Timestamp,\r\n  orderBy,\r\n  limit,\r\n  Unsubscribe\r\n} from '@angular/fire/firestore';\r\nimport { geohashForLocation, geohashQueryBounds, distanceBetween } from 'geofire-common';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { ToastController } from '@ionic/angular';\r\n\r\nimport { DijkstraService } from './dijkstra.service';\r\nimport { OnesignalService } from '../one-signal.service';\r\nimport { \r\n  LatLng, \r\n  PathResult, \r\n  RideCandidate, \r\n  ScoredMatch, \r\n  SharedRideOpportunity,\r\n  NearbyRiderAlert\r\n} from '../interfaces/route-graph';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NearbyRiderService {\r\n  // Configuration\r\n  private readonly SEARCH_RADIUS_KM = 5;           // Search within 5km\r\n  private readonly MIN_OVERLAP_THRESHOLD = 0.35;   // 35% route overlap minimum\r\n  private readonly MAX_RIDERS_TO_NOTIFY = 10;      // Max riders to notify\r\n  private readonly OPPORTUNITY_EXPIRY_MINUTES = 5; // Opportunities expire after 5 min\r\n  private readonly NOTIFICATION_COOLDOWN_MS = 10 * 60 * 1000; // 10 min cooldown per rider\r\n\r\n  // Track notification history to prevent spam\r\n  private notificationHistory: Map<string, number> = new Map();\r\n\r\n  // Observable for nearby opportunities\r\n  private nearbyOpportunitiesSubject = new BehaviorSubject<SharedRideOpportunity[]>([]);\r\n  nearbyOpportunities$ = this.nearbyOpportunitiesSubject.asObservable();\r\n\r\n  // Active subscription\r\n  private opportunitySubscription: Unsubscribe | null = null;\r\n\r\n  constructor(\r\n    private firestore: Firestore,\r\n    private dijkstraService: DijkstraService,\r\n    private oneSignalService: OnesignalService,\r\n    private toastController: ToastController,\r\n    private ngZone: NgZone\r\n  ) {}\r\n\r\n  /**\r\n   * Find active riders nearby who might want to share this ride\r\n   * Uses GeoFire for efficient location-based queries\r\n   */\r\n  async findNearbyActiveRiders(\r\n    newRiderLocation: LatLng,\r\n    newRiderDestination: LatLng,\r\n    excludeRiderId: string\r\n  ): Promise<RideCandidate[]> {\r\n    const candidates: RideCandidate[] = [];\r\n\r\n    try {\r\n      // Generate geohash bounds for the search area\r\n      const center: [number, number] = [newRiderLocation.lat, newRiderLocation.lng];\r\n      const radiusM = this.SEARCH_RADIUS_KM * 1000;\r\n      const bounds = geohashQueryBounds(center, radiusM);\r\n\r\n      // Query the Request collection for pending rides in the area\r\n      const requestsRef = collection(this.firestore, 'Request');\r\n      \r\n      for (const b of bounds) {\r\n        const q = query(\r\n          requestsRef,\r\n          where('status', '==', 'pending'),\r\n          where('sharedRideAccepted', '==', true),\r\n          where('originGeohash', '>=', b[0]),\r\n          where('originGeohash', '<=', b[1]),\r\n          limit(50)\r\n        );\r\n\r\n        const snapshot = await getDocs(q);\r\n        \r\n        snapshot.forEach((doc) => {\r\n          const data = doc.data();\r\n          \r\n          // Exclude the current rider\r\n          if (data['Rider_id'] === excludeRiderId) return;\r\n\r\n          // Verify actual distance (geohash can have false positives)\r\n          const riderLocation: [number, number] = [data['Loc_lat'], data['Loc_lng']];\r\n          const distanceKm = distanceBetween(center, riderLocation);\r\n          \r\n          if (distanceKm <= this.SEARCH_RADIUS_KM) {\r\n            candidates.push({\r\n              requestId: doc.id,\r\n              riderId: data['Rider_id'],\r\n              origin: { lat: data['Loc_lat'], lng: data['Loc_lng'] },\r\n              destination: { lat: data['Des_lat'], lng: data['Des_lng'] },\r\n              riderName: data['Rider_name'],\r\n              riderToken: data['oneSignalPlayerId'] || null,\r\n              createdAt: data['createdAt']?.toDate(),\r\n              price: data['price']\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      console.log(`Found ${candidates.length} nearby active riders`);\r\n      return candidates;\r\n    } catch (error) {\r\n      console.error('Error finding nearby riders:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Score nearby riders by route similarity using Dijkstra\r\n   */\r\n  async scoreNearbyRiders(\r\n    newRiderPath: PathResult,\r\n    nearbyCandidates: RideCandidate[]\r\n  ): Promise<ScoredMatch[]> {\r\n    return this.dijkstraService.findSimilarRoutes(\r\n      newRiderPath,\r\n      nearbyCandidates,\r\n      0.25 // 25% max detour\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a shared ride opportunity document\r\n   */\r\n  async createSharedRideOpportunity(\r\n    initiatorId: string,\r\n    initiatorName: string,\r\n    origin: LatLng,\r\n    destination: LatLng,\r\n    originAddress: string,\r\n    destinationAddress: string,\r\n    estimatedPrice: number,\r\n    path?: PathResult\r\n  ): Promise<string> {\r\n    try {\r\n      const now = new Date();\r\n      const expiresAt = new Date(now.getTime() + this.OPPORTUNITY_EXPIRY_MINUTES * 60 * 1000);\r\n\r\n      const opportunity: Omit<SharedRideOpportunity, 'opportunityId'> = {\r\n        initiatorId,\r\n        initiatorName,\r\n        originGeohash: geohashForLocation([origin.lat, origin.lng]),\r\n        destinationGeohash: geohashForLocation([destination.lat, destination.lng]),\r\n        origin,\r\n        destination,\r\n        originAddress,\r\n        destinationAddress,\r\n        pathEncoded: path?.encodedPolyline,\r\n        estimatedPrice,\r\n        potentialDiscount: 10, // Starting discount with 2 passengers\r\n        status: 'open',\r\n        expiresAt,\r\n        createdAt: now,\r\n        matchedRiders: [],\r\n        maxPassengers: 4\r\n      };\r\n\r\n      const docRef = await addDoc(\r\n        collection(this.firestore, 'SharedRideOpportunities'),\r\n        {\r\n          ...opportunity,\r\n          expiresAt: Timestamp.fromDate(expiresAt),\r\n          createdAt: Timestamp.fromDate(now)\r\n        }\r\n      );\r\n\r\n      console.log('Created shared ride opportunity:', docRef.id);\r\n      return docRef.id;\r\n    } catch (error) {\r\n      console.error('Error creating shared ride opportunity:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send push notifications to nearby riders about shared ride opportunity\r\n   */\r\n  async notifyNearbyRiders(\r\n    matches: ScoredMatch[],\r\n    newRiderInfo: { name: string; originArea: string; destinationArea: string },\r\n    opportunityId: string\r\n  ): Promise<number> {\r\n    let notificationsSent = 0;\r\n\r\n    // Sort by overlap score and limit\r\n    const topMatches = matches\r\n      .filter(m => m.overlapScore >= this.MIN_OVERLAP_THRESHOLD)\r\n      .slice(0, this.MAX_RIDERS_TO_NOTIFY);\r\n\r\n    for (const match of topMatches) {\r\n      // Check notification cooldown\r\n      const lastNotified = this.notificationHistory.get(match.candidate.riderId);\r\n      if (lastNotified && Date.now() - lastNotified < this.NOTIFICATION_COOLDOWN_MS) {\r\n        console.log(`Skipping notification for ${match.candidate.riderId} - cooldown active`);\r\n        continue;\r\n      }\r\n\r\n      // Skip if no push token\r\n      if (!match.candidate.riderToken) {\r\n        console.log(`No push token for rider ${match.candidate.riderId}`);\r\n        continue;\r\n      }\r\n\r\n      try {\r\n        const savingsPercent = match.potentialSavings;\r\n        const title = ' Shared Ride Opportunity!';\r\n        const message = `${newRiderInfo.name} is heading your way! Save up to ${savingsPercent}% by sharing.`;\r\n\r\n        // Send notification via OneSignal\r\n        await this.oneSignalService.sendNotification(\r\n          message,\r\n          title,\r\n          {\r\n            type: 'shared_ride_opportunity',\r\n            opportunityId,\r\n            savings: savingsPercent,\r\n            originArea: newRiderInfo.originArea,\r\n            destinationArea: newRiderInfo.destinationArea,\r\n            overlapScore: match.overlapScore\r\n          },\r\n          [match.candidate.riderToken]\r\n        ).toPromise();\r\n\r\n        // Update notification history\r\n        this.notificationHistory.set(match.candidate.riderId, Date.now());\r\n        notificationsSent++;\r\n\r\n        console.log(`Notification sent to rider ${match.candidate.riderId}`);\r\n      } catch (error) {\r\n        console.error(`Failed to notify rider ${match.candidate.riderId}:`, error);\r\n      }\r\n    }\r\n\r\n    console.log(`Sent ${notificationsSent} shared ride notifications`);\r\n    return notificationsSent;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to nearby shared ride opportunities for a rider's location\r\n   */\r\n  subscribeToNearbyOpportunities(\r\n    riderLocation: LatLng,\r\n    riderId: string\r\n  ): Observable<SharedRideOpportunity[]> {\r\n    // Unsubscribe from previous listener\r\n    this.unsubscribeFromOpportunities();\r\n\r\n    const center: [number, number] = [riderLocation.lat, riderLocation.lng];\r\n    const radiusM = this.SEARCH_RADIUS_KM * 1000;\r\n    const bounds = geohashQueryBounds(center, radiusM);\r\n\r\n    // We'll aggregate results from multiple queries\r\n    const allOpportunities: Map<string, SharedRideOpportunity> = new Map();\r\n    const unsubscribes: Unsubscribe[] = [];\r\n\r\n    for (const b of bounds) {\r\n      const q = query(\r\n        collection(this.firestore, 'SharedRideOpportunities'),\r\n        where('status', '==', 'open'),\r\n        where('originGeohash', '>=', b[0]),\r\n        where('originGeohash', '<=', b[1]),\r\n        orderBy('originGeohash'),\r\n        orderBy('createdAt', 'desc'),\r\n        limit(20)\r\n      );\r\n\r\n      const unsub = onSnapshot(q, (snapshot) => {\r\n        this.ngZone.run(() => {\r\n          snapshot.docChanges().forEach((change) => {\r\n            const data = change.doc.data();\r\n            const opportunity: SharedRideOpportunity = {\r\n              opportunityId: change.doc.id,\r\n              initiatorId: data['initiatorId'],\r\n              initiatorName: data['initiatorName'],\r\n              originGeohash: data['originGeohash'],\r\n              destinationGeohash: data['destinationGeohash'],\r\n              origin: data['origin'],\r\n              destination: data['destination'],\r\n              originAddress: data['originAddress'],\r\n              destinationAddress: data['destinationAddress'],\r\n              pathEncoded: data['pathEncoded'],\r\n              estimatedPrice: data['estimatedPrice'],\r\n              potentialDiscount: data['potentialDiscount'],\r\n              status: data['status'],\r\n              expiresAt: data['expiresAt']?.toDate(),\r\n              createdAt: data['createdAt']?.toDate(),\r\n              matchedRiders: data['matchedRiders'] || [],\r\n              maxPassengers: data['maxPassengers'] || 4\r\n            };\r\n\r\n            // Filter out own opportunities and expired ones\r\n            if (opportunity.initiatorId === riderId) return;\r\n            if (opportunity.expiresAt && opportunity.expiresAt < new Date()) return;\r\n\r\n            // Verify actual distance\r\n            const oppLocation: [number, number] = [opportunity.origin.lat, opportunity.origin.lng];\r\n            const distanceKm = distanceBetween(center, oppLocation);\r\n            if (distanceKm > this.SEARCH_RADIUS_KM) return;\r\n\r\n            if (change.type === 'removed') {\r\n              allOpportunities.delete(change.doc.id);\r\n            } else {\r\n              allOpportunities.set(change.doc.id, opportunity);\r\n            }\r\n          });\r\n\r\n          // Emit updated list\r\n          const opportunities = Array.from(allOpportunities.values())\r\n            .filter(o => o.status === 'open')\r\n            .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\r\n          \r\n          this.nearbyOpportunitiesSubject.next(opportunities);\r\n        });\r\n      }, (error) => {\r\n        console.error('Error listening to opportunities:', error);\r\n      });\r\n\r\n      unsubscribes.push(unsub);\r\n    }\r\n\r\n    // Store unsubscribe function\r\n    this.opportunitySubscription = () => {\r\n      unsubscribes.forEach(unsub => unsub());\r\n    };\r\n\r\n    return this.nearbyOpportunities$;\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from opportunity updates\r\n   */\r\n  unsubscribeFromOpportunities(): void {\r\n    if (this.opportunitySubscription) {\r\n      this.opportunitySubscription();\r\n      this.opportunitySubscription = null;\r\n    }\r\n    this.nearbyOpportunitiesSubject.next([]);\r\n  }\r\n\r\n  /**\r\n   * Accept a shared ride opportunity\r\n   */\r\n  async acceptOpportunity(\r\n    opportunityId: string,\r\n    riderId: string,\r\n    riderName: string\r\n  ): Promise<boolean> {\r\n    try {\r\n      const oppRef = doc(this.firestore, 'SharedRideOpportunities', opportunityId);\r\n      const oppDoc = await getDoc(oppRef);\r\n\r\n      if (!oppDoc.exists()) {\r\n        throw new Error('Opportunity not found');\r\n      }\r\n\r\n      const data = oppDoc.data();\r\n      \r\n      // Check if still open\r\n      if (data['status'] !== 'open') {\r\n        throw new Error('Opportunity is no longer available');\r\n      }\r\n\r\n      // Check if expired\r\n      if (data['expiresAt']?.toDate() < new Date()) {\r\n        throw new Error('Opportunity has expired');\r\n      }\r\n\r\n      // Check if already at max passengers\r\n      const currentMatched = data['matchedRiders'] || [];\r\n      if (currentMatched.length >= (data['maxPassengers'] - 1)) {\r\n        throw new Error('Ride is already full');\r\n      }\r\n\r\n      // Add rider to matched list\r\n      const updatedMatched = [...currentMatched, riderId];\r\n      \r\n      // Calculate new discount (10% per passenger, max 40%)\r\n      const newDiscount = Math.min((updatedMatched.length + 1) * 10, 40);\r\n\r\n      await updateDoc(oppRef, {\r\n        matchedRiders: updatedMatched,\r\n        potentialDiscount: newDiscount,\r\n        status: updatedMatched.length >= (data['maxPassengers'] - 1) ? 'matched' : 'open',\r\n        updatedAt: Timestamp.now()\r\n      });\r\n\r\n      // Show success toast\r\n      const toast = await this.toastController.create({\r\n        message: `Joined shared ride! You'll save ${newDiscount}%`,\r\n        duration: 3000,\r\n        position: 'top',\r\n        color: 'success'\r\n      });\r\n      await toast.present();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error accepting opportunity:', error);\r\n      \r\n      const toast = await this.toastController.create({\r\n        message: error instanceof Error ? error.message : 'Failed to join shared ride',\r\n        duration: 3000,\r\n        position: 'top',\r\n        color: 'danger'\r\n      });\r\n      await toast.present();\r\n\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel/leave a shared ride opportunity\r\n   */\r\n  async leaveOpportunity(opportunityId: string, riderId: string): Promise<boolean> {\r\n    try {\r\n      const oppRef = doc(this.firestore, 'SharedRideOpportunities', opportunityId);\r\n      const oppDoc = await getDoc(oppRef);\r\n\r\n      if (!oppDoc.exists()) return false;\r\n\r\n      const data = oppDoc.data();\r\n      const currentMatched = data['matchedRiders'] || [];\r\n      const updatedMatched = currentMatched.filter((id: string) => id !== riderId);\r\n\r\n      // Recalculate discount\r\n      const newDiscount = Math.min((updatedMatched.length + 1) * 10, 40);\r\n\r\n      await updateDoc(oppRef, {\r\n        matchedRiders: updatedMatched,\r\n        potentialDiscount: newDiscount,\r\n        status: 'open',\r\n        updatedAt: Timestamp.now()\r\n      });\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error leaving opportunity:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get a specific opportunity by ID\r\n   */\r\n  async getOpportunity(opportunityId: string): Promise<SharedRideOpportunity | null> {\r\n    try {\r\n      const oppRef = doc(this.firestore, 'SharedRideOpportunities', opportunityId);\r\n      const oppDoc = await getDoc(oppRef);\r\n\r\n      if (!oppDoc.exists()) return null;\r\n\r\n      const data = oppDoc.data();\r\n      return {\r\n        opportunityId: oppDoc.id,\r\n        initiatorId: data['initiatorId'],\r\n        initiatorName: data['initiatorName'],\r\n        originGeohash: data['originGeohash'],\r\n        destinationGeohash: data['destinationGeohash'],\r\n        origin: data['origin'],\r\n        destination: data['destination'],\r\n        originAddress: data['originAddress'],\r\n        destinationAddress: data['destinationAddress'],\r\n        pathEncoded: data['pathEncoded'],\r\n        estimatedPrice: data['estimatedPrice'],\r\n        potentialDiscount: data['potentialDiscount'],\r\n        status: data['status'],\r\n        expiresAt: data['expiresAt']?.toDate(),\r\n        createdAt: data['createdAt']?.toDate(),\r\n        matchedRiders: data['matchedRiders'] || [],\r\n        maxPassengers: data['maxPassengers'] || 4\r\n      };\r\n    } catch (error) {\r\n      console.error('Error getting opportunity:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Expire old opportunities (call periodically or via cloud function)\r\n   */\r\n  async expireOldOpportunities(): Promise<number> {\r\n    try {\r\n      const q = query(\r\n        collection(this.firestore, 'SharedRideOpportunities'),\r\n        where('status', '==', 'open'),\r\n        where('expiresAt', '<', Timestamp.now())\r\n      );\r\n\r\n      const snapshot = await getDocs(q);\r\n      let expiredCount = 0;\r\n\r\n      for (const docSnap of snapshot.docs) {\r\n        await updateDoc(docSnap.ref, {\r\n          status: 'expired',\r\n          updatedAt: Timestamp.now()\r\n        });\r\n        expiredCount++;\r\n      }\r\n\r\n      console.log(`Expired ${expiredCount} old opportunities`);\r\n      return expiredCount;\r\n    } catch (error) {\r\n      console.error('Error expiring opportunities:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get general area name for privacy (don't show exact address)\r\n   */\r\n  getGeneralAreaFromAddress(address: string): string {\r\n    // Extract city/neighborhood from full address\r\n    const parts = address.split(',');\r\n    if (parts.length >= 2) {\r\n      return parts.slice(-2).join(',').trim();\r\n    }\r\n    return address;\r\n  }\r\n}\r\n","// src/app/services/network.service.ts\r\n\r\nimport { Injectable } from '@angular/core';\r\nimport { Network } from '@capacitor/network';\r\nimport { BehaviorSubject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NetworkService {\r\n  private networkStatus = new BehaviorSubject<boolean>(true);\r\n  networkStatus$ = this.networkStatus.asObservable();\r\n\r\n  constructor() {\r\n    this.initializeNetworkListener();\r\n  }\r\n\r\n  private initializeNetworkListener() {\r\n    try {\r\n      Network.addListener('networkStatusChange', status => {\r\n        console.log('Network status changed', status);\r\n        this.networkStatus.next(status.connected);\r\n\r\n        if (status.connected) {\r\n          this.handleReconnect();\r\n        } else {\r\n          this.handleDisconnect();\r\n        }\r\n      });\r\n    } catch (error) {\r\n      console.warn('Failed to add network listener:', error);\r\n    }\r\n\r\n    this.checkInitialNetworkStatus();\r\n  }\r\n\r\n  private async checkInitialNetworkStatus() {\r\n    try {\r\n      const status = await Network.getStatus();\r\n      console.log('Initial network status:', status);\r\n      this.networkStatus.next(status.connected);\r\n      if (!status.connected) {\r\n        this.handleDisconnect();\r\n      }\r\n    } catch (error) {\r\n      console.warn('Network status check failed, performing fallback check:', error);\r\n      // Fallback: try to make a simple network request with timeout\r\n      try {\r\n        const controller = new AbortController();\r\n        const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout\r\n        \r\n        await fetch('https://www.google.com/favicon.ico', { \r\n          method: 'HEAD',\r\n          mode: 'no-cors',\r\n          cache: 'no-cache',\r\n          signal: controller.signal\r\n        });\r\n        \r\n        clearTimeout(timeoutId);\r\n        this.networkStatus.next(true);\r\n        console.log('Fallback network check: connected');\r\n      } catch (fetchError) {\r\n        console.warn('Fallback network check failed:', fetchError);\r\n        // Be more conservative - assume connected if we can't determine\r\n        this.networkStatus.next(true);\r\n        console.log('Network status uncertain, assuming connected');\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleDisconnect() {\r\n    console.log('Disconnected from network');\r\n    // Handle the UI or logic when the network is disconnected\r\n  }\r\n\r\n  private handleReconnect() {\r\n    console.log('Reconnected to network');\r\n    // Handle the UI or logic when the network is reconnected\r\n  }\r\n\r\n  isConnected(): boolean {\r\n    return this.networkStatus.value;\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Firestore, doc, collection, onSnapshot, updateDoc, getDoc, Unsubscribe } from '@angular/fire/firestore';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { CoPassenger, SharedRide } from '../interfaces/rider';\r\nimport { ToastController } from '@ionic/angular';\r\n\r\nexport interface SharedRideNotification {\r\n  type: 'matched' | 'discount_increased' | 'fare_updated' | 'pickup_queue' | 'passenger_cancelled';\r\n  message: string;\r\n  data?: any;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SharedRideService {\r\n  private sharedRideSubject = new BehaviorSubject<SharedRide | null>(null);\r\n  private notificationSubject = new BehaviorSubject<SharedRideNotification | null>(null);\r\n  private unsubscribe: Unsubscribe | null = null;\r\n  \r\n  // Observable streams\r\n  sharedRide$ = this.sharedRideSubject.asObservable();\r\n  notifications$ = this.notificationSubject.asObservable();\r\n  \r\n  // Current state\r\n  private currentSharedRide: SharedRide | null = null;\r\n  private currentRiderId: string | null = null;\r\n\r\n  constructor(\r\n    private firestore: Firestore,\r\n    private toastController: ToastController\r\n  ) { }\r\n\r\n  /**\r\n   * Subscribe to a SharedRides document for real-time updates\r\n   */\r\n  subscribeToSharedRide(sharedRideId: string, riderId: string): Observable<SharedRide | null> {\r\n    // Unsubscribe from any previous listener\r\n    this.unsubscribeFromSharedRide();\r\n    \r\n    this.currentRiderId = riderId;\r\n    \r\n    const sharedRideRef = doc(this.firestore, 'SharedRides', sharedRideId);\r\n    \r\n    this.unsubscribe = onSnapshot(sharedRideRef, (snapshot) => {\r\n      if (snapshot.exists()) {\r\n        const newData = snapshot.data() as SharedRide;\r\n        const previousData = this.currentSharedRide;\r\n        \r\n        // Check for changes and emit notifications\r\n        this.checkForNotifications(previousData, newData);\r\n        \r\n        this.currentSharedRide = newData;\r\n        this.sharedRideSubject.next(newData);\r\n      } else {\r\n        this.currentSharedRide = null;\r\n        this.sharedRideSubject.next(null);\r\n      }\r\n    }, (error) => {\r\n      console.error('Error listening to shared ride:', error);\r\n      this.sharedRideSubject.next(null);\r\n    });\r\n    \r\n    return this.sharedRide$;\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from shared ride updates\r\n   */\r\n  unsubscribeFromSharedRide(): void {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n      this.unsubscribe = null;\r\n    }\r\n    this.currentSharedRide = null;\r\n    this.currentRiderId = null;\r\n    this.sharedRideSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Check for changes and emit notifications\r\n   */\r\n  private checkForNotifications(previous: SharedRide | null, current: SharedRide): void {\r\n    // First time matched with shared ride\r\n    if (!previous && current) {\r\n      this.emitNotification({\r\n        type: 'matched',\r\n        message: 'You\\'ve been matched with a shared ride! Save up to 40%.',\r\n        data: { passengers: current.totalPassengers }\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!previous) return;\r\n\r\n    // New passenger joined (discount increased)\r\n    if (current.totalPassengers > previous.totalPassengers) {\r\n      this.emitNotification({\r\n        type: 'discount_increased',\r\n        message: `New passenger joined! Your discount has increased.`,\r\n        data: { \r\n          previousCount: previous.totalPassengers,\r\n          newCount: current.totalPassengers\r\n        }\r\n      });\r\n    }\r\n\r\n    // Passenger cancelled (fare updated)\r\n    if (current.totalPassengers < previous.totalPassengers) {\r\n      this.emitNotification({\r\n        type: 'passenger_cancelled',\r\n        message: 'A passenger cancelled. Your fare has been updated.',\r\n        data: {\r\n          previousCount: previous.totalPassengers,\r\n          newCount: current.totalPassengers\r\n        }\r\n      });\r\n    }\r\n\r\n    // Check for pickup queue position changes\r\n    if (this.currentRiderId) {\r\n      const previousPosition = this.getPickupPosition(previous.passengers, this.currentRiderId);\r\n      const currentPosition = this.getPickupPosition(current.passengers, this.currentRiderId);\r\n      \r\n      if (previousPosition !== currentPosition && currentPosition > 0) {\r\n        this.emitNotification({\r\n          type: 'pickup_queue',\r\n          message: currentPosition === 1 \r\n            ? 'You\\'re next for pickup!' \r\n            : `Driver picking up ${currentPosition - 1} passenger(s) first`,\r\n          data: { position: currentPosition }\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get pickup position for a rider\r\n   */\r\n  private getPickupPosition(passengers: CoPassenger[], riderId: string): number {\r\n    const passenger = passengers?.find(p => p.riderId === riderId);\r\n    return passenger?.pickupOrder || 0;\r\n  }\r\n\r\n  /**\r\n   * Emit a notification\r\n   */\r\n  private emitNotification(notification: SharedRideNotification): void {\r\n    this.notificationSubject.next(notification);\r\n    this.showToast(notification.message);\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  private async showToast(message: string): Promise<void> {\r\n    const toast = await this.toastController.create({\r\n      message,\r\n      duration: 3000,\r\n      position: 'top',\r\n      color: 'primary',\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  /**\r\n   * Get current shared ride data\r\n   */\r\n  getCurrentSharedRide(): SharedRide | null {\r\n    return this.currentSharedRide;\r\n  }\r\n\r\n  /**\r\n   * Get co-passengers (excluding current rider)\r\n   */\r\n  getCoPassengers(): CoPassenger[] {\r\n    if (!this.currentSharedRide || !this.currentRiderId) {\r\n      return [];\r\n    }\r\n    return this.currentSharedRide.passengers.filter(p => p.riderId !== this.currentRiderId);\r\n  }\r\n\r\n  /**\r\n   * Get current rider's pickup position\r\n   */\r\n  getMyPickupPosition(): number {\r\n    if (!this.currentSharedRide || !this.currentRiderId) {\r\n      return 0;\r\n    }\r\n    return this.getPickupPosition(this.currentSharedRide.passengers, this.currentRiderId);\r\n  }\r\n\r\n  /**\r\n   * Get passengers being picked up before current rider\r\n   */\r\n  getPassengersBeforeMe(): number {\r\n    const myPosition = this.getMyPickupPosition();\r\n    return myPosition > 0 ? myPosition - 1 : 0;\r\n  }\r\n\r\n  /**\r\n   * Calculate savings amount\r\n   */\r\n  calculateSavings(originalPrice: number, discountedPrice: number): number {\r\n    return originalPrice - discountedPrice;\r\n  }\r\n\r\n  /**\r\n   * Calculate discount percentage based on number of passengers\r\n   * Max 40% discount with more passengers\r\n   */\r\n  calculateDiscountPercent(totalPassengers: number): number {\r\n    // Base discount: 10% per additional passenger, max 40%\r\n    const baseDiscount = 10;\r\n    const additionalPassengers = totalPassengers - 1;\r\n    return Math.min(additionalPassengers * baseDiscount, 40);\r\n  }\r\n\r\n  /**\r\n   * Get potential savings range for display\r\n   */\r\n  getPotentialSavingsRange(originalPrice: number): { min: number; max: number } {\r\n    return {\r\n      min: originalPrice * 0.10, // 10% savings with 2 passengers\r\n      max: originalPrice * 0.40  // 40% savings with max passengers\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Cancel sharing after match - update SharedRide document\r\n   */\r\n  async cancelSharedRide(requestId: string, sharedRideId: string): Promise<void> {\r\n    if (!this.currentRiderId) {\r\n      console.error('No rider ID set');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Update the Request document to remove sharing\r\n      const requestRef = doc(this.firestore, 'Request', requestId);\r\n      await updateDoc(requestRef, {\r\n        sharedRideAccepted: false,\r\n        isSharedRide: false,\r\n        sharedRideId: null,\r\n        discountedPrice: null,\r\n        discountPercent: 0\r\n      });\r\n\r\n      // The SharedRides document should be updated by the backend/cloud function\r\n      // to remove this passenger and recalculate other passengers' fares\r\n      \r\n      this.unsubscribeFromSharedRide();\r\n    } catch (error) {\r\n      console.error('Error cancelling shared ride:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if sharing can be disabled (only before ride is confirmed)\r\n   */\r\n  canDisableSharing(rideStatus: string): boolean {\r\n    return rideStatus === 'pending' || rideStatus === 'matching';\r\n  }\r\n}\r\n","import { Component, Input, Output, EventEmitter, OnInit, OnDestroy } from '@angular/core';\r\nimport { SharedRideOpportunity, LatLng } from '../interfaces/route-graph';\r\nimport { DijkstraService } from '../services/dijkstra.service';\r\nimport { interval, Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-shared-ride-prompt',\r\n  templateUrl: './shared-ride-prompt.component.html',\r\n  styleUrls: ['./shared-ride-prompt.component.scss']\r\n})\r\nexport class SharedRidePromptComponent implements OnInit, OnDestroy {\r\n  @Input() opportunities: SharedRideOpportunity[] = [];\r\n  @Input() userLocation: LatLng | null = null;\r\n  @Input() userDestination: LatLng | null = null;\r\n\r\n  @Output() accept = new EventEmitter<SharedRideOpportunity>();\r\n  @Output() dismiss = new EventEmitter<void>();\r\n\r\n  // Track time remaining for each opportunity\r\n  timeRemaining: Map<string, number> = new Map();\r\n  private timerSubscription: Subscription | null = null;\r\n\r\n  // Expanded opportunity for details view\r\n  expandedOpportunityId: string | null = null;\r\n\r\n  constructor(private dijkstraService: DijkstraService) {}\r\n\r\n  ngOnInit(): void {\r\n    // Start countdown timer\r\n    this.updateTimeRemaining();\r\n    this.timerSubscription = interval(1000).subscribe(() => {\r\n      this.updateTimeRemaining();\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.timerSubscription) {\r\n      this.timerSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update time remaining for all opportunities\r\n   */\r\n  private updateTimeRemaining(): void {\r\n    const now = new Date().getTime();\r\n    \r\n    this.opportunities.forEach(opp => {\r\n      if (opp.expiresAt) {\r\n        const remaining = Math.max(0, opp.expiresAt.getTime() - now);\r\n        this.timeRemaining.set(opp.opportunityId, remaining);\r\n      }\r\n    });\r\n\r\n    // Remove expired opportunities from view\r\n    this.opportunities = this.opportunities.filter(opp => {\r\n      const remaining = this.timeRemaining.get(opp.opportunityId);\r\n      return remaining === undefined || remaining > 0;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Format time remaining as MM:SS\r\n   */\r\n  formatTimeRemaining(opportunityId: string): string {\r\n    const ms = this.timeRemaining.get(opportunityId) || 0;\r\n    const seconds = Math.floor(ms / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    const remainingSeconds = seconds % 60;\r\n    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n  }\r\n\r\n  /**\r\n   * Calculate distance to opportunity origin\r\n   */\r\n  getDistanceToOrigin(opportunity: SharedRideOpportunity): string {\r\n    if (!this.userLocation) return '--';\r\n    \r\n    const distance = this.dijkstraService.calculateHaversineDistance(\r\n      this.userLocation,\r\n      opportunity.origin\r\n    );\r\n\r\n    if (distance < 1000) {\r\n      return `${Math.round(distance)}m away`;\r\n    }\r\n    return `${(distance / 1000).toFixed(1)}km away`;\r\n  }\r\n\r\n  /**\r\n   * Get number of passengers already matched\r\n   */\r\n  getPassengerCount(opportunity: SharedRideOpportunity): number {\r\n    return (opportunity.matchedRiders?.length || 0) + 1; // +1 for initiator\r\n  }\r\n\r\n  /**\r\n   * Get available seats remaining\r\n   */\r\n  getAvailableSeats(opportunity: SharedRideOpportunity): number {\r\n    const matched = opportunity.matchedRiders?.length || 0;\r\n    return opportunity.maxPassengers - matched - 1; // -1 for initiator\r\n  }\r\n\r\n  /**\r\n   * Toggle expanded view for an opportunity\r\n   */\r\n  toggleExpand(opportunityId: string): void {\r\n    if (this.expandedOpportunityId === opportunityId) {\r\n      this.expandedOpportunityId = null;\r\n    } else {\r\n      this.expandedOpportunityId = opportunityId;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Accept a shared ride opportunity\r\n   */\r\n  onAccept(opportunity: SharedRideOpportunity): void {\r\n    this.accept.emit(opportunity);\r\n  }\r\n\r\n  /**\r\n   * Dismiss the prompt\r\n   */\r\n  onDismiss(): void {\r\n    this.dismiss.emit();\r\n  }\r\n\r\n  /**\r\n   * Check if opportunity is urgent (< 1 min remaining)\r\n   */\r\n  isUrgent(opportunityId: string): boolean {\r\n    const remaining = this.timeRemaining.get(opportunityId) || 0;\r\n    return remaining < 60000 && remaining > 0;\r\n  }\r\n\r\n  /**\r\n   * Get savings display text\r\n   */\r\n  getSavingsText(opportunity: SharedRideOpportunity): string {\r\n    const savings = opportunity.estimatedPrice * (opportunity.potentialDiscount / 100);\r\n    return `Save RM ${savings.toFixed(2)} (${opportunity.potentialDiscount}%)`;\r\n  }\r\n\r\n  /**\r\n   * Track by function for ngFor\r\n   */\r\n  trackByOpportunityId(index: number, opportunity: SharedRideOpportunity): string {\r\n    return opportunity.opportunityId;\r\n  }\r\n}\r\n","<ion-header>\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-title>{{ 'SHARED_RIDE.NEARBY_RIDES' | translate }}</ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button (click)=\"onDismiss()\">\r\n        <ion-icon name=\"close\"></ion-icon>\r\n      </ion-button>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <!-- Header Info -->\r\n  <div class=\"header-info\">\r\n    <ion-icon name=\"people\" color=\"primary\"></ion-icon>\r\n    <p>{{ 'SHARED_RIDE.RIDERS_GOING_YOUR_WAY' | translate }}</p>\r\n    <span class=\"savings-badge\">{{ 'SHARED_RIDE.SAVE_UP_TO' | translate }} 40%</span>\r\n  </div>\r\n\r\n  <!-- No opportunities message -->\r\n  <div *ngIf=\"opportunities.length === 0\" class=\"no-opportunities\">\r\n    <ion-icon name=\"car-outline\" color=\"medium\"></ion-icon>\r\n    <p>{{ 'SHARED_RIDE.NO_RIDES_AVAILABLE' | translate }}</p>\r\n    <ion-text color=\"medium\">{{ 'SHARED_RIDE.CHECK_BACK_LATER' | translate }}</ion-text>\r\n  </div>\r\n\r\n  <!-- Opportunities List -->\r\n  <div class=\"opportunities-list\">\r\n    <ion-card \r\n      *ngFor=\"let opportunity of opportunities; trackBy: trackByOpportunityId\"\r\n      [class.urgent]=\"isUrgent(opportunity.opportunityId)\"\r\n      [class.expanded]=\"expandedOpportunityId === opportunity.opportunityId\">\r\n      \r\n      <!-- Card Header -->\r\n      <ion-card-header (click)=\"toggleExpand(opportunity.opportunityId)\">\r\n        <div class=\"card-header-content\">\r\n          <div class=\"rider-info\">\r\n            <ion-avatar>\r\n              <ion-icon name=\"person-circle\" color=\"primary\"></ion-icon>\r\n            </ion-avatar>\r\n            <div class=\"rider-details\">\r\n              <ion-card-title>{{ opportunity.initiatorName }}</ion-card-title>\r\n              <ion-card-subtitle>{{ getDistanceToOrigin(opportunity) }}</ion-card-subtitle>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"discount-badge\">\r\n            <span class=\"discount-value\">-{{ opportunity.potentialDiscount }}%</span>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Timer -->\r\n        <div class=\"timer\" [class.urgent]=\"isUrgent(opportunity.opportunityId)\">\r\n          <ion-icon name=\"time-outline\"></ion-icon>\r\n          <span>{{ formatTimeRemaining(opportunity.opportunityId) }}</span>\r\n        </div>\r\n      </ion-card-header>\r\n\r\n      <!-- Card Content -->\r\n      <ion-card-content>\r\n        <!-- Route Info -->\r\n        <div class=\"route-info\">\r\n          <div class=\"route-point\">\r\n            <div class=\"point-marker origin\"></div>\r\n            <div class=\"point-text\">\r\n              <span class=\"label\">{{ 'SHARED_RIDE.FROM' | translate }}</span>\r\n              <span class=\"address\">{{ opportunity.originAddress }}</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"route-line\"></div>\r\n          \r\n          <div class=\"route-point\">\r\n            <div class=\"point-marker destination\"></div>\r\n            <div class=\"point-text\">\r\n              <span class=\"label\">{{ 'SHARED_RIDE.TO' | translate }}</span>\r\n              <span class=\"address\">{{ opportunity.destinationAddress }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Expanded Details -->\r\n        <div class=\"expanded-details\" *ngIf=\"expandedOpportunityId === opportunity.opportunityId\">\r\n          <ion-list lines=\"none\">\r\n            <ion-item>\r\n              <ion-icon name=\"people-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n              <ion-label>\r\n                <p>{{ 'SHARED_RIDE.PASSENGERS' | translate }}</p>\r\n                <h3>{{ getPassengerCount(opportunity) }} / {{ opportunity.maxPassengers }}</h3>\r\n              </ion-label>\r\n            </ion-item>\r\n            \r\n            <ion-item>\r\n              <ion-icon name=\"car-outline\" slot=\"start\" color=\"primary\"></ion-icon>\r\n              <ion-label>\r\n                <p>{{ 'SHARED_RIDE.SEATS_AVAILABLE' | translate }}</p>\r\n                <h3>{{ getAvailableSeats(opportunity) }}</h3>\r\n              </ion-label>\r\n            </ion-item>\r\n            \r\n            <ion-item>\r\n              <ion-icon name=\"cash-outline\" slot=\"start\" color=\"success\"></ion-icon>\r\n              <ion-label>\r\n                <p>{{ 'SHARED_RIDE.YOUR_SAVINGS' | translate }}</p>\r\n                <h3 class=\"savings-amount\">{{ getSavingsText(opportunity) }}</h3>\r\n              </ion-label>\r\n            </ion-item>\r\n          </ion-list>\r\n        </div>\r\n\r\n        <!-- Action Buttons -->\r\n        <div class=\"action-buttons\">\r\n          <ion-button \r\n            expand=\"block\" \r\n            (click)=\"onAccept(opportunity)\"\r\n            [disabled]=\"getAvailableSeats(opportunity) <= 0\">\r\n            <ion-icon name=\"checkmark-circle\" slot=\"start\"></ion-icon>\r\n            {{ 'SHARED_RIDE.JOIN_RIDE' | translate }}\r\n          </ion-button>\r\n        </div>\r\n      </ion-card-content>\r\n    </ion-card>\r\n  </div>\r\n\r\n  <!-- Bottom Info -->\r\n  <div class=\"bottom-info\">\r\n    <ion-text color=\"medium\">\r\n      <p>\r\n        <ion-icon name=\"shield-checkmark-outline\"></ion-icon>\r\n        {{ 'SHARED_RIDE.PRIVACY_NOTE' | translate }}\r\n      </p>\r\n    </ion-text>\r\n  </div>\r\n</ion-content>\r\n\r\n<!-- Footer -->\r\n<ion-footer>\r\n  <ion-toolbar>\r\n    <ion-button expand=\"block\" fill=\"clear\" (click)=\"onDismiss()\">\r\n      {{ 'SHARED_RIDE.NO_THANKS' | translate }}\r\n    </ion-button>\r\n  </ion-toolbar>\r\n</ion-footer>\r\n","/// <reference types=\"@capacitor/cli\" />\nexport {};\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then(m => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n","export {};\n","import { registerPlugin } from '@capacitor/core';\nimport { exposeSynapse } from '@capacitor/synapse';\nconst Geolocation = registerPlugin('Geolocation', {\n    web: () => import('./web').then((m) => new m.GeolocationWeb()),\n});\nexposeSynapse();\nexport * from './definitions';\nexport { Geolocation };\n","import { CapacitorGoogleMaps } from './implementation';\nexport class LatLngBounds {\n    constructor(bounds) {\n        this.southwest = bounds.southwest;\n        this.center = bounds.center;\n        this.northeast = bounds.northeast;\n    }\n    async contains(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsContains({\n            bounds: this,\n            point,\n        });\n        return result['contains'];\n    }\n    async extend(point) {\n        const result = await CapacitorGoogleMaps.mapBoundsExtend({\n            bounds: this,\n            point,\n        });\n        this.southwest = result['bounds']['southwest'];\n        this.center = result['bounds']['center'];\n        this.northeast = result['bounds']['northeast'];\n        return this;\n    }\n}\nexport var MapType;\n(function (MapType) {\n    /**\n     * Basic map.\n     */\n    MapType[\"Normal\"] = \"Normal\";\n    /**\n     * Satellite imagery with roads and labels.\n     */\n    MapType[\"Hybrid\"] = \"Hybrid\";\n    /**\n     * Satellite imagery with no labels.\n     */\n    MapType[\"Satellite\"] = \"Satellite\";\n    /**\n     * Topographic data.\n     */\n    MapType[\"Terrain\"] = \"Terrain\";\n    /**\n     * No base map tiles.\n     */\n    MapType[\"None\"] = \"None\";\n})(MapType || (MapType = {}));\n","import { registerPlugin } from '@capacitor/core';\nconst CapacitorGoogleMaps = registerPlugin('CapacitorGoogleMaps', {\n    web: () => import('./web').then((m) => new m.CapacitorGoogleMapsWeb()),\n});\nCapacitorGoogleMaps.addListener('isMapInFocus', (data) => {\n    var _a;\n    const x = data.x;\n    const y = data.y;\n    const elem = document.elementFromPoint(x, y);\n    const internalId = (_a = elem === null || elem === void 0 ? void 0 : elem.dataset) === null || _a === void 0 ? void 0 : _a.internalId;\n    const mapInFocus = internalId === data.mapId;\n    CapacitorGoogleMaps.dispatchMapEvent({ id: data.mapId, focus: mapInFocus });\n});\nexport { CapacitorGoogleMaps };\n","/* eslint-disable @typescript-eslint/no-namespace */\nimport { LatLngBounds, MapType } from './definitions';\nimport { GoogleMap } from './map';\nexport { GoogleMap, LatLngBounds, MapType };\n","import { Capacitor } from '@capacitor/core';\nimport { LatLngBounds, MapType } from './definitions';\nimport { CapacitorGoogleMaps } from './implementation';\nclass MapCustomElement extends HTMLElement {\n    constructor() {\n        super();\n    }\n    connectedCallback() {\n        this.innerHTML = '';\n        if (Capacitor.getPlatform() == 'ios') {\n            this.style.overflow = 'scroll';\n            this.style['-webkit-overflow-scrolling'] = 'touch';\n            const overflowDiv = document.createElement('div');\n            overflowDiv.style.height = '200%';\n            this.appendChild(overflowDiv);\n        }\n    }\n}\ncustomElements.define('capacitor-google-map', MapCustomElement);\nexport class GoogleMap {\n    constructor(id) {\n        this.element = null;\n        this.resizeObserver = null;\n        this.handleScrollEvent = () => this.updateMapBounds();\n        this.id = id;\n    }\n    /**\n     * Creates a new instance of a Google Map\n     * @param options\n     * @param callback\n     * @returns GoogleMap\n     */\n    static async create(options, callback) {\n        const newMap = new GoogleMap(options.id);\n        if (!options.element) {\n            throw new Error('container element is required');\n        }\n        if (options.config.androidLiteMode === undefined) {\n            options.config.androidLiteMode = false;\n        }\n        newMap.element = options.element;\n        newMap.element.dataset.internalId = options.id;\n        const elementBounds = await GoogleMap.getElementBounds(options.element);\n        options.config.width = elementBounds.width;\n        options.config.height = elementBounds.height;\n        options.config.x = elementBounds.x;\n        options.config.y = elementBounds.y;\n        options.config.devicePixelRatio = window.devicePixelRatio;\n        if (Capacitor.getPlatform() == 'android') {\n            newMap.initScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            options.element = {};\n            const getMapBounds = () => {\n                var _a, _b;\n                const mapRect = (_b = (_a = newMap.element) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) !== null && _b !== void 0 ? _b : {};\n                return {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                };\n            };\n            const onDisplay = () => {\n                CapacitorGoogleMaps.onDisplay({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const onResize = () => {\n                CapacitorGoogleMaps.onResize({\n                    id: newMap.id,\n                    mapBounds: getMapBounds(),\n                });\n            };\n            const ionicPage = newMap.element.closest('.ion-page');\n            if (Capacitor.getPlatform() === 'ios' && ionicPage) {\n                ionicPage.addEventListener('ionViewWillEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n                ionicPage.addEventListener('ionViewDidEnter', () => {\n                    setTimeout(() => {\n                        onDisplay();\n                    }, 100);\n                });\n            }\n            const lastState = {\n                width: elementBounds.width,\n                height: elementBounds.height,\n                isHidden: false,\n            };\n            newMap.resizeObserver = new ResizeObserver(() => {\n                if (newMap.element != null) {\n                    const mapRect = newMap.element.getBoundingClientRect();\n                    const isHidden = mapRect.width === 0 && mapRect.height === 0;\n                    if (!isHidden) {\n                        if (lastState.isHidden) {\n                            if (Capacitor.getPlatform() === 'ios' && !ionicPage) {\n                                onDisplay();\n                            }\n                        }\n                        else if (lastState.width !== mapRect.width || lastState.height !== mapRect.height) {\n                            onResize();\n                        }\n                    }\n                    lastState.width = mapRect.width;\n                    lastState.height = mapRect.height;\n                    lastState.isHidden = isHidden;\n                }\n            });\n            newMap.resizeObserver.observe(newMap.element);\n        }\n        // small delay to allow for iOS WKWebView to setup corresponding element sub-scroll views ???\n        await new Promise((resolve, reject) => {\n            setTimeout(async () => {\n                try {\n                    await CapacitorGoogleMaps.create(options);\n                    resolve(undefined);\n                }\n                catch (err) {\n                    reject(err);\n                }\n            }, 200);\n        });\n        if (callback) {\n            const onMapReadyListener = await CapacitorGoogleMaps.addListener('onMapReady', (data) => {\n                if (data.mapId == newMap.id) {\n                    callback(data);\n                    onMapReadyListener.remove();\n                }\n            });\n        }\n        return newMap;\n    }\n    static async getElementBounds(element) {\n        return new Promise((resolve) => {\n            let elementBounds = element.getBoundingClientRect();\n            if (elementBounds.width == 0) {\n                let retries = 0;\n                const boundsInterval = setInterval(function () {\n                    if (elementBounds.width == 0 && retries < 30) {\n                        elementBounds = element.getBoundingClientRect();\n                        retries++;\n                    }\n                    else {\n                        if (retries == 30) {\n                            console.warn('Map size could not be determined');\n                        }\n                        clearInterval(boundsInterval);\n                        resolve(elementBounds);\n                    }\n                }, 100);\n            }\n            else {\n                resolve(elementBounds);\n            }\n        });\n    }\n    /**\n     * Enable touch events on native map\n     *\n     * @returns void\n     */\n    async enableTouch() {\n        return CapacitorGoogleMaps.enableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Disable touch events on native map\n     *\n     * @returns void\n     */\n    async disableTouch() {\n        return CapacitorGoogleMaps.disableTouch({\n            id: this.id,\n        });\n    }\n    /**\n     * Enable marker clustering\n     *\n     * @param minClusterSize - The minimum number of markers that can be clustered together.\n     * @defaultValue 4\n     *\n     * @returns void\n     */\n    async enableClustering(minClusterSize) {\n        return CapacitorGoogleMaps.enableClustering({\n            id: this.id,\n            minClusterSize,\n        });\n    }\n    /**\n     * Disable marker clustering\n     *\n     * @returns void\n     */\n    async disableClustering() {\n        return CapacitorGoogleMaps.disableClustering({\n            id: this.id,\n        });\n    }\n    /**\n     * Adds a tile overlay to the map\n     *\n     * @param tileOverlay\n     * @returns created tile overlay id\n     */\n    async addTileOverlay(tileOverlay) {\n        const res = await CapacitorGoogleMaps.addTileOverlay({\n            id: this.id,\n            tileOverlay,\n        });\n        return res.id;\n    }\n    /**\n     * Removes a tile overlay from the map\n     *\n     * @param id of the tile overlay to remove from the map\n     * @returns void\n     */\n    async removeTileOverlay(id) {\n        return CapacitorGoogleMaps.removeTileOverlay({\n            id: this.id,\n            tileOverlayId: id,\n        });\n    }\n    /**\n     * Adds a marker to the map\n     *\n     * @param marker\n     * @returns created marker id\n     */\n    async addMarker(marker) {\n        const res = await CapacitorGoogleMaps.addMarker({\n            id: this.id,\n            marker,\n        });\n        return res.id;\n    }\n    /**\n     * Adds multiple markers to the map\n     *\n     * @param markers\n     * @returns array of created marker IDs\n     */\n    async addMarkers(markers) {\n        const res = await CapacitorGoogleMaps.addMarkers({\n            id: this.id,\n            markers,\n        });\n        return res.ids;\n    }\n    /**\n     * Remove marker from the map\n     *\n     * @param id id of the marker to remove from the map\n     * @returns\n     */\n    async removeMarker(id) {\n        return CapacitorGoogleMaps.removeMarker({\n            id: this.id,\n            markerId: id,\n        });\n    }\n    /**\n     * Remove markers from the map\n     *\n     * @param ids array of ids to remove from the map\n     * @returns\n     */\n    async removeMarkers(ids) {\n        return CapacitorGoogleMaps.removeMarkers({\n            id: this.id,\n            markerIds: ids,\n        });\n    }\n    async addPolygons(polygons) {\n        const res = await CapacitorGoogleMaps.addPolygons({\n            id: this.id,\n            polygons,\n        });\n        return res.ids;\n    }\n    async addPolylines(polylines) {\n        const res = await CapacitorGoogleMaps.addPolylines({\n            id: this.id,\n            polylines,\n        });\n        return res.ids;\n    }\n    async removePolygons(ids) {\n        return CapacitorGoogleMaps.removePolygons({\n            id: this.id,\n            polygonIds: ids,\n        });\n    }\n    async addCircles(circles) {\n        const res = await CapacitorGoogleMaps.addCircles({\n            id: this.id,\n            circles,\n        });\n        return res.ids;\n    }\n    async removeCircles(ids) {\n        return CapacitorGoogleMaps.removeCircles({\n            id: this.id,\n            circleIds: ids,\n        });\n    }\n    async removePolylines(ids) {\n        return CapacitorGoogleMaps.removePolylines({\n            id: this.id,\n            polylineIds: ids,\n        });\n    }\n    /**\n     * Destroy the current instance of the map\n     */\n    async destroy() {\n        var _a;\n        if (Capacitor.getPlatform() == 'android') {\n            this.disableScrolling();\n        }\n        if (Capacitor.isNativePlatform()) {\n            (_a = this.resizeObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n        }\n        this.removeAllMapListeners();\n        return CapacitorGoogleMaps.destroy({\n            id: this.id,\n        });\n    }\n    /**\n     * Update the map camera configuration\n     *\n     * @param config\n     * @returns\n     */\n    async setCamera(config) {\n        return CapacitorGoogleMaps.setCamera({\n            id: this.id,\n            config,\n        });\n    }\n    async getMapType() {\n        const { type } = await CapacitorGoogleMaps.getMapType({ id: this.id });\n        return MapType[type];\n    }\n    /**\n     * Sets the type of map tiles that should be displayed.\n     *\n     * @param mapType\n     * @returns\n     */\n    async setMapType(mapType) {\n        return CapacitorGoogleMaps.setMapType({\n            id: this.id,\n            mapType,\n        });\n    }\n    /**\n     * Sets whether indoor maps are shown, where available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableIndoorMaps(enabled) {\n        return CapacitorGoogleMaps.enableIndoorMaps({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Controls whether the map is drawing traffic data, if available.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableTrafficLayer(enabled) {\n        return CapacitorGoogleMaps.enableTrafficLayer({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Show accessibility elements for overlay objects, such as Marker and Polyline.\n     *\n     * Only available on iOS.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableAccessibilityElements(enabled) {\n        return CapacitorGoogleMaps.enableAccessibilityElements({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set whether the My Location dot and accuracy circle is enabled.\n     *\n     * @param enabled\n     * @returns\n     */\n    async enableCurrentLocation(enabled) {\n        return CapacitorGoogleMaps.enableCurrentLocation({\n            id: this.id,\n            enabled,\n        });\n    }\n    /**\n     * Set padding on the 'visible' region of the view.\n     *\n     * @param padding\n     * @returns\n     */\n    async setPadding(padding) {\n        return CapacitorGoogleMaps.setPadding({\n            id: this.id,\n            padding,\n        });\n    }\n    /**\n     * Get the map's current viewport latitude and longitude bounds.\n     *\n     * @returns {LatLngBounds}\n     */\n    async getMapBounds() {\n        return new LatLngBounds(await CapacitorGoogleMaps.getMapBounds({\n            id: this.id,\n        }));\n    }\n    async fitBounds(bounds, padding) {\n        return CapacitorGoogleMaps.fitBounds({\n            id: this.id,\n            bounds,\n            padding,\n        });\n    }\n    initScrolling() {\n        const ionContents = document.getElementsByTagName('ion-content');\n        // eslint-disable-next-line @typescript-eslint/prefer-for-of\n        for (let i = 0; i < ionContents.length; i++) {\n            ionContents[i].scrollEvents = true;\n        }\n        window.addEventListener('ionScroll', this.handleScrollEvent);\n        window.addEventListener('scroll', this.handleScrollEvent);\n        window.addEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.addEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n        else {\n            window.addEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 500);\n            });\n        }\n    }\n    disableScrolling() {\n        window.removeEventListener('ionScroll', this.handleScrollEvent);\n        window.removeEventListener('scroll', this.handleScrollEvent);\n        window.removeEventListener('resize', this.handleScrollEvent);\n        if (screen.orientation) {\n            screen.orientation.removeEventListener('change', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n        else {\n            window.removeEventListener('orientationchange', () => {\n                setTimeout(this.updateMapBounds, 1000);\n            });\n        }\n    }\n    updateMapBounds() {\n        if (this.element) {\n            const mapRect = this.element.getBoundingClientRect();\n            CapacitorGoogleMaps.onScroll({\n                id: this.id,\n                mapBounds: {\n                    x: mapRect.x,\n                    y: mapRect.y,\n                    width: mapRect.width,\n                    height: mapRect.height,\n                },\n            });\n        }\n    }\n    /*\n    private findContainerElement(): HTMLElement | null {\n      if (!this.element) {\n        return null;\n      }\n  \n      let parentElement = this.element.parentElement;\n      while (parentElement !== null) {\n        if (window.getComputedStyle(parentElement).overflowY !== 'hidden') {\n          return parentElement;\n        }\n  \n        parentElement = parentElement.parentElement;\n      }\n  \n      return null;\n    }\n    */\n    /**\n     * Set the event listener on the map for 'onCameraIdle' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraIdleListener(callback) {\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n        }\n        if (callback) {\n            this.onCameraIdleListener = await CapacitorGoogleMaps.addListener('onCameraIdle', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraIdleListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onBoundsChanged' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnBoundsChangedListener(callback) {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n        }\n        if (callback) {\n            this.onBoundsChangedListener = await CapacitorGoogleMaps.addListener('onBoundsChanged', this.generateCallback(callback));\n        }\n        else {\n            this.onBoundsChangedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCameraMoveStarted' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCameraMoveStartedListener(callback) {\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n        }\n        if (callback) {\n            this.onCameraMoveStartedListener = await CapacitorGoogleMaps.addListener('onCameraMoveStarted', this.generateCallback(callback));\n        }\n        else {\n            this.onCameraMoveStartedListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterClickListener(callback) {\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterClickListener = await CapacitorGoogleMaps.addListener('onClusterClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onClusterInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnClusterInfoWindowClickListener(callback) {\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onClusterInfoWindowClickListener = await CapacitorGoogleMaps.addListener('onClusterInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onInfoWindowClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnInfoWindowClickListener(callback) {\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n        }\n        if (callback) {\n            this.onInfoWindowClickListener = await CapacitorGoogleMaps.addListener('onInfoWindowClick', this.generateCallback(callback));\n        }\n        else {\n            this.onInfoWindowClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMapClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMapClickListener(callback) {\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n        }\n        if (callback) {\n            this.onMapClickListener = await CapacitorGoogleMaps.addListener('onMapClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMapClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolygonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolygonClickListener(callback) {\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n        }\n        if (callback) {\n            this.onPolygonClickListener = await CapacitorGoogleMaps.addListener('onPolygonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolygonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onCircleClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnCircleClickListener(callback) {\n        if (this.onCircleClickListener)\n            [this.onCircleClickListener.remove()];\n        if (callback) {\n            this.onCircleClickListener = await CapacitorGoogleMaps.addListener('onCircleClick', this.generateCallback(callback));\n        }\n        else {\n            this.onCircleClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerClickListener(callback) {\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n        }\n        if (callback) {\n            this.onMarkerClickListener = await CapacitorGoogleMaps.addListener('onMarkerClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onPolylineClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnPolylineClickListener(callback) {\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n        }\n        if (callback) {\n            this.onPolylineClickListener = await CapacitorGoogleMaps.addListener('onPolylineClick', this.generateCallback(callback));\n        }\n        else {\n            this.onPolylineClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragStart' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragStartListener(callback) {\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragStartListener = await CapacitorGoogleMaps.addListener('onMarkerDragStart', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragStartListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDrag' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragListener(callback) {\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragListener = await CapacitorGoogleMaps.addListener('onMarkerDrag', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMarkerDragEnd' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMarkerDragEndListener(callback) {\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n        }\n        if (callback) {\n            this.onMarkerDragEndListener = await CapacitorGoogleMaps.addListener('onMarkerDragEnd', this.generateCallback(callback));\n        }\n        else {\n            this.onMarkerDragEndListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationButtonClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationButtonClickListener(callback) {\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationButtonClickListener = await CapacitorGoogleMaps.addListener('onMyLocationButtonClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationButtonClickListener = undefined;\n        }\n    }\n    /**\n     * Set the event listener on the map for 'onMyLocationClick' events.\n     *\n     * @param callback\n     * @returns\n     */\n    async setOnMyLocationClickListener(callback) {\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n        }\n        if (callback) {\n            this.onMyLocationClickListener = await CapacitorGoogleMaps.addListener('onMyLocationClick', this.generateCallback(callback));\n        }\n        else {\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    /**\n     * Remove all event listeners on the map.\n     *\n     * @param callback\n     * @returns\n     */\n    async removeAllMapListeners() {\n        if (this.onBoundsChangedListener) {\n            this.onBoundsChangedListener.remove();\n            this.onBoundsChangedListener = undefined;\n        }\n        if (this.onCameraIdleListener) {\n            this.onCameraIdleListener.remove();\n            this.onCameraIdleListener = undefined;\n        }\n        if (this.onCameraMoveStartedListener) {\n            this.onCameraMoveStartedListener.remove();\n            this.onCameraMoveStartedListener = undefined;\n        }\n        if (this.onClusterClickListener) {\n            this.onClusterClickListener.remove();\n            this.onClusterClickListener = undefined;\n        }\n        if (this.onClusterInfoWindowClickListener) {\n            this.onClusterInfoWindowClickListener.remove();\n            this.onClusterInfoWindowClickListener = undefined;\n        }\n        if (this.onInfoWindowClickListener) {\n            this.onInfoWindowClickListener.remove();\n            this.onInfoWindowClickListener = undefined;\n        }\n        if (this.onMapClickListener) {\n            this.onMapClickListener.remove();\n            this.onMapClickListener = undefined;\n        }\n        if (this.onPolylineClickListener) {\n            this.onPolylineClickListener.remove();\n            this.onPolylineClickListener = undefined;\n        }\n        if (this.onMarkerClickListener) {\n            this.onMarkerClickListener.remove();\n            this.onMarkerClickListener = undefined;\n        }\n        if (this.onPolygonClickListener) {\n            this.onPolygonClickListener.remove();\n            this.onPolygonClickListener = undefined;\n        }\n        if (this.onCircleClickListener) {\n            this.onCircleClickListener.remove();\n            this.onCircleClickListener = undefined;\n        }\n        if (this.onMarkerDragStartListener) {\n            this.onMarkerDragStartListener.remove();\n            this.onMarkerDragStartListener = undefined;\n        }\n        if (this.onMarkerDragListener) {\n            this.onMarkerDragListener.remove();\n            this.onMarkerDragListener = undefined;\n        }\n        if (this.onMarkerDragEndListener) {\n            this.onMarkerDragEndListener.remove();\n            this.onMarkerDragEndListener = undefined;\n        }\n        if (this.onMyLocationButtonClickListener) {\n            this.onMyLocationButtonClickListener.remove();\n            this.onMyLocationButtonClickListener = undefined;\n        }\n        if (this.onMyLocationClickListener) {\n            this.onMyLocationClickListener.remove();\n            this.onMyLocationClickListener = undefined;\n        }\n    }\n    generateCallback(callback) {\n        const mapId = this.id;\n        return (data) => {\n            if (data.mapId == mapId) {\n                callback(data);\n            }\n        };\n    }\n}\n","'use strict';\n\n/**\n * Based off of [the offical Google document](https://developers.google.com/maps/documentation/utilities/polylinealgorithm)\n *\n * Some parts from [this implementation](http://facstaff.unca.edu/mcmcclur/GoogleMaps/EncodePolyline/PolylineEncoder.js)\n * by [Mark McClure](http://facstaff.unca.edu/mcmcclur/)\n *\n * @module polyline\n */\n\nvar polyline = {};\n\nfunction py2_round(value) {\n    // Google's polyline algorithm uses the same rounding strategy as Python 2, which is different from JS for negative values\n    return Math.floor(Math.abs(value) + 0.5) * (value >= 0 ? 1 : -1);\n}\n\nfunction encode(current, previous, factor) {\n    current = py2_round(current * factor);\n    previous = py2_round(previous * factor);\n    var coordinate = (current - previous) * 2;\n    if (coordinate < 0) {\n        coordinate = -coordinate - 1\n    }\n    var output = '';\n    while (coordinate >= 0x20) {\n        output += String.fromCharCode((0x20 | (coordinate & 0x1f)) + 63);\n        coordinate /= 32;\n    }\n    output += String.fromCharCode((coordinate | 0) + 63);\n    return output;\n}\n\n/**\n * Decodes to a [latitude, longitude] coordinates array.\n *\n * This is adapted from the implementation in Project-OSRM.\n *\n * @param {String} str\n * @param {Number} precision\n * @returns {Array}\n *\n * @see https://github.com/Project-OSRM/osrm-frontend/blob/master/WebContent/routing/OSRM.RoutingGeometry.js\n */\npolyline.decode = function(str, precision) {\n    var index = 0,\n        lat = 0,\n        lng = 0,\n        coordinates = [],\n        shift = 0,\n        result = 0,\n        byte = null,\n        latitude_change,\n        longitude_change,\n        factor = Math.pow(10, Number.isInteger(precision) ? precision : 5);\n\n    // Coordinates have variable length when encoded, so just keep\n    // track of whether we've hit the end of the string. In each\n    // loop iteration, a single coordinate is decoded.\n    while (index < str.length) {\n\n        // Reset shift, result, and byte\n        byte = null;\n        shift = 1;\n        result = 0;\n\n        do {\n            byte = str.charCodeAt(index++) - 63;\n            result += (byte & 0x1f) * shift;\n            shift *= 32;\n        } while (byte >= 0x20);\n\n        latitude_change = (result & 1) ? ((-result - 1) / 2) : (result / 2);\n\n        shift = 1;\n        result = 0;\n\n        do {\n            byte = str.charCodeAt(index++) - 63;\n            result += (byte & 0x1f) * shift;\n            shift *= 32;\n        } while (byte >= 0x20);\n\n        longitude_change = (result & 1) ? ((-result - 1) / 2) : (result / 2);\n\n        lat += latitude_change;\n        lng += longitude_change;\n\n        coordinates.push([lat / factor, lng / factor]);\n    }\n\n    return coordinates;\n};\n\n/**\n * Encodes the given [latitude, longitude] coordinates array.\n *\n * @param {Array.<Array.<Number>>} coordinates\n * @param {Number} precision\n * @returns {String}\n */\npolyline.encode = function(coordinates, precision) {\n    if (!coordinates.length) { return ''; }\n\n    var factor = Math.pow(10, Number.isInteger(precision) ? precision : 5),\n        output = encode(coordinates[0][0], 0, factor) + encode(coordinates[0][1], 0, factor);\n\n    for (var i = 1; i < coordinates.length; i++) {\n        var a = coordinates[i], b = coordinates[i - 1];\n        output += encode(a[0], b[0], factor);\n        output += encode(a[1], b[1], factor);\n    }\n\n    return output;\n};\n\nfunction flipped(coords) {\n    var flipped = [];\n    for (var i = 0; i < coords.length; i++) {\n        var coord = coords[i].slice();\n        flipped.push([coord[1], coord[0]]);\n    }\n    return flipped;\n}\n\n/**\n * Encodes a GeoJSON LineString feature/geometry.\n *\n * @param {Object} geojson\n * @param {Number} precision\n * @returns {String}\n */\npolyline.fromGeoJSON = function(geojson, precision) {\n    if (geojson && geojson.type === 'Feature') {\n        geojson = geojson.geometry;\n    }\n    if (!geojson || geojson.type !== 'LineString') {\n        throw new Error('Input must be a GeoJSON LineString');\n    }\n    return polyline.encode(flipped(geojson.coordinates), precision);\n};\n\n/**\n * Decodes to a GeoJSON LineString geometry.\n *\n * @param {String} str\n * @param {Number} precision\n * @returns {Object}\n */\npolyline.toGeoJSON = function(str, precision) {\n    var coords = polyline.decode(str, precision);\n    return {\n        type: 'LineString',\n        coordinates: flipped(coords)\n    };\n};\n\nif (typeof module === 'object' && module.exports) {\n    module.exports = polyline;\n}\n","import { asyncScheduler } from '../scheduler/async';\nimport { timer } from './timer';\nexport function interval(period = 0, scheduler = asyncScheduler) {\n    if (period < 0) {\n        period = 0;\n    }\n    return timer(period, period, scheduler);\n}\n","function s(t) {\n  t.CapacitorUtils.Synapse = new Proxy(\n    {},\n    {\n      get(e, n) {\n        return new Proxy({}, {\n          get(w, o) {\n            return (c, p, r) => {\n              const i = t.Capacitor.Plugins[n];\n              if (i === void 0) {\n                r(new Error(`Capacitor plugin ${n} not found`));\n                return;\n              }\n              if (typeof i[o] != \"function\") {\n                r(new Error(`Method ${o} not found in Capacitor plugin ${n}`));\n                return;\n              }\n              (async () => {\n                try {\n                  const a = await i[o](c);\n                  p(a);\n                } catch (a) {\n                  r(a);\n                }\n              })();\n            };\n          }\n        });\n      }\n    }\n  );\n}\nfunction u(t) {\n  t.CapacitorUtils.Synapse = new Proxy(\n    {},\n    {\n      get(e, n) {\n        return t.cordova.plugins[n];\n      }\n    }\n  );\n}\nfunction f(t = !1) {\n  typeof window > \"u\" || (window.CapacitorUtils = window.CapacitorUtils || {}, window.Capacitor !== void 0 && !t ? s(window) : window.cordova !== void 0 && u(window));\n}\nexport {\n  f as exposeSynapse\n};\n"],"names":["ElementRef","NgZone","Geolocation","AutocompleteComponent","Observable","interval","BehaviorSubject","Subscription","updateDoc","getDoc","collection","onSnapshot","doc","Firestore","query","where","EnrouteChatComponent","Network","App","AddCardComponent","switchMap","Preferences","onAuthStateChanged","TripSummaryComponent","i0","ctx_r19","HomePage","constructor","auth","authService","router","route","networkService","map","nav","platform","firestore","database","ngZone","geocode","overlay","modalCtrl","alert","payME","toastController","actionSheetController","sharedRideService","settingsService","dijkstraService","nearbyRiderService","oneSignalService","BOOKING","CONFIRM","TRACKING","SEARCHING","DRIVING","NO_DRIVER","MAP_PIN","NO_DRIVERS","initializeApp","ngOnDestroy","unsubscribe","clearSubscriptions","clearPrevMarkers","clearAllPolylines","nearbyOpportunitiesSubscription","unsubscribeFromOpportunities","ionViewWillEnter","fetchSavedPaymentMethods","checkSharedRideDeepLink","queryParams","subscribe","params","console","log","handleSharedRideDeepLink","navigate","relativeTo","replaceUrl","ngAfterViewInit","hasPermission","checkAndRequestLocationPermissions","initializeProfile","initializeNetworkMonitoring","loadPresets","initializeGeolocation","initializeMap","startPollingPosition","EnterBookingStage","initializeRideStateListener","e","raw","localStorage","getItem","presets","JSON","parse","name","address","lat","lng","setItem","stringify","error","savePresets","addCurrentAsPreset","destinationAddress","D_LatLng","create","header","message","buttons","present","unshift","length","deletePreset","i","splice","selectPreset","preset","getDistanceAndDirections","showAutocompleteModal","user","Promise","resolve","Error","profile","getUserProfile","userId","uid","email","createdAt","Date","toISOString","createUserProfile","hideLoader","showAlert","ensureProfileInitialized","lastHandledState","requestsQuery","snapshot","empty","setStage","STAGES","activeRides","docs","currentRide","rideData","data","requestID","id","price","status","isAppInitialization","Loc_lat","Loc_lng","LatLng","Des_lat","Des_lng","locationAddress","Rider_Location","Rider_Destination","handlePendingState","handleRideConfirmation","handleRideStart","handleRideCancellation","code","handleRemovedRide","clearRideData","driverInfo","rideHasStarted","paymentProcessed","processingPaymentForRide","is","permissionStatus","checkPermissions","location","text","handler","newStatus","requestPermissions","showLocationRequiredAlert","backdropDismiss","role","onDidDismiss","navigator","permissions","then","result","state","showWebLocationPrompt","geolocation","getCurrentPosition","savedPaymentMethods","getSavedPaymentMethods","selectedCard","cash","cardId","chooseCard","event","selectedValue","detail","value","openAddCardModal","processRidePayment","rideRef","rideDoc","existingData","totalAmount","Math","round","currencySymbol","driverAmount","companyAmount","paymentData","amount","currency","toLowerCase","paymentMethodId","driverId","driverDetails","Driver_id","rideId","description","paymentResult","toPromise","success","paymentIntentId","paymentAmount","paymentTimestamp","toast","duration","position","color","errorMessage","paymentMethod","showPaymentErrorModal","modal","component","onWillDismiss","updateMapPadding","bottomPadding","newMap","setPadding","top","left","right","bottom","setMapHeight","setMapHeightCreateAndAddMarkers","setMapHeightHandleDrivertoRider","setMapHeightHandleDrivertoDestination","ResetMapHeight","getStatus","isConnected","connected","networkStatus$","next","addListener","ready","coordinates","timeout","reject","coords","latitude","longitude","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp","updateLocation","startPermissionPolling","permissionCheckInterval","setInterval","clearInterval","lastLatLng","lastAddress","pollingInterval","newLatLng","hasSignificantLocationChange","getAddress","results","components","address_components","long_name","actualLocation","formatted_address","stopPolling","confirmStage","searchingStage","trackingStage","drivingToDestinationStage","center","radiusInM","mapy","fetchAndDisplayDrivers","err","oldLatLng","minDistance","R","1","PI","2","","","a","sin","cos","c","atan2","sqrt","distance","stopPollingPosition","warn","now","createMap","mapRef","nativeElement","initializeDatabaseSubscriptions","getKnownPlaces","d","places","slice","initializeBackButtonCustomHandler","backButton","subscribeWithPriority","canGoBack","confirm","exitApp","window","history","back","setupMapListeners","setOnCameraIdleListener","g","run","showResetLocationButton","mapPinStage","addressResponse","processAddressResponse","logout","drivers","checkDriversWithin","handleDrivers","drivers_Requested","current_Request_Number","NoDrivers","UpdateCarMarker","catch","trace","closeDrivers","forEach","driver","onlineState","push","updateDriverInfo","max","min","cleanupListeners","Object","values","activeListeners","carname","Driver_car","driverImage","Driver_imgUrl","driver_duration_apart","ceil","driver_ID","driver_number_of_seats","seats","DriverLatLng","Driver_lat","Driver_lng","StartRide","isLoadingDriver","showLoader","all","enableTouch","BookRide","clearMarkers","marker1","undefined","removeMarker","marker2","_carmarkers","Array","isArray","marker","hasValidDriver","showNoDriversAlert","userDocRef","docSnapshot","exists","handleNoAvailableDriver","requestRideWithDriverDetails","currentDriver","keys","isValid","driversLength","currentRequestNum","hasDriverId","originalPrice","requestDetails","latLng","dLatLng","sharedRideAccepted","sharedRideEnabled","isSharedRide","sharedRideId","discountedPrice","discountPercent","RequestRideWithRiderDetails","rideRequestDocRef","unsub","handleRideUpdates","routeUpdateSubscription","numCalls","countDown","animatedMarker","handleRideStop","ReturnHome","locationPromise","getDriverLocation","timeoutPromise","_","setTimeout","race","clearPolyline","newPoly","setCamera","animate","animationDuration","zoom","coordinate","handleDriverToRider","EnterSearchingStage","startCountdown","presentCancelRideActionSheet","actionSheet","cancelRide","reason","cancellationReason","canceledBy","stopCountdown","ClearRide","driverDoc","mapError","driverLocationFetched","driverLocation","locationError","driver_lat","driver_lng","EnterDrivingToDestinationStage","canCheck","handleRiderToDestination","visualError","isRideStopProcessed","attempt","docData","tripId","riderId","driverName","Driver_name","driverCar","driverPlate","Driver_plate","driverRating","Driver_rating","pickup","destination","rating","completed","completedAt","saveRideHistory","historyError","remove","key","RIDE_STATE_KEY","componentProps","clearRideState","driver_marker","rider_marker","destinationMarker","routePolyline","routePath","actualDestination","bookingStage","noDriverStage","enableCurrentLocation","docOrData","docId","requestId","checkForSharedRideMatch","EnterTrackingStage","saveRideStateToStorage","rideState","stage","getCurrentStage","set","EnterChat","options","chatData","initialTime","countdownActive","timeRemaining","updateCountdown","UpdateCountDown","handleCountdownEnd","requestNextDriver","goBackToAutoComplete","ResetState","markers","ref","cm","clearPromises","filter","m","clearMarker","updateMarkerPosition","iconUrl","title","markerSize","width","height","iconAnchor","x","y","newMarker","addMarker","iconSize","iconOrigin","zIndex","removePolylines","pinOnMap","EnterMapPinStage","mapPinDrag","home","searching","AddKnownPlace","full","whole","editedPickup","getLatLng","geometry","RequestRide","dat","place","EnterNoDriverStage","EnterConfirmStage","pathResult","findShortestPath","direction","totalDistance","bounds","getPriceEstimate","totalWeight","createAndAddMarkers","getDistanceAndDirectionsDriver","origin1","google","maps","origin2","request","origin","travelMode","TravelMode","directions","response","D_duration","routes","legs","resetLocation","addressComponents","elements","LatLngBounds","hasValidBounds","driverMap","Map","element","updatedMarkers","get","latlng","extend","existingMarkerIndex","findIndex","mapDim","offsetHeight","offsetWidth","minZoom","maxZoom","zoomLevel","getBoundsZoomLevel","getCenter","GoHome","GotoSupport","navigateForward","testPushNotifications","testPushNotificationAlerts","sendTestNotification","currentUser","sendByUserIds","externalUserIds","notificationType","CancelRide","riderCleared","riderDocRef","currentRequestId","bearing","CallDriver","phone","Driver_phone","replace","encodeURIComponent","open","driverLatLng","riderLatLng","driverMarker","riderMarker","photoURL","updateRoute","updatedDriverLatLng","path","overview_path","locs","geoCode","calculateCenter","availableHeight","adjustedZoomLevel","setCameraToLocation","calculateBearing","addPolyline","routeUpdate$","UPDATE_INTERVAL","pipe","polylineId","destinationLatLng","style","loc","des","polylineColor","pathPoints","polylines","strokeColor","strokeWeight","geodesic","addedPolylines","addPolylines","disableTouch","animateMarker","lastMarker","ShowDriverInfoPop","ngOnInit","navigation","getCurrentNavigation","extras","mapLoadedSubscription","mapLoadedSubject","loaded","processBookAgainData","addLocationMarker","geocodeService","geocodeAddress","addDestinationMarker","drawRoute","calculatePrice","toastCtrl","toggleSharedRide","checked","updatePotentialSavingsDisplay","savings","getPotentialSavingsRange","toFixed","getPotentialSavings","getDiscountedPriceRange","subscribeToSharedRide","sharedRideSubscription","sharedRide","sharedRideData","coPassengers","getCoPassengers","pickupQueuePosition","getMyPickupPosition","passengersBeforeMe","getPassengersBeforeMe","sharedRideNotificationSubscription","notifications$","notification","handleSharedRideNotification","type","refreshSharedRidePrice","requestRef","requestDoc","cancelSharing","canDisableSharing","cancelSharedRide","cleanupSharedRideSubscriptions","unsubscribeFromSharedRide","getSavingsAmount","calculateSavings","getPassengerStatusLabel","resetSharedRideState","findNearbySharedRideMatches","isCalculatingRoute","computedPath","nearbyCandidates","findNearbyActiveRiders","nearbyMatches","scoreNearbyRiders","nearbyRidersCount","createAndNotifySharedRideOpportunity","sharedRideOpportunityId","createSharedRideOpportunity","firstName","originArea","getGeneralAreaFromAddress","destArea","notificationsSent","notifyNearbyRiders","destinationArea","subscribeToNearbyOpportunities","opportunities","availableSharedRides","opp","initiatorId","viewSharedRides","showSharedRidePrompt","acceptSharedRideOpportunity","opportunity","riderName","acceptOpportunity","opportunityId","selectedSharedRide","potentialDiscount","dismissSharedRidePrompt","getOpportunity","onSharedRideToggle","cleanupDijkstraSubscriptions","selectors","viewQuery","ctx","GraphNode","PathResult","RideCandidate","ScoredMatch","HeapNode","polyline","MinHeap","node","heap","bubbleUp","pop","last","bubbleDown","isEmpty","index","parentIndex","floor","leftChild","rightChild","smallest","DijkstraService","http","weightConfig","cacheKey","getCacheKey","cached","getFromCache","getDijkstraRoute","nodes","encodedPolyline","setCache","createDirectPath","start","end","time","post","API_URL","decodedCoords","decode","calculateHaversineDistance","runDijkstra","graph","startId","endId","distances","previous","visited","Set","nodeId","Infinity","current","has","add","currentNode","edge","neighbors","targetId","newDistance","weight","currentId","prevId","prevNode","find","calculateRouteOverlap","path1","path2","GRID_SIZE","getGridKey","coord","latGrid","lngGrid","set1","set2","intersection","union","size","calculateDirectionalOverlap","basicOverlap","originDistance","destDistance","maxRouteLength","directionScore","findSimilarRoutes","riderPath","candidates","maxDetourPercent","matches","candidate","candidatePath","overlapScore","combinedPathDistance","estimateCombinedPathDistance","originalDistance","detourCost","detourPercent","potentialSavings","sort","b","dest1","dest2","orders","order","point1","point2","lat1","lat2","deltaLat","deltaLng","EARTH_RADIUS_M","dest","n","cacheTimestamps","CACHE_TTL_MS","pathCache","delete","cleanCache","clearCache","clear","factory","providedIn","environment","of","HttpParams","catchError","GeocodeService","client","DistanceMatrixService","DirectionsService","url","apiUrl","apiKey","getDirections","from","to","getDistanceMatrix","distanceMatrixService","observer","origins","destinations","complete","GoogleMap","MapService","_map","config","styles","scaleControl","streetViewControl","rotateControl","fullscreenControl","enableTrafficLayer","destroyMap","destroy","points","latitudes","p","longitudes","avgLat","reduce","avgLng","WORLD_DIM","ZOOM_MAX","latRad","radX2","mapPx","worldPx","fraction","LN2","ne","getNorthEast","sw","getSouthWest","latFraction","lngDiff","lngFraction","latZoom","lngZoom","startLat","startLng","endLat","endLng","dLng","addDoc","getDocs","Timestamp","orderBy","limit","geohashForLocation","geohashQueryBounds","distanceBetween","SharedRideOpportunity","NearbyRiderService","nearbyOpportunitiesSubject","asObservable","newRiderLocation","newRiderDestination","excludeRiderId","radiusM","SEARCH_RADIUS_KM","requestsRef","q","riderLocation","distanceKm","riderToken","toDate","newRiderPath","initiatorName","originAddress","estimatedPrice","expiresAt","getTime","OPPORTUNITY_EXPIRY_MINUTES","originGeohash","destinationGeohash","pathEncoded","matchedRiders","maxPassengers","docRef","fromDate","newRiderInfo","topMatches","MIN_OVERLAP_THRESHOLD","MAX_RIDERS_TO_NOTIFY","match","lastNotified","notificationHistory","NOTIFICATION_COOLDOWN_MS","savingsPercent","sendNotification","allOpportunities","unsubscribes","docChanges","change","oppLocation","o","opportunitySubscription","nearbyOpportunities$","oppRef","oppDoc","currentMatched","updatedMatched","newDiscount","updatedAt","leaveOpportunity","expireOldOpportunities","expiredCount","docSnap","parts","split","join","trim","NetworkService","networkStatus","initializeNetworkListener","handleReconnect","handleDisconnect","checkInitialNetworkStatus","controller","AbortController","timeoutId","abort","fetch","method","mode","cache","signal","clearTimeout","fetchError","Unsubscribe","SharedRideService","sharedRideSubject","notificationSubject","currentRiderId","sharedRideRef","newData","previousData","currentSharedRide","checkForNotifications","sharedRide$","emitNotification","passengers","totalPassengers","previousCount","newCount","previousPosition","getPickupPosition","currentPosition","passenger","pickupOrder","showToast","getCurrentSharedRide","myPosition","calculateDiscountPercent","baseDiscount","additionalPassengers","rideStatus","registerPlugin","web","AppWeb","exposeSynapse","GeolocationWeb","CapacitorGoogleMaps","southwest","northeast","contains","point","mapBoundsContains","mapBoundsExtend","MapType","CapacitorGoogleMapsWeb","_a","elem","document","elementFromPoint","internalId","dataset","mapInFocus","mapId","dispatchMapEvent","focus","Capacitor","MapCustomElement","HTMLElement","connectedCallback","innerHTML","getPlatform","overflow","overflowDiv","createElement","appendChild","customElements","define","resizeObserver","handleScrollEvent","updateMapBounds","callback","androidLiteMode","elementBounds","getElementBounds","devicePixelRatio","initScrolling","isNativePlatform","getMapBounds","_b","mapRect","getBoundingClientRect","onDisplay","mapBounds","onResize","ionicPage","closest","addEventListener","lastState","isHidden","ResizeObserver","observe","onMapReadyListener","retries","boundsInterval","enableClustering","minClusterSize","disableClustering","addTileOverlay","tileOverlay","res","removeTileOverlay","tileOverlayId","addMarkers","ids","markerId","removeMarkers","markerIds","addPolygons","polygons","removePolygons","polygonIds","addCircles","circles","removeCircles","circleIds","polylineIds","disableScrolling","disconnect","removeAllMapListeners","getMapType","setMapType","mapType","enableIndoorMaps","enabled","enableAccessibilityElements","padding","fitBounds","ionContents","getElementsByTagName","scrollEvents","screen","orientation","removeEventListener","onScroll","onCameraIdleListener","generateCallback","setOnBoundsChangedListener","onBoundsChangedListener","setOnCameraMoveStartedListener","onCameraMoveStartedListener","setOnClusterClickListener","onClusterClickListener","setOnClusterInfoWindowClickListener","onClusterInfoWindowClickListener","setOnInfoWindowClickListener","onInfoWindowClickListener","setOnMapClickListener","onMapClickListener","setOnPolygonClickListener","onPolygonClickListener","setOnCircleClickListener","onCircleClickListener","setOnMarkerClickListener","onMarkerClickListener","setOnPolylineClickListener","onPolylineClickListener","setOnMarkerDragStartListener","onMarkerDragStartListener","setOnMarkerDragListener","onMarkerDragListener","setOnMarkerDragEndListener","onMarkerDragEndListener","setOnMyLocationButtonClickListener","onMyLocationButtonClickListener","setOnMyLocationClickListener","onMyLocationClickListener","py2_round","abs","encode","factor","output","String","fromCharCode","str","precision","shift","byte","latitude_change","longitude_change","pow","Number","isInteger","charCodeAt","flipped","fromGeoJSON","geojson","toGeoJSON","module","exports","asyncScheduler","timer","period","scheduler","s","t","CapacitorUtils","Synapse","Proxy","w","r","Plugins","u","cordova","plugins","f"],"sourceRoot":"webpack:///","x_google_ignoreList":[13,14,15,16,17,18,19,20,21,22,23]}